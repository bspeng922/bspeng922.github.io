<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Pystack.org</title>
  <icon>https://www.gravatar.com/avatar/dd7bd216caddfcf24542754b94eb988d</icon>
  <subtitle>Time waits for no one.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://pystack.org/"/>
  <updated>2017-12-06T07:58:48.742Z</updated>
  <id>http://pystack.org/</id>
  
  <author>
    <name>moose</name>
    <email>bspeng922@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>配置neutron qos</title>
    <link href="http://pystack.org/2017/11/26/enable-neutron-qos/"/>
    <id>http://pystack.org/2017/11/26/enable-neutron-qos/</id>
    <published>2017-11-26T15:39:24.000Z</published>
    <updated>2017-12-06T07:58:48.742Z</updated>
    
    <content type="html"><![CDATA[<h2 id="网络节点"><a href="#网络节点" class="headerlink" title="网络节点:"></a>网络节点:</h2><ol><li>Add the QoS service to the service_plugins setting in /etc/neutron/neutron.conf. For example:</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service_plugins</span> = ... ,qos</span><br></pre></td></tr></table></figure><ol><li>In /etc/neutron/plugins/ml2/ml2_conf.ini, add qos to extension_drivers in the [ml2] section. For example:</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ml2]</span></span><br><span class="line"><span class="attr">extension_drivers</span> = port_security, qos</span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>If the Open vSwitch agent/Linux bridge is being used, set extensions to qos in the [agent] section of /etc/neutron/plugins/ml2/[openvswitch_agent|linuxbridge_agent].ini. For example:</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[agent]</span></span><br><span class="line"><span class="attr">extensions</span> = qos</span><br></pre></td></tr></table></figure><h2 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点:"></a>计算节点:</h2><p>In /etc/neutron/plugins/ml2/[openvswitch_agent|linuxbridge_agent].ini, add qos to the extensions setting in the [agent] section. For example:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[agent]</span></span><br><span class="line"><span class="attr">extensions</span> = qos</span><br></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建qos策略</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron qos-policy-create bw-limiter</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack network qos policy create bw-limiter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出qos策略</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron qos-policy-list</span></span><br><span class="line">neutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.</span><br><span class="line">+--------------------------------------+------------+----------------------------------+</span><br><span class="line">|<span class="string"> id                                   </span>|<span class="string"> name       </span>|<span class="string"> tenant_id                        </span>|</span><br><span class="line">+--------------------------------------+------------+----------------------------------+</span><br><span class="line">|<span class="string"> d3499b26-806d-43dd-80f1-68f0787af486 </span>|<span class="string"> bw-limiter </span>|<span class="string"> 08b173e0db2049e59d19bdd0e45f6b36 </span>|</span><br><span class="line">+--------------------------------------+------------+----------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建带宽限制规则</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron qos-bandwidth-limit-rule-create bw-limiter --max-kbps 3 --max-burst-kbps 3</span></span><br><span class="line"></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack network qos rule create --type bandwidth-limit --max-kbps 3000 --max-burst-kbits 300 --[ingress|egress] bw-limiter </span></span><br><span class="line">+----------------+--------------------------------------+</span><br><span class="line">|<span class="string"> Field          </span>|<span class="string"> Value                                </span>|</span><br><span class="line">+----------------+--------------------------------------+</span><br><span class="line">|<span class="string"> direction      </span>|<span class="string"> ingress                              </span>|</span><br><span class="line">|<span class="string"> id             </span>|<span class="string"> c52edb91-73a3-4592-b0f9-f02326ef5748 </span>|</span><br><span class="line">|<span class="string"> max_burst_kbps </span>|<span class="string"> 300                                  </span>|</span><br><span class="line">|<span class="string"> max_kbps       </span>|<span class="string"> 3000                                 </span>|</span><br><span class="line">|<span class="string"> name           </span>|<span class="string"> None                                 </span>|</span><br><span class="line">|<span class="string"> project_id     </span>|<span class="string">                                      </span>|</span><br><span class="line">+----------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前qos策略下面的规则</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron qos-bandwidth-limit-rule-list bw-limiter</span></span><br><span class="line">neutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.</span><br><span class="line">+-----------+--------------------------------------+----------------+----------+</span><br><span class="line">|<span class="string"> direction </span>|<span class="string"> id                                   </span>|<span class="string"> max_burst_kbps </span>|<span class="string"> max_kbps </span>|</span><br><span class="line">+-----------+--------------------------------------+----------------+----------+</span><br><span class="line">|<span class="string"> ingress   </span>|<span class="string"> c52edb91-73a3-4592-b0f9-f02326ef5748 </span>|<span class="string">            200 </span>|<span class="string">      200 </span>|</span><br><span class="line">|<span class="string"> egress    </span>|<span class="string"> f25ec3ff-ae3b-4c45-9999-471603194a5a </span>|<span class="string">           1000 </span>|<span class="string">     1000 </span>|</span><br><span class="line">+-----------+--------------------------------------+----------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新带宽限制规则</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron qos-bandwidth-limit-rule-update  0379b40f-4b55-49d7-9e32-77a9c3508424 bw-limiter --max-kbps 200 --max-burst-kbps 200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为端口设置qos策略</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron port-update b90df288-6239-4a07-ae66-9e67bd4c44b6 --qos-policy bw-limiter</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack port set --qos-policy bw-limiter \</span></span><br><span class="line">                         b90df288-6239-4a07-ae66-9e67bd4c44b6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为整个网络设置qos策略</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron net-update private --qos-policy bw-limiter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前端口详情</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron port-show b90df288-6239-4a07-ae66-9e67bd4c44b6</span></span><br><span class="line">neutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.</span><br><span class="line">+-----------------------+------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Field                 </span>|<span class="string"> Value                                                                              </span>|</span><br><span class="line">+-----------------------+------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> admin_state_up        </span>|<span class="string"> True                                                                               </span>|</span><br><span class="line">|<span class="string"> allowed_address_pairs </span>|<span class="string">                                                                                    </span>|</span><br><span class="line">|<span class="string"> binding:host_id       </span>|<span class="string"> compute1                                                                           </span>|</span><br><span class="line">|<span class="string"> binding:profile       </span>|<span class="string"> &#123;&#125;                                                                                 </span>|</span><br><span class="line">|<span class="string"> binding:vif_details   </span>|<span class="string"> &#123;"port_filter": true&#125;                                                              </span>|</span><br><span class="line">|<span class="string"> binding:vif_type      </span>|<span class="string"> bridge                                                                             </span>|</span><br><span class="line">|<span class="string"> binding:vnic_type     </span>|<span class="string"> normal                                                                             </span>|</span><br><span class="line">|<span class="string"> created_at            </span>|<span class="string"> 2017-11-08T02:31:47Z                                                               </span>|</span><br><span class="line">|<span class="string"> description           </span>|<span class="string">                                                                                    </span>|</span><br><span class="line">|<span class="string"> device_id             </span>|<span class="string"> 880c6c8e-2348-46cf-ba47-5e1916d5843b                                               </span>|</span><br><span class="line">|<span class="string"> device_owner          </span>|<span class="string"> compute:nova                                                                       </span>|</span><br><span class="line">|<span class="string"> extra_dhcp_opts       </span>|<span class="string">                                                                                    </span>|</span><br><span class="line">|<span class="string"> fixed_ips             </span>|<span class="string"> &#123;"subnet_id": "d3e38396-6227-4514-b56b-539ff61888f7", "ip_address": "192.168.1.8"&#125; </span>|</span><br><span class="line">|<span class="string"> id                    </span>|<span class="string"> b90df288-6239-4a07-ae66-9e67bd4c44b6                                               </span>|</span><br><span class="line">|<span class="string"> mac_address           </span>|<span class="string"> fa:16:3e:2a:df:5b                                                                  </span>|</span><br><span class="line">|<span class="string"> name                  </span>|<span class="string">                                                                                    </span>|</span><br><span class="line">|<span class="string"> network_id            </span>|<span class="string"> c192f87f-2c6c-47aa-af9a-97cd9e58a958                                               </span>|</span><br><span class="line">|<span class="string"> port_security_enabled </span>|<span class="string"> True                                                                               </span>|</span><br><span class="line">|<span class="string"> project_id            </span>|<span class="string"> 08b173e0db2049e59d19bdd0e45f6b36                                                   </span>|</span><br><span class="line">|<span class="string"> qos_policy_id         </span>|<span class="string"> d3499b26-806d-43dd-80f1-68f0787af486                                               </span>|</span><br><span class="line">|<span class="string"> revision_number       </span>|<span class="string"> 369649                                                                             </span>|</span><br><span class="line">|<span class="string"> security_groups       </span>|<span class="string"> 59d7794d-ffc8-4c0a-8bb7-34624bc14821                                               </span>|</span><br><span class="line">|<span class="string"> status                </span>|<span class="string"> ACTIVE                                                                             </span>|</span><br><span class="line">|<span class="string"> tags                  </span>|<span class="string">                                                                                    </span>|</span><br><span class="line">|<span class="string"> tenant_id             </span>|<span class="string"> 08b173e0db2049e59d19bdd0e45f6b36                                                   </span>|</span><br><span class="line">|<span class="string"> updated_at            </span>|<span class="string"> 2017-11-30T11:33:15Z                                                               </span>|</span><br><span class="line">+-----------------------+------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除端口上面的qos策略</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># neutron port-update b90df288-6239-4a07-ae66-9e67bd4c44b6 --no-qos-policy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为网络绑定qos策略</span></span><br><span class="line">neutron net-update private --qos-policy bw-limiter</span><br></pre></td></tr></table></figure><h2 id="检查计算节点"><a href="#检查计算节点" class="headerlink" title="检查计算节点"></a>检查计算节点</h2><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查tc规则，最后一条为新增的qos规则</span></span><br><span class="line">[root@compute1 ~]<span class="comment"># tc qdisc show</span></span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev lo root refcnt 2</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev docker0 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev brqdf94a80d-62 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev vxlan-7 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev tap50fe349c-88 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev tapb5f2adfd-cc root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev tapeb6cafe1-c1 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev brqc192f87f-2c root refcnt 2</span><br><span class="line"><span class="attribute">qdisc noqueue 0</span>: dev vxlan-10 root refcnt 2</span><br><span class="line"><span class="attribute">qdisc pfifo_fast 0</span>: dev tapb90df288-62 root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0 1 1 1 1 1 1 1 1</span><br><span class="line"><span class="attribute">qdisc ingress ffff</span>: dev tapb90df288-62 parent ffff:fff1 ----------------</span><br></pre></td></tr></table></figure><h2 id="Networking-back-ends-supported-rules-and-traffic-direction"><a href="#Networking-back-ends-supported-rules-and-traffic-direction" class="headerlink" title="Networking back ends, supported rules, and traffic direction"></a>Networking back ends, supported rules, and traffic direction</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">====================  ================  ================  ================</span><br><span class="line"> Rule \ back end       Open vSwitch      SR-IOV            Linux bridge</span><br><span class="line">====================  ================  ================  ================</span><br><span class="line"> Bandwidth limit       Egress\Ingress    Egress (1)        Egress\Ingress</span><br><span class="line"> Minimum bandwidth     -                 Egress            -</span><br><span class="line"> DSCP marking          Egress            -                 Egress</span><br><span class="line">====================  ================  ================  ================</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;网络节点&quot;&gt;&lt;a href=&quot;#网络节点&quot; class=&quot;headerlink&quot; title=&quot;网络节点:&quot;&gt;&lt;/a&gt;网络节点:&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Add the QoS service to the service_plugins setting in /etc/neutron/neutron.conf. For example:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;service_plugins&lt;/span&gt; = ... ,qos&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;In /etc/neutron/plugins/ml2/ml2_conf.ini, add qos to extension_drivers in the [ml2] section. For example:&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[ml2]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;extension_drivers&lt;/span&gt; = port_security, qos&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="neutron" scheme="http://pystack.org/tags/neutron/"/>
    
      <category term="qos" scheme="http://pystack.org/tags/qos/"/>
    
  </entry>
  
  <entry>
    <title>Openstack无法启动kali linux</title>
    <link href="http://pystack.org/2017/11/26/unable-to-boot-kali-linux-by-kvm/"/>
    <id>http://pystack.org/2017/11/26/unable-to-boot-kali-linux-by-kvm/</id>
    <published>2017-11-26T13:39:24.000Z</published>
    <updated>2017-12-08T05:51:52.849Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>通过KVM安装kali linux时一切正常，但是安装完成后重启的时候系统无法启动，提示错误：   </p><blockquote><p>   intel_rapl: no valid rapl domains found in package 0</p></blockquote><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>这是虚拟显卡的问题，只需要修改一下镜像的元数据即可</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">hw_video_model:</span> vga</span><br></pre></td></tr></table></figure><a id="more"></a><p>注： kali默认的第一块硬盘是sda，但openstack默认的是vda，虚拟机启动时会提示找不到sda1，所以还需要添加硬盘控制器的元数据：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">hw_disk_bus:</span> ide</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h3&gt;&lt;p&gt;通过KVM安装kali linux时一切正常，但是安装完成后重启的时候系统无法启动，提示错误：   &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;   intel_rapl: no valid rapl domains found in package 0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;解决方法&quot;&gt;&lt;a href=&quot;#解决方法&quot; class=&quot;headerlink&quot; title=&quot;解决方法&quot;&gt;&lt;/a&gt;解决方法&lt;/h3&gt;&lt;p&gt;这是虚拟显卡的问题，只需要修改一下镜像的元数据即可&lt;/p&gt;
&lt;figure class=&quot;highlight avrasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;hw_video_model:&lt;/span&gt; vga&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="kvm" scheme="http://pystack.org/tags/kvm/"/>
    
      <category term="kali linux" scheme="http://pystack.org/tags/kali-linux/"/>
    
  </entry>
  
  <entry>
    <title>安装Openstack ZUN模块</title>
    <link href="http://pystack.org/2017/10/14/install-openstack-zun/"/>
    <id>http://pystack.org/2017/10/14/install-openstack-zun/</id>
    <published>2017-10-14T03:39:24.000Z</published>
    <updated>2017-11-30T11:55:50.699Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装-zun"><a href="#安装-zun" class="headerlink" title="安装 zun"></a>安装 zun</h3><p><a href="https://review.openstack.org/#/c/504537/11/doc/source/install/controller-install-ubuntu.rst" target="_blank" rel="external">https://review.openstack.org/#/c/504537/11/doc/source/install/controller-install-ubuntu.rst</a></p><p><a href="https://review.openstack.org/#/c/504537/11/doc/source/install/compute-install-ubuntu.rst" target="_blank" rel="external">https://review.openstack.org/#/c/504537/11/doc/source/install/compute-install-ubuntu.rst</a></p><h3 id="安装网络驱动-kuryr-libnetwork"><a href="#安装网络驱动-kuryr-libnetwork" class="headerlink" title="安装网络驱动 kuryr-libnetwork"></a>安装网络驱动 kuryr-libnetwork</h3><p><a href="https://docs.openstack.org/kuryr-libnetwork/latest/install/index.html" target="_blank" rel="external">https://docs.openstack.org/kuryr-libnetwork/latest/install/index.html</a></p><h3 id="安装UI-zun-ui"><a href="#安装UI-zun-ui" class="headerlink" title="安装UI zun-ui"></a>安装UI zun-ui</h3><p><a href="https://docs.openstack.org/zun-ui/latest/install/index.html#manual-installation" target="_blank" rel="external">https://docs.openstack.org/zun-ui/latest/install/index.html#manual-installation</a></p><a id="more"></a><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">usage: zun create [-n &lt;name&gt;] [--cpu &lt;cpu&gt;] [-m &lt;memory&gt;] [-e &lt;<span class="attribute">KEY</span>=VALUE&gt;]</span><br><span class="line">                  [--workdir &lt;workdir&gt;] [--rm] [--label &lt;<span class="attribute">KEY</span>=VALUE&gt;]</span><br><span class="line">                  [--image-pull-policy &lt;policy&gt;] [--restart &lt;restart&gt;] [-i]</span><br><span class="line">                  [--image-driver &lt;image_driver&gt;]</span><br><span class="line">                  [--security-group &lt;security-group&gt;] [--hint &lt;<span class="attribute">key</span>=value&gt;]</span><br><span class="line">                  [--net &lt;auto, <span class="attribute">network</span>=network, <span class="attribute">port</span>=port-uuid,v4-fixed-ip=ip-addr,v6-fixed-ip=ip-addr&gt;]</span><br><span class="line">                  [--runtime &lt;runtime&gt;] [--hostname &lt;hostname&gt;]</span><br><span class="line">                  &lt;image&gt; <span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">usage: zun <span class="builtin-name">run</span> [-n &lt;name&gt;] [--cpu &lt;cpu&gt;] [-m &lt;memory&gt;] [-e &lt;<span class="attribute">KEY</span>=VALUE&gt;]</span><br><span class="line">               [--workdir &lt;workdir&gt;] [--rm] [--label &lt;<span class="attribute">KEY</span>=VALUE&gt;]</span><br><span class="line">               [--image-pull-policy &lt;policy&gt;] [--restart &lt;restart&gt;] [-i]</span><br><span class="line">               [--image-driver &lt;image_driver&gt;]</span><br><span class="line">               [--security-group &lt;security-group&gt;] [--hint &lt;<span class="attribute">key</span>=value&gt;]</span><br><span class="line">               [--net &lt;auto, <span class="attribute">network</span>=network, <span class="attribute">port</span>=port-uuid,v4-fixed-ip=ip-addr,v6-fixed-ip=ip-addr&gt;]</span><br><span class="line">               [--runtime &lt;runtime&gt;] [--hostname &lt;hostname&gt;]</span><br><span class="line">               &lt;image&gt; <span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">def container_create(request, **kwargs):</span><br><span class="line">    args, <span class="builtin-name">run</span> = _cleanup_params(CONTAINER_CREATE_ATTRS, <span class="literal">True</span>, **kwargs)</span><br><span class="line">    response = None</span><br><span class="line">    <span class="keyword">if</span> run:</span><br><span class="line">        response = zunclient(request).containers.<span class="builtin-name">run</span>(*<span class="number">*a</span>rgs)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response = zunclient(request).containers.create(*<span class="number">*a</span>rgs)</span><br><span class="line">    return response</span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建并启动容器</span></span><br><span class="line">openstack appcontainer <span class="builtin-name">run</span> --name container --net <span class="attribute">network</span>=<span class="variable">$NET_ID</span> cirros<span class="built_in"> ping </span>8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment">### 容器列表</span></span><br><span class="line">openstack appcontainer list</span><br><span class="line">zun image-list </span><br><span class="line"></span><br><span class="line"><span class="comment">### 进入容器bash</span></span><br><span class="line">openstack appcontainer exec --interactive container /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">### 停止容器</span></span><br><span class="line">openstack appcontainer stop container</span><br><span class="line"></span><br><span class="line"><span class="comment">### 删除容器</span></span><br><span class="line">openstack appcontainer delete container</span><br><span class="line"></span><br><span class="line"><span class="comment">### 拷贝文件</span></span><br><span class="line">zun cp container:src_path dest_path|-</span><br><span class="line">zun cp src_path|- container:dest_path</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建网络</span></span><br><span class="line">neutron API</span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建路由</span></span><br><span class="line">neutron API</span><br><span class="line"></span><br><span class="line"><span class="comment">### 绑定端口</span></span><br><span class="line">neutron API</span><br><span class="line"></span><br><span class="line"><span class="comment">### 从镜像创建容器</span></span><br><span class="line"> zun <span class="builtin-name">run</span> --name ubuntu-web --net <span class="attribute">network</span>=df94a80d-62a9-4551-ae6b-8d0af3f44fc2 ubuntu-webbb tail -f /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">### 绑定浮动IP</span></span><br><span class="line">申请浮动IP  --  获取容器网络port id</span><br><span class="line"></span><br><span class="line">Container Addresses</span><br><span class="line">&#123; <span class="string">"df94a80d-62a9-4551-ae6b-8d0af3f44fc2"</span>: [ &#123; <span class="string">"version"</span>: 4, <span class="string">"addr"</span>: <span class="string">"172.16.1.14"</span>, <span class="string">"port"</span>: <span class="string">"eb6cafe1-c19c-4555-826d-7188e903566e"</span> &#125; ] &#125;</span><br><span class="line"></span><br><span class="line">neutron  floatingip-associate 32c35af6-9d72-416a-a8cc-220522106452 b3f02c2e-aa76-4db6-b8dc-7defcf67b5a3</span><br><span class="line"></span><br><span class="line">floating-ip 设备id（device id） -  端口ID</span><br><span class="line">1. 创建端口（指定网络） -- 创建容器（指定端口） -- 生成浮动IP -- 绑定浮动IP</span><br><span class="line">2. 创建容器（指定网络） -- 创建容器 -- 查找端口 -- 生成浮动IP  -- 绑定浮动IP</span><br><span class="line"></span><br><span class="line"><span class="comment">### 容器初始化</span></span><br><span class="line"> 拼接初始化脚本文件 -- 拷贝zip文件到容器中 -- 执行初始化 （解压zip文件  -- 执行安装脚本 -- 执行init脚本）</span><br><span class="line"></span><br><span class="line"><span class="comment">### 从容器转为镜像</span></span><br><span class="line"> zun commit ubuntuc ubuntu-webbb    </span><br><span class="line"> ---- zun pull ubuntu-webbb ----</span><br><span class="line"></span><br><span class="line"><span class="comment">### 从docker file生成镜像 (暂不支持)</span></span><br><span class="line"> TODO</span><br></pre></td></tr></table></figure><h3 id="zun-commit-后的镜像磁盘格式为qcow2"><a href="#zun-commit-后的镜像磁盘格式为qcow2" class="headerlink" title="zun commit 后的镜像磁盘格式为qcow2"></a>zun commit 后的镜像磁盘格式为qcow2</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">python2</span>.7/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">zun</span>/<span class="title">image</span>/<span class="title">glance</span>/<span class="title">driver</span>.<span class="title">py</span></span></span><br><span class="line"></span><br><span class="line">change qcow2 to raw</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;安装-zun&quot;&gt;&lt;a href=&quot;#安装-zun&quot; class=&quot;headerlink&quot; title=&quot;安装 zun&quot;&gt;&lt;/a&gt;安装 zun&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://review.openstack.org/#/c/504537/11/doc/source/install/controller-install-ubuntu.rst&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://review.openstack.org/#/c/504537/11/doc/source/install/controller-install-ubuntu.rst&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://review.openstack.org/#/c/504537/11/doc/source/install/compute-install-ubuntu.rst&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://review.openstack.org/#/c/504537/11/doc/source/install/compute-install-ubuntu.rst&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;安装网络驱动-kuryr-libnetwork&quot;&gt;&lt;a href=&quot;#安装网络驱动-kuryr-libnetwork&quot; class=&quot;headerlink&quot; title=&quot;安装网络驱动 kuryr-libnetwork&quot;&gt;&lt;/a&gt;安装网络驱动 kuryr-libnetwork&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://docs.openstack.org/kuryr-libnetwork/latest/install/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://docs.openstack.org/kuryr-libnetwork/latest/install/index.html&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;安装UI-zun-ui&quot;&gt;&lt;a href=&quot;#安装UI-zun-ui&quot; class=&quot;headerlink&quot; title=&quot;安装UI zun-ui&quot;&gt;&lt;/a&gt;安装UI zun-ui&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://docs.openstack.org/zun-ui/latest/install/index.html#manual-installation&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://docs.openstack.org/zun-ui/latest/install/index.html#manual-installation&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="openstack" scheme="http://pystack.org/tags/openstack/"/>
    
      <category term="docker" scheme="http://pystack.org/tags/docker/"/>
    
      <category term="zun" scheme="http://pystack.org/tags/zun/"/>
    
      <category term="kuryr" scheme="http://pystack.org/tags/kuryr/"/>
    
  </entry>
  
  <entry>
    <title>安装Openstack Magnum模块遇到的问题</title>
    <link href="http://pystack.org/2017/10/10/errors-while-installing-openstack-magnum/"/>
    <id>http://pystack.org/2017/10/10/errors-while-installing-openstack-magnum/</id>
    <published>2017-10-10T10:39:24.000Z</published>
    <updated>2017-11-16T02:33:21.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Magnum安装配置"><a href="#Magnum安装配置" class="headerlink" title="Magnum安装配置"></a>Magnum安装配置</h1><p>官方文档： <a href="https://docs.openstack.org/project-install-guide/container-infrastructure-management/draft/install-rdo.html" target="_blank" rel="external">https://docs.openstack.org/project-install-guide/container-infrastructure-management/draft/install-rdo.html</a></p><p>从源码安装Magnum <a href="https://docs.openstack.org/magnum/latest/install/install-guide-from-source.html" target="_blank" rel="external">https://docs.openstack.org/magnum/latest/install/install-guide-from-source.html</a></p><hr><h2 id="swarm-cluster创建超时"><a href="#swarm-cluster创建超时" class="headerlink" title="swarm-cluster创建超时"></a>swarm-cluster创建超时</h2><p>现象就是swarm-master一直显示在创建中，然后超过60分钟后，显示创建失败，heat显示的错误是Timeout</p><p><strong>解决方法：</strong><br>超时问题是因为虚拟机中解析不到controller对应的IP地址，需要讲keystone, heat, magnum 的 public endpoint改成 IP地址。</p><a id="more"></a><hr><h2 id="swarm-manager-service-failed-to-start"><a href="#swarm-manager-service-failed-to-start" class="headerlink" title="swarm-manager service failed to start"></a>swarm-manager service failed to start</h2><p>创建swarm-master是，提示swarm-manager服务启动失败，登录到虚拟机内发现etcd，swarm-manager服务都启动失败，etcd启动失败的原因是 “open /etc/docker/server.crt: no such file or directory” ，正常的/etc/docker/下面应该有三个证书文件，但错误的虚拟机里只有一个。</p><p><strong>错误日志</strong> : /var/log/message</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2017-11-02 15:41:35.325 24030 <span class="builtin-name">WARNING</span> magnum.common.keystone [req-1f4cec3b-d7a7-4143-825a-728cda9b1a7d - - - - -] Auth plugin <span class="keyword">and</span> its options <span class="keyword">for</span><span class="built_in"> service user </span>must be provided <span class="keyword">in</span> [keystone_auth] section. Using values <span class="keyword">from</span> [keystone_authtoken] section is deprecated.: MissingRequiredOptions: Auth plugin requires parameters which were <span class="keyword">not</span> given: auth_url</span><br><span class="line">2017-11-02 15:41:48.275 24026 <span class="builtin-name">ERROR</span> magnum.drivers.heat.driver [req-609a5a1b-14f1-4e78-b22c-c93c806c36d9 - - - - -] Cluster error, stack status: CREATE_FAILED, stack_id: 420d9818-06a6-4a9c-9d86-f11aaf225eb2, reason:<span class="built_in"> Resource </span>CREATE failed: WaitConditionFailure: resources.swarm_masters.resources[0].resources.master_wait_condition: swarm-manager<span class="built_in"> service </span>failed <span class="keyword">to</span> start.</span><br><span class="line">2017-11-02 15:41:48.921 24029 <span class="builtin-name">ERROR</span> magnum.drivers.heat.driver [req-9160df5d-338f-4acc-aab8-e3c8c3370703 - - - - -] Cluster error, stack status: CREATE_FAILED, stack_id: 420d9818-06a6-4a9c-9d86-f11aaf225eb2, reason:<span class="built_in"> Resource </span>CREATE failed: WaitConditionFailure: resources.swarm_masters.resources[0].resources.master_wait_condition: swarm-manager<span class="built_in"> service </span>failed <span class="keyword">to</span> start.</span><br></pre></td></tr></table></figure><p><strong>虚拟机服务状态</strong> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[fedora@swarm-cluster-i7bkbockqyvu-master-0 ~]$ sudo systemctl <span class="keyword">start</span> swarm-manager</span><br><span class="line">A dependency job <span class="keyword">for</span> swarm-manager.service failed. See <span class="string">'journalctl -xe'</span> <span class="keyword">for</span> details.</span><br><span class="line">[fedora@swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0</span> ~]$ journalctl -xe</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: recognized <span class="keyword">and</span> used environment <span class="keyword">variable</span> ETCD_PEER_CERT_FILE=/etc/docker/server.crt</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: recognized <span class="keyword">and</span> used environment <span class="keyword">variable</span> ETCD_PEER_KEY_FILE=/etc/docker/server.key</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: recognized environment <span class="keyword">variable</span> ETCD_NAME, but <span class="keyword">unused</span>: shadowed <span class="keyword">by</span> <span class="keyword">corresponding</span> flag </span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: recognized environment <span class="keyword">variable</span> ETCD_DATA_DIR, but <span class="keyword">unused</span>: shadowed <span class="keyword">by</span> <span class="keyword">corresponding</span> fl</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: recognized environment <span class="keyword">variable</span> ETCD_LISTEN_CLIENT_URLS, but <span class="keyword">unused</span>: shadowed <span class="keyword">by</span> corres</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: etcd <span class="keyword">Version</span>: <span class="number">3.1</span><span class="number">.3</span></span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: Git <span class="keyword">SHA</span>: <span class="number">21</span>fdcc6</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: <span class="keyword">Go</span> <span class="keyword">Version</span>: go1<span class="number">.7</span><span class="number">.5</span></span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: <span class="keyword">Go</span> OS/Arch: linux/amd64</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: setting maximum <span class="built_in">number</span> <span class="keyword">of</span> CPUs <span class="keyword">to</span> <span class="number">4</span>, total <span class="built_in">number</span> <span class="keyword">of</span> available CPUs <span class="keyword">is</span> <span class="number">4</span></span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: peerTLS: cert = /etc/docker/server.crt, <span class="keyword">key</span> = /etc/docker/server.key, ca = /etc/docker/</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal etcd[<span class="number">2452</span>]: <span class="keyword">open</span> /etc/docker/server.crt: <span class="keyword">no</span> such <span class="keyword">file</span> <span class="keyword">or</span> <span class="keyword">directory</span></span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal systemd[<span class="number">1</span>]: etcd.service: <span class="keyword">Main</span> process exited, code=exited, <span class="keyword">status</span>=<span class="number">1</span>/<span class="keyword">FAILURE</span></span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal <span class="keyword">audit</span>[<span class="number">1</span>]: SERVICE_START pid=<span class="number">1</span> uid=<span class="number">0</span> auid=<span class="number">4294967295</span> ses=<span class="number">4294967295</span> subj=system_u:system_r:init_t:s0</span><br><span class="line">Nov <span class="number">01</span> <span class="number">06</span>:<span class="number">55</span>:<span class="number">44</span> swarm-cluster-i7bkbockqyvu-<span class="keyword">master</span><span class="number">-0.</span>novalocal systemd[<span class="number">1</span>]: <span class="keyword">Failed</span> <span class="keyword">to</span> <span class="keyword">start</span> Etcd Server.</span><br><span class="line"><span class="comment">-- Subject: Unit etcd.service has failed</span></span><br><span class="line"><span class="comment">-- Defined-By: systemd</span></span><br><span class="line"><span class="comment">-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel</span></span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- Unit etcd.service has failed.</span></span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- The result is failed.</span></span><br></pre></td></tr></table></figure><p><strong>Cloud-init 日志</strong> ： /var/log/cloud-init-output.log</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Cloud-init v. 0.7.9 running 'modules:config' at Thu, 02 Nov 2017 02:07:02 +0000. Up 39.38 seconds.</span><br><span class="line">removing docker key</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/var/lib/cloud/instance/scripts/part-004"</span>, line <span class="number">181</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    sys.exit(<span class="keyword">main</span>())</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/var/lib/cloud/instance/scripts/part-004"</span>, line <span class="number">174</span>, <span class="keyword">in</span> <span class="keyword">main</span></span><br><span class="line">    write_ca_cert(config)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/var/lib/cloud/instance/scripts/part-004"</span>, line <span class="number">93</span>, <span class="keyword">in</span> write_ca_cert</span><br><span class="line">    fp.write(ca_cert_resp.json()[<span class="string">'pem'</span>])</span><br><span class="line">KeyError: <span class="string">'pem'</span></span><br><span class="line">Cloud-init v. <span class="number">0.7</span><span class="number">.9</span> running <span class="string">'modules:final'</span> <span class="keyword">at</span> Thu, <span class="number">02</span> Nov <span class="number">2017</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">05</span> +<span class="number">0000.</span> Up <span class="number">41.72</span> seconds.</span><br><span class="line"><span class="number">2017</span><span class="number">-11</span><span class="number">-02</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">09</span>,<span class="number">335</span> - util.py[<span class="keyword">WARNING</span>]: <span class="keyword">Failed</span> running /<span class="keyword">var</span>/lib/cloud/<span class="keyword">instance</span>/scripts/part<span class="number">-004</span> [<span class="number">1</span>]</span><br><span class="line">Configuring docker network ...</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">notifying heat</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   <span class="keyword">Time</span>    <span class="keyword">Time</span>     <span class="keyword">Time</span>  <span class="keyword">Current</span></span><br><span class="line">                                 Dload  Upload   Total   Spent    <span class="keyword">Left</span>  Speed</span><br><span class="line"><span class="number">100</span>   <span class="number">113</span>  <span class="number">100</span>     <span class="number">4</span>  <span class="number">100</span>   <span class="number">109</span>      <span class="number">5</span>    <span class="number">142</span> <span class="comment">--:--:-- --:--:-- --:--:--   142</span></span><br><span class="line"><span class="keyword">HTTP</span>/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="keyword">Content</span>-<span class="keyword">Type</span>: application/<span class="keyword">json</span></span><br><span class="line"><span class="keyword">Content</span>-<span class="keyword">Length</span>: <span class="number">4</span></span><br><span class="line">X-Openstack-Request-<span class="keyword">Id</span>: req<span class="number">-96486</span>cd4-c8ae<span class="number">-4465</span>-b37b<span class="number">-31296</span>c2383b9</span><br><span class="line">  te: Thu, <span class="number">02</span> Nov <span class="number">2017</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">13</span> GMT</span><br><span class="line">▽</span><br><span class="line"><span class="literal">null</span>+ <span class="string">'['</span> -z <span class="string">''</span> <span class="string">']'</span></span><br><span class="line">+ <span class="keyword">exit</span> <span class="number">0</span></span><br><span class="line"><span class="number">2017</span><span class="number">-11</span><span class="number">-02</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">14</span>,<span class="number">039</span> - cc_scripts_user.py[<span class="keyword">WARNING</span>]: <span class="keyword">Failed</span> <span class="keyword">to</span> run <span class="keyword">module</span> scripts-<span class="keyword">user</span> (scripts <span class="keyword">in</span> /<span class="keyword">var</span>/lib/cloud/<span class="keyword">instance</span>/scripts)</span><br><span class="line"><span class="number">2017</span><span class="number">-11</span><span class="number">-02</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">14</span>,<span class="number">051</span> - util.py[<span class="keyword">WARNING</span>]: Running <span class="keyword">module</span> scripts-<span class="keyword">user</span> (&lt;<span class="keyword">module</span> <span class="string">'cloudinit.config.cc_scripts_user'</span> <span class="keyword">from</span> <span class="string">'/usr/lib/python3.5/site-packages/cloudinit/config/cc_scripts_user.py'</span>&gt;) <span class="keyword">failed</span></span><br><span class="line">Cloud-init v. <span class="number">0.7</span><span class="number">.9</span> finished <span class="keyword">at</span> Thu, <span class="number">02</span> Nov <span class="number">2017</span> <span class="number">02</span>:<span class="number">07</span>:<span class="number">14</span> +<span class="number">0000.</span> Datasource DataSourceOpenStack [net,ver=<span class="number">2</span>].  Up <span class="number">50.91</span> seconds</span><br></pre></td></tr></table></figure><p><strong>解决方法</strong>： </p><p><strong>虚拟机初始化代码出错位置</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def write_server_cert(<span class="built_in">config</span>, csr_req):</span><br><span class="line">    cert_url = <span class="string">'%s/certificates'</span> % <span class="built_in">config</span>[<span class="string">'MAGNUM_URL'</span>]</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'X-Auth-Token'</span>: <span class="built_in">config</span>[<span class="string">'USER_TOKEN'</span>],</span><br><span class="line">        <span class="string">'OpenStack-API-Version'</span>: <span class="string">'container-infra latest'</span></span><br><span class="line">    &#125;</span><br><span class="line">    csr_resp = requests.post(cert_url,</span><br><span class="line">                             data=json.dumps(csr_req),</span><br><span class="line">                             headers=headers)</span><br><span class="line"></span><br><span class="line">    with <span class="built_in">open</span>(SERVER_CERT_PATH, <span class="string">'w'</span>) as fp:</span><br><span class="line">        fp.<span class="built_in">write</span>(csr_resp.json()[<span class="string">'pem'</span>])</span><br></pre></td></tr></table></figure><p>从出错的位置可以看出，就是虚拟机请求certificates时出了问题。在Postman中测试，先生成token，再请求certificates</p><h3 id="User-Token"><a href="#User-Token" class="headerlink" title="User Token"></a>User Token</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- POST  http://<span class="number">10.10</span>.<span class="number">80.10</span>:<span class="number">5000</span>/v3/auth/tokens</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"token"</span>: &#123;</span><br><span class="line">        <span class="string">"issued_at"</span>: <span class="string">"2017-11-01T08:44:05.000000Z"</span>,</span><br><span class="line">        <span class="string">"audit_ids"</span>: [</span><br><span class="line">            <span class="string">"OfBOuEzrToWzC8aer5miKQ"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"methods"</span>: [</span><br><span class="line">            <span class="string">"password"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"expires_at"</span>: <span class="string">"2017-11-01T09:44:05.000000Z"</span>,</span><br><span class="line">        <span class="string">"user"</span>: &#123;</span><br><span class="line">            <span class="string">"password_expires_at"</span>: null,</span><br><span class="line">            <span class="string">"domain"</span>: &#123;</span><br><span class="line">                <span class="string">"id"</span>: <span class="string">"53bd6f95db004eb3807c66fcbaa45300"</span>,</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"magnum"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"175717d8f4d64b39ba9bc3001e3d8f1c"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"a6a9cfc8-e8bc-4c6a-a452-4684d98ae925_08b173e0db2049e59d19bdd0e45f6b36"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Get-Certificates-：-正确的返回"><a href="#Get-Certificates-：-正确的返回" class="headerlink" title="Get Certificates ： 正确的返回"></a>Get Certificates ： 正确的返回</h3><p>正确的返回是一个json格式的数据，里面有”pem”这一项，刚好是虚拟机初始化时报错的地方</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- GET  http://10.10.80.10:9511/v1/certificates/[CLUSTER_ID]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "cluster_uuid": "a6a9cfc8-e8bc-4c6a-a452-4684d98ae925",</span><br><span class="line">    "pem": "-----BEGIN CERTIFICATE-----<span class="symbol">\n</span>MIIC4jCCAcqgAwIBAgIQR2pl521NS3yFmBrbxWgqdjANBgkqhkiG9w0BAQsFADAZ<span class="symbol">\n</span>MRcwFQYDVQQDDA5zd2FybS1jbHVzdGVyMjAeFw0xNzEwMzExNjAzMzJaFw0yMjEw<span class="symbol">\n</span>MzExNjAzMzJaMBkxFzAVBgNVBAMMDnN3YXJtLWNsdXN0ZXIyMIIBIjANBgkqhkiG<span class="symbol">\n</span>9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuFSJd60hC3UGIFazXBj+GmyeI9gU6a8WJbP8<span class="symbol">\n</span>UYieqBnmnpt4GlbvTJbzJFQMwL9bqtzbDv0+Hn0O7GIjS6NzncM7fiDkkbCVlXk8<span class="symbol">\n</span>ox7cyJf3KGVuUaHukubJkqX5EMecw2McIPJmfhQQdX6Z5asmHOIU/EfULCoaOtH4<span class="symbol">\n</span>DptVi7AroQepeB22HIVVR6O4/9vH5r9ET0QPEsu1WnRUZNfniJC7gl9jp1SwDBRD<span class="symbol">\n</span>+DRtA4g8pg+d8KEw/yueurdV8oN9QupuH/xcwlR2Oi4d6sRio+aefv6/4iATtNo5<span class="symbol">\n</span>MOLzVK6OtALNiO2j9vRHBZAIjRvkPE8XbFNqeURwu8KX5cogmwIDAQABoyYwJDAS<span class="symbol">\n</span>BgNVHRMBAf8ECDAGAQH/AgEAMA4GA1UdDwEB/wQEAwICBDANBgkqhkiG9w0BAQsF<span class="symbol">\n</span>AAOCAQEAmmAgrH3cqCSrCMSqv1HiWBBviguoXx0yLgJoX4Z57DqY6mTf+Zv1dqEf<span class="symbol">\n</span>gdBe2lpFv2t5CeTk9wjr0iMIbg92KiayUCkty85n/VMa3PWw1iIxc3oCRVX3esNE<span class="symbol">\n</span>dMvMwaME0iPVnqh8+b6f6dop9OrNDIrGvoovAaUoqgaF+WCYZGBiqMzSw/MIhrjZ<span class="symbol">\n</span>v/kDf52CjfvFy0N+JSQgVQULr0+U1/Q+KnztrX1g95LMQjcP0mWHag6F4JT2Ty6A<span class="symbol">\n</span>vZ24sWtj/NXatvZ+aty/eHFt1f4BV9HXho5EPDPkheomZnalrrMKpJk/3jAd+REZ<span class="symbol">\n</span>bUP+hs4Fa1sUXZuJjsfeXDnQ2hGm+g==<span class="symbol">\n</span>-----END CERTIFICATE-----<span class="symbol">\n</span>",</span><br><span class="line">    "bay_uuid": "a6a9cfc8-e8bc-4c6a-a452-4684d98ae925",</span><br><span class="line">    "links": [</span><br><span class="line">        &#123;</span><br><span class="line">            "href": "http://10.10.80.10:9511/v1/certificates/a6a9cfc8-e8bc-4c6a-a452-4684d98ae925",</span><br><span class="line">            "rel": "self"</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            "href": "http://10.10.80.10:9511/certificates/a6a9cfc8-e8bc-4c6a-a452-4684d98ae925",</span><br><span class="line">            "rel": "bookmark"</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Get-Certificates-：-错误的返回"><a href="#Get-Certificates-：-错误的返回" class="headerlink" title="Get Certificates ： 错误的返回"></a>Get Certificates ： 错误的返回</h3><p>错误返回代码是500，导致我一直以为是magnum代码写的有问题，所以就有了后面一步一步的调试</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2017-11-02 16:38:33.134 5048 <span class="keyword">ERROR</span> wsme.api [req-4f45fd22-5b2d-4a24-9e93-08b7bfa95e12 15edc195e4bb4b50bf3c26b0bb5e3b09 - 53bd6f95db004eb3807c66fcbaa45300 - -] Server-side <span class="keyword">error</span>: "Remote <span class="keyword">error</span>: BadRequest Invalid <span class="keyword">input</span> <span class="keyword">for</span> field 'identity/password/user/password': None is not of <span class="keyword">type</span> 'string'</span><br><span class="line"></span><br><span class="line">Failed validating '<span class="keyword">type</span>' <span class="keyword">in</span> schema['properties']['identity']['properties']['password']['properties']['user']['properties']['password']:</span><br><span class="line">    &#123;'<span class="keyword">type</span>': 'string'&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">On</span> instance['identity']['password']['user']['password']:</span><br><span class="line">    None (HTTP 400) (Request-ID: req-f5ee8f99-7ea3-4679-8f7d-30867ae111a0)</span><br><span class="line">[<span class="keyword">u</span>'Traceback (most recent call last):\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/magnum/conductor/handlers/indirection_api.py"</span>, <span class="keyword">line</span> 33, <span class="keyword">in</span> _object_dispatch\<span class="keyword">n</span>    <span class="keyword">return</span> getattr(target, method)(context, *<span class="keyword">args</span>, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/oslo_versionedobjects/base.py"</span>, <span class="keyword">line</span> 184, <span class="keyword">in</span> wrapper\<span class="keyword">n</span>    result = fn(cls, context, *<span class="keyword">args</span>, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/magnum/objects/cluster.py"</span>, <span class="keyword">line</span> 139, <span class="keyword">in</span> get_by_uuid\<span class="keyword">n</span>    db_cluster = cls.dbapi.get_cluster_by_uuid(context, uuid)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/magnum/db/sqlalchemy/api.py"</span>, <span class="keyword">line</span> 212, <span class="keyword">in</span> get_cluster_by_uuid\<span class="keyword">n</span>    <span class="keyword">query</span> = self._add_tenant_filters(context, <span class="keyword">query</span>)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/magnum/db/sqlalchemy/api.py"</span>, <span class="keyword">line</span> 141, <span class="keyword">in</span> _add_tenant_filters\<span class="keyword">n</span>    user_name = kst.client.users.<span class="built_in">get</span>(context.user_id).name\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneclient/v3/users.py"</span>, <span class="keyword">line</span> 152, <span class="keyword">in</span> get\<span class="keyword">n</span>    user_id=base.getid(user))\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneclient/base.py"</span>, <span class="keyword">line</span> 75, <span class="keyword">in</span> func\<span class="keyword">n</span>    <span class="keyword">return</span> <span class="built_in">f</span>(*<span class="keyword">args</span>, **new_kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneclient/base.py"</span>, <span class="keyword">line</span> 349, <span class="keyword">in</span> get\<span class="keyword">n</span>    self.key)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneclient/base.py"</span>, <span class="keyword">line</span> 150, <span class="keyword">in</span> _get\<span class="keyword">n</span>    resp, body = self.client.<span class="built_in">get</span>(url, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py"</span>, <span class="keyword">line</span> 288, <span class="keyword">in</span> get\<span class="keyword">n</span>    <span class="keyword">return</span> self.request(url, \'GET\', **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py"</span>, <span class="keyword">line</span> 447, <span class="keyword">in</span> request\<span class="keyword">n</span>    resp = super(LegacyJsonAdapter, self).request(*<span class="keyword">args</span>, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/adapter.py"</span>, <span class="keyword">line</span> 192, <span class="keyword">in</span> request\<span class="keyword">n</span>    <span class="keyword">return</span> self.session.request(url, method, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/positional/__init__.py"</span>, <span class="keyword">line</span> 101, <span class="keyword">in</span> inner\<span class="keyword">n</span>    <span class="keyword">return</span> wrapped(*<span class="keyword">args</span>, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/session.py"</span>, <span class="keyword">line</span> 578, <span class="keyword">in</span> request\<span class="keyword">n</span>    auth_headers = self.get_auth_headers(auth)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/session.py"</span>, <span class="keyword">line</span> 905, <span class="keyword">in</span> get_auth_headers\<span class="keyword">n</span>    <span class="keyword">return</span> auth.get_headers(self, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/plugin.py"</span>, <span class="keyword">line</span> 90, <span class="keyword">in</span> get_headers\<span class="keyword">n</span>    <span class="keyword">token</span> = self.get_token(session)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py"</span>, <span class="keyword">line</span> 89, <span class="keyword">in</span> get_token\<span class="keyword">n</span>    <span class="keyword">return</span> self.get_access(session).auth_token\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/identity/base.py"</span>, <span class="keyword">line</span> 135, <span class="keyword">in</span> get_access\<span class="keyword">n</span>    self.auth_ref = self.get_auth_ref(session)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/identity/v3/base.py"</span>, <span class="keyword">line</span> 167, <span class="keyword">in</span> get_auth_ref\<span class="keyword">n</span>    authenticated=False, <span class="keyword">log</span>=False, **rkwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/session.py"</span>, <span class="keyword">line</span> 853, <span class="keyword">in</span> <span class="keyword">post</span>\<span class="keyword">n</span>    <span class="keyword">return</span> self.request(url, \'<span class="keyword">POST</span>\', **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/positional/__init__.py"</span>, <span class="keyword">line</span> 101, <span class="keyword">in</span> inner\<span class="keyword">n</span>    <span class="keyword">return</span> wrapped(*<span class="keyword">args</span>, **kwargs)\<span class="keyword">n</span>', <span class="keyword">u</span>'  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/site-packages/keystoneauth1/session.py"</span>, <span class="keyword">line</span> 742, <span class="keyword">in</span> request\<span class="keyword">n</span>    raise exceptions.from_response(resp, method, url)\<span class="keyword">n</span>', <span class="keyword">u</span><span class="string">"BadRequest: Invalid input for field 'identity/password/user/password': None is not of type 'string'\n\nFailed validating 'type' in schema['properties']['identity']['properties']['password']['properties']['user']['properties']['password']:\n    &#123;'type': 'string'&#125;\n\nOn instance['identity']['password']['user']['password']:\n    None (HTTP 400) (Request-ID: req-f5ee8f99-7ea3-4679-8f7d-30867ae111a0)\n"</span>].". Detail: </span><br><span class="line">Traceback (most recent call last):</span><br></pre></td></tr></table></figure><p>其实在最开始的日志中就提示了问题所在 “ Auth plugin and its options for service user must be provided in [keystone_auth] section. Using values from [keystone_authtoken] section is deprecated.: MissingRequiredOptions: Auth plugin requires parameters which were not given: auth_url”， 不过错误等级是WARNING，所以一直被我忽略掉，后来一步一步调试代码又定位到了这个问题。<br>解决办法就是配置 /etc/magnum/magnum.conf 中 keystone_auth项 </p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[keystone_auth]</span></span><br><span class="line"><span class="attr">auth_version</span> = v3</span><br><span class="line"><span class="attr">auth_uri</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">project_domain_id</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">user_domain_id</span> = default</span><br><span class="line"><span class="attr">password</span> = magnum</span><br><span class="line"><span class="attr">username</span> = magnum</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">35357</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Magnum安装配置&quot;&gt;&lt;a href=&quot;#Magnum安装配置&quot; class=&quot;headerlink&quot; title=&quot;Magnum安装配置&quot;&gt;&lt;/a&gt;Magnum安装配置&lt;/h1&gt;&lt;p&gt;官方文档： &lt;a href=&quot;https://docs.openstack.org/project-install-guide/container-infrastructure-management/draft/install-rdo.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://docs.openstack.org/project-install-guide/container-infrastructure-management/draft/install-rdo.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;从源码安装Magnum &lt;a href=&quot;https://docs.openstack.org/magnum/latest/install/install-guide-from-source.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://docs.openstack.org/magnum/latest/install/install-guide-from-source.html&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;swarm-cluster创建超时&quot;&gt;&lt;a href=&quot;#swarm-cluster创建超时&quot; class=&quot;headerlink&quot; title=&quot;swarm-cluster创建超时&quot;&gt;&lt;/a&gt;swarm-cluster创建超时&lt;/h2&gt;&lt;p&gt;现象就是swarm-master一直显示在创建中，然后超过60分钟后，显示创建失败，heat显示的错误是Timeout&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决方法：&lt;/strong&gt;&lt;br&gt;超时问题是因为虚拟机中解析不到controller对应的IP地址，需要讲keystone, heat, magnum 的 public endpoint改成 IP地址。&lt;/p&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="openstack" scheme="http://pystack.org/tags/openstack/"/>
    
      <category term="Magnum" scheme="http://pystack.org/tags/Magnum/"/>
    
      <category term="docker" scheme="http://pystack.org/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>在ARM平台上编译Virt Viewer</title>
    <link href="http://pystack.org/2016/11/14/compile-virt-viewer-on-arm-platform/"/>
    <id>http://pystack.org/2016/11/14/compile-virt-viewer-on-arm-platform/</id>
    <published>2016-11-14T06:48:35.000Z</published>
    <updated>2017-11-16T01:57:48.252Z</updated>
    
    <content type="html"><![CDATA[<h2 id="libusb"><a href="#libusb" class="headerlink" title="libusb"></a>libusb</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure  --host=arm-linux</span><br><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure><h2 id="usbredir"><a href="#usbredir" class="headerlink" title="usbredir"></a>usbredir</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure  --host=arm-linux</span><br><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure><h2 id="spice-gtk"><a href="#spice-gtk" class="headerlink" title="spice-gtk"></a>spice-gtk</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure <span class="attribute">--host</span>=arm-linux <span class="attribute">--enable-usbredir</span>=<span class="literal">yes</span> <span class="attribute">--enable-smartcard</span>=<span class="literal">no</span> <span class="attribute">--with-gtk</span>=3.0</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="virt-viewer"><a href="#virt-viewer" class="headerlink" title="virt-viewer"></a>virt-viewer</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--host=arm-linux</span> <span class="params">--with-gtk=3</span>.0 <span class="params">--with-spice-gtk</span></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><ul><li>configure: error: cannot run C compiled programs.</li></ul><p>在ARM上编译需要指定host参数</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--host=arm-linux</span></span><br></pre></td></tr></table></figure><ul><li>configure: error: Your intltool is too old.  You need intltool 0.40.0 or later</li></ul><p><img src="/assets/img/intltool-too-old.png" alt=""></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install intltool</span><br></pre></td></tr></table></figure><ul><li>configure: error: Package requirements (spice-protocol &gt;= 0.12.10) were not met</li></ul><p><img src="/assets/img/spice-protocol-too-old.png" alt=""></p><p>下载最新版的spice-protocol（下载地址：<a href="https://packages.debian.org/search?keywords=spice-protocol&amp;searchon=names&amp;suite=all&amp;section=all" target="_blank" rel="external">https://packages.debian.org/search?keywords=spice-protocol&amp;searchon=names&amp;suite=all&amp;section=all</a>），并更新即可</p><ul><li>configure: error: Package requirements (openssl) were not met:</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install openssl</span><br><span class="line">apt-<span class="builtin-name">get</span> install libssl-dev</span><br></pre></td></tr></table></figure><ul><li>configure: error: Package requirements (gtk+-3.0 &gt;= 2.91.3) were not met</li></ul><p>checking for GTK… no<br>configure: error: Package requirements (gtk+-3.0 &gt;= 2.91.3) were not met:</p><p>No package ‘gtk+-3.0’ found</p><p>Consider adjusting the PKG_CONFIG_PATH environment variable if you<br>installed software in a non-standard prefix.</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install libgtk<span class="number">-3</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><ul><li>configure: error: libjpeg not found</li></ul><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install libjpeg-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><ul><li>configure: error: Package requirements (celt051 &gt;= 0.5.1.1) were not met</li></ul><p>下载celt051，并编译安装</p><ul><li>configure: error: Package requirements (libxml-2.0 &gt;= 2.6.0) were not met</li></ul><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install libxml2-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><ul><li>configure: error: spice-gtk requested but not found</li></ul><p>spice编译的有问题，ARM 默认使用/bin/sh，使用/bin/bash打包会有问题！！！    </p><ul><li>虚拟机 spice://192.168.13.11:5900 的未知图形类型</li></ul><p>这个是因为 ARM 版本 virt-viewer 默认只支持VNC的虚拟机，需要重新编译安装virt-viewer</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;libusb&quot;&gt;&lt;a href=&quot;#libusb&quot; class=&quot;headerlink&quot; title=&quot;libusb&quot;&gt;&lt;/a&gt;libusb&lt;/h2&gt;&lt;figure class=&quot;highlight gauss&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./configure  --host=arm-linux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt; install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;usbredir&quot;&gt;&lt;a href=&quot;#usbredir&quot; class=&quot;headerlink&quot; title=&quot;usbredir&quot;&gt;&lt;/a&gt;usbredir&lt;/h2&gt;&lt;figure class=&quot;highlight gauss&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./configure  --host=arm-linux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt; install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;spice-gtk&quot;&gt;&lt;a href=&quot;#spice-gtk&quot; class=&quot;headerlink&quot; title=&quot;spice-gtk&quot;&gt;&lt;/a&gt;spice-gtk&lt;/h2&gt;&lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./configure &lt;span class=&quot;attribute&quot;&gt;--host&lt;/span&gt;=arm-linux &lt;span class=&quot;attribute&quot;&gt;--enable-usbredir&lt;/span&gt;=&lt;span class=&quot;literal&quot;&gt;yes&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;--enable-smartcard&lt;/span&gt;=&lt;span class=&quot;literal&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;attribute&quot;&gt;--with-gtk&lt;/span&gt;=3.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Spice" scheme="http://pystack.org/categories/Spice/"/>
    
    
      <category term="Spice" scheme="http://pystack.org/tags/Spice/"/>
    
      <category term="Virt-viewer" scheme="http://pystack.org/tags/Virt-viewer/"/>
    
      <category term="ARM" scheme="http://pystack.org/tags/ARM/"/>
    
      <category term="Linux" scheme="http://pystack.org/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>使用MinGW编译Virt-Viewer</title>
    <link href="http://pystack.org/2016/11/13/compile-virt-viewer-with-mingw/"/>
    <id>http://pystack.org/2016/11/13/compile-virt-viewer-with-mingw/</id>
    <published>2016-11-13T06:48:35.000Z</published>
    <updated>2017-11-16T02:14:41.542Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Mingw简介"><a href="#Mingw简介" class="headerlink" title="Mingw简介"></a>Mingw简介</h3><p>MinGW是Minimalist GUN for Windows的缩写。MinGW提供了一套开发环境，用来开发Microsoft windows本地应用。</p><p>MinGW提供了一套完全开源的编程工具集，不需要依赖于第三方的C运行DLL，就可以开发Windows本地应用。当然MinGW还是依赖于microsoft提供的几个操作系统DLL，比如MSVCRT.DLL。</p><p>MinGW 编译器提供了对Microsoft C Runtime的以及一些语言特定runtimes的访问。MinGW的Minimalist，就体现在这里，MinGW没有尝试提供一个POSIX runtime 环境。</p><h3 id="安装Mingw编译环境"><a href="#安装Mingw编译环境" class="headerlink" title="安装Mingw编译环境"></a>安装Mingw编译环境</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install </span>mingw* libtool* auto-<span class="keyword">buildrequires </span>intltool glib2-devel icoutils msitools</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="编译安装usbredir"><a href="#编译安装usbredir" class="headerlink" title="编译安装usbredir"></a>编译安装usbredir</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libusb*</span><br><span class="line"></span><br><span class="line">mingw64-configure</span><br><span class="line">mingw64-make</span><br><span class="line">mingw64-make <span class="keyword">install</span></span><br></pre></td></tr></table></figure><h3 id="编译安装spice-gtk"><a href="#编译安装spice-gtk" class="headerlink" title="编译安装spice-gtk"></a>编译安装spice-gtk</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> pixman*</span><br><span class="line">yum <span class="keyword">install</span> openssl*</span><br><span class="line">yum <span class="keyword">install</span> gtk2-devel</span><br><span class="line">yum <span class="keyword">install</span> pulseaudio</span><br><span class="line">yum <span class="keyword">install</span> pulseaudio-devel</span><br><span class="line">yum <span class="keyword">install</span> pulseaudio-libs-devel</span><br><span class="line">yum <span class="keyword">install</span> libjpeg*</span><br><span class="line">yum <span class="keyword">install</span> libusb*</span><br><span class="line">yum <span class="keyword">install</span> usbredir*</span><br><span class="line">yum <span class="keyword">install</span> *gudev*</span><br><span class="line"></span><br><span class="line">mingw64-configure <span class="comment">--enable-usbredir=yes --enable-smartcard=no --with-gtk=3.0</span></span><br><span class="line">mingw64-make</span><br><span class="line">mingw64-make <span class="keyword">install</span></span><br></pre></td></tr></table></figure><h3 id="Virt-Viewer汉化"><a href="#Virt-Viewer汉化" class="headerlink" title="Virt-Viewer汉化"></a>Virt-Viewer汉化</h3><p>virtviewer使用的是gettex的方案是标准的linux里国际化的方案，只要在代码里设置好正确的locale，绑定好正确的textdomain就可以了。<br>对应的汉化文件为po/zh_CN.po，需要修改翻译内容，修改这个文件即可。</p><p>修改源码中virt-viewer-util.c文件的方法virt_viewer_util_init</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setlocale(<span class="name">LC_ALL</span>, <span class="string">"zh_CN"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>因为为windows系统，还需要修改国际化文件所在的目录（默认为Linux的/usr/share/locale）</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bindtextdomain(<span class="name">GETTEXT_PACKAGE</span>, <span class="string">"../share/locale/"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>这样即可完成对virt-viewer的汉化</p><h3 id="编译安装Virt-viewer"><a href="#编译安装Virt-viewer" class="headerlink" title="编译安装Virt-viewer"></a>编译安装Virt-viewer</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libxml*</span><br><span class="line">yum <span class="keyword">install</span> spice-gtk*</span><br><span class="line"></span><br><span class="line">mingw64-configure  <span class="comment">--with-gtk=3.0 --with-spice-gtk</span></span><br><span class="line">mingw64-make</span><br><span class="line">mingw64-make <span class="keyword">install</span></span><br></pre></td></tr></table></figure><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ul><li>glib-genmashal: command not found</li></ul><p><img src="images/glit-genmashal-not-found.png" alt="glit-genmashal not found"></p><p>这是因为缺少glib2-devel，yum安装一下就可以了</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> glib2-devel</span><br></pre></td></tr></table></figure><ul><li>Failed to create service named pipe</li></ul><p><img src="images/failed-to-create-pipe-service.png" alt="failed to create pipe service"></p><p>这是因为usbdk没有安装，到官网下载最新的usbdk安装即可，要注意的是windows7 64位系统，需要安装 <strong>Windows6.1-KB3033929-x64.msu</strong> 更新，否则会导致usb键盘鼠标都不能用！！！</p><p>USBDK下载地址：<a href="http://www.spice-space.org/download/windows/UsbDk/" target="_blank" rel="external">http://www.spice-space.org/download/windows/UsbDk/</a></p><ul><li>提示mingw-spice-protocal 版本太低</li></ul><p>只要下载新版本的mingw-spice-protocal更新一下就可以了</p><p>mingw-spice-protocol-0.12.11下载地址：<a href="http://koji.fedoraproject.org/koji/buildinfo?buildID=744124" target="_blank" rel="external">http://koji.fedoraproject.org/koji/buildinfo?buildID=744124</a></p><ul><li>Virt-Viewer菜单定制</li></ul><p>修改share\virt-viewer\ui\virt-viewer.xml文件，删除child，即可删除对应的菜单项</p><ul><li>修改标题栏</li></ul><p>修改 src\remote_viewer_main.c 文件，将 Remote Viewer改为其他字符串即可。</p><p>###　参考</p><blockquote><p><a href="http://blog.sina.com.cn/s/blog_7a9cc5930102wb7k.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_7a9cc5930102wb7k.html</a><br><a href="http://www.isjian.com/2015/08/spice-kvm-usbredir-qxl-2/" target="_blank" rel="external">http://www.isjian.com/2015/08/spice-kvm-usbredir-qxl-2/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Mingw简介&quot;&gt;&lt;a href=&quot;#Mingw简介&quot; class=&quot;headerlink&quot; title=&quot;Mingw简介&quot;&gt;&lt;/a&gt;Mingw简介&lt;/h3&gt;&lt;p&gt;MinGW是Minimalist GUN for Windows的缩写。MinGW提供了一套开发环境，用来开发Microsoft windows本地应用。&lt;/p&gt;
&lt;p&gt;MinGW提供了一套完全开源的编程工具集，不需要依赖于第三方的C运行DLL，就可以开发Windows本地应用。当然MinGW还是依赖于microsoft提供的几个操作系统DLL，比如MSVCRT.DLL。&lt;/p&gt;
&lt;p&gt;MinGW 编译器提供了对Microsoft C Runtime的以及一些语言特定runtimes的访问。MinGW的Minimalist，就体现在这里，MinGW没有尝试提供一个POSIX runtime 环境。&lt;/p&gt;
&lt;h3 id=&quot;安装Mingw编译环境&quot;&gt;&lt;a href=&quot;#安装Mingw编译环境&quot; class=&quot;headerlink&quot; title=&quot;安装Mingw编译环境&quot;&gt;&lt;/a&gt;安装Mingw编译环境&lt;/h3&gt;&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum &lt;span class=&quot;keyword&quot;&gt;install &lt;/span&gt;mingw* libtool* auto-&lt;span class=&quot;keyword&quot;&gt;buildrequires &lt;/span&gt;intltool glib2-devel icoutils msitools&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Spice" scheme="http://pystack.org/categories/Spice/"/>
    
    
      <category term="Spice" scheme="http://pystack.org/tags/Spice/"/>
    
      <category term="Virt-viewer" scheme="http://pystack.org/tags/Virt-viewer/"/>
    
      <category term="Linux" scheme="http://pystack.org/tags/Linux/"/>
    
      <category term="MinGW" scheme="http://pystack.org/tags/MinGW/"/>
    
  </entry>
  
  <entry>
    <title>Cloud Init notes</title>
    <link href="http://pystack.org/2016/06/14/cloud-init-notes/"/>
    <id>http://pystack.org/2016/06/14/cloud-init-notes/</id>
    <published>2016-06-14T03:39:24.000Z</published>
    <updated>2017-11-16T02:32:03.194Z</updated>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>User configurability Cloud-init ‘s behavior can be configured via user-data.</p><p>User-data can be given by the user at instance launch time.This is done via the –user-data or –user-data-file argument to ec2-run-instances for example.</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>cloud init 使用的前提是镜像中已经安装了cloud-init 包，如果使用python代码（三个双引号）动态生成 user-data，需要注意的是行前一定不要留有空格，否则脚本不能执行！</p><h3 id="执行shell脚本"><a href="#执行shell脚本" class="headerlink" title="执行shell脚本"></a>执行shell脚本</h3><p>Begins with: #! or Content-Type: text/x-shellscript when using a MIME archive.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat myscript.sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "Hello World.  The time is now $(date -R)!" | tee /root/output.txt</span><br></pre></td></tr></table></figure><a id="more"></a><p>修改ubuntu的默认密码，并开启ssh密码登录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">passwd ubuntu&lt;&lt;EOF</span><br><span class="line">ubuntu</span><br><span class="line">ubuntu</span><br><span class="line">EOF</span><br><span class="line">sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config</span><br><span class="line">service ssh restart</span><br></pre></td></tr></table></figure><h3 id="执行cloud-config配置"><a href="#执行cloud-config配置" class="headerlink" title="执行cloud-config配置"></a>执行cloud-config配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line"><span class="attr">ssh_pwauth:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">disable_root:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">chpasswd:</span></span><br><span class="line"><span class="attr">  expire:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>首先, 这个文件把一般云主机里面的 ssh 密码认证打开, 默认关闭的<br>然后, 通过 disable_root 允许 root 认证, 默认关闭<br>将 root 的密码设置为 abc123<br>如果不设置 chpasswd 的 expire 为 false, 那么登陆的时候会提示马上修改密码才能进去</p></blockquote><h3 id="同时传递多种格式-多个文件的-user-data"><a href="#同时传递多种格式-多个文件的-user-data" class="headerlink" title="同时传递多种格式/多个文件的 user-data"></a>同时传递多种格式/多个文件的 user-data</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/mixed; boundary="===============2197920354430400835=="</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line"></span><br><span class="line">--===============2197920354430400835==</span><br><span class="line">Content-Type: text/cloud-config; charset="us-ascii"</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename="cloudconfig.txt"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">cloud-config</span></span><br><span class="line">runcmd:</span><br><span class="line"> - touch /root/cloudconfig</span><br><span class="line"> - source: "ppa:smoser/ppa"</span><br><span class="line"></span><br><span class="line">--===============2197920354430400835==</span><br><span class="line">Content-Type: text/x-include-url; charset="us-ascii"</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename="includefile.txt"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> these urls will be <span class="built_in">read</span> pulled <span class="keyword">in</span> <span class="keyword">if</span> they were part of user-data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> comments are allowed.  The format is one url per line</span></span><br><span class="line">http://www.ubuntu.com/robots.txt</span><br><span class="line"></span><br><span class="line">--===============2197920354430400835==</span><br><span class="line">Content-Type: text/cloud-boothook; charset="us-ascii"</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename="boothook.txt"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "Hello World!"</span><br><span class="line"></span><br><span class="line">--===============2197920354430400835==</span><br><span class="line">Content-Type: text/x-shellscript; charset="us-ascii"</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Content-Disposition: attachment; filename="userscript.txt"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/perl</span></span><br><span class="line">print "This is a user script (rc.local)\n"</span><br><span class="line"></span><br><span class="line">--===============2197920354430400835==--</span><br></pre></td></tr></table></figure><p>C:/Program Files/Cloudbase Solutions/Vloudbase-Init/Python/Lib/site-packages/cloudbaseinit/conf/default.py</p><h3 id="无法获取控制台日志"><a href="#无法获取控制台日志" class="headerlink" title="无法获取控制台日志"></a>无法获取控制台日志</h3><p>如果无法获取到云主机日志，则需要修改grub文件配置</p><ul><li>ubuntu </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX="console=tty0 console=ttyS0,115200"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> update-grub           <span class="comment">#ubuntu</span></span></span><br></pre></td></tr></table></figure><ul><li>centos</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /boot/grub2/grub.cfg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># append "console=tty0 console=ttyS0,115200" to "CentOS ... (Core)" line</span></span></span><br></pre></td></tr></table></figure><h3 id="修改云主机domain"><a href="#修改云主机domain" class="headerlink" title="修改云主机domain"></a>修改云主机domain</h3><p>默认虚拟机的domain是novadomain，如果要自定义domain名称，需要修改nova的配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/nova/nova.conf</span></span><br><span class="line">dhcp_domain=testdomain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl restart openstack-nova-api.service</span></span><br></pre></td></tr></table></figure><h3 id="再次执行userdata"><a href="#再次执行userdata" class="headerlink" title="再次执行userdata"></a>再次执行userdata</h3><p>We can however fool cloud-init by letting it think the machine did a fresh first boot. We need to remove the following two files:</p><p>/var/lib/cloud/instances/$UUID/boot-finished<br>/var/lib/cloud/instances/$UUID/sem/config_scripts_user</p><p>Execute the following command to run the cloud-init final module again:</p><p>cloud-init modules –mode final<br>The final module will execute our user_data script again. Before every new test run you need to remove the two files listed above.</p><h2 id="User-and-Group-Management"><a href="#User-and-Group-Management" class="headerlink" title="User and Group Management"></a>User and Group Management</h2><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">users:</span><br><span class="line">  -<span class="ruby"> first_user_parameter</span></span><br><span class="line"><span class="ruby">    first_user_parameter</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  - second_user_parameter</span></span><br><span class="line"><span class="ruby">    second_user_parameter</span></span><br><span class="line"><span class="ruby">    second_user_parameter</span></span><br></pre></td></tr></table></figure><p>The following keys are available for definition:</p><p>name: The account username.<br>primary-group: The primary group of the user. By default, this will be a group created that matches the username. Any group specified here must already exist or must be created explicitly (we discuss this later in this section).<br>groups: Any supplementary groups can be listed here, separated by commas.<br>gecos: A field for supplementary info about the user.<br>shell: The shell that should be set for the user. If you do not set this, the very basic sh shell will be used.<br>expiredate: The date that the account should expire, in YYYY-MM-DD format.<br>sudo: The sudo string to use if you would like to define sudo privileges, without the username field.<br>lock-passwd: This is set to “True” by default. Set this to “False” to allow users to log in with a password.<br>passwd: A hashed password for the account.<br>ssh-authorized-keys: A list of complete SSH public keys that should be added to this user’s authorized_keys file in their .ssh directory.<br>inactive: A boolean value that will set the account to inactive.<br>system: If “True”, this account will be a system account with no home directory.<br>homedir: Used to override the default /home/<username>, which is otherwise created and set.<br>ssh-import-id: The SSH ID to import from LaunchPad.<br>selinux-user: This can be used to set the SELinux user that should be used for this account’s login.<br>no-create-home: Set to “True” to avoid creating a /home/<username> directory for the user.<br>no-user-group: Set to “True” to avoid creating a group with the same name as the user.<br>no-log-init: Set to “True” to not initiate the user login databases.</username></username></p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">groups:</span><br><span class="line">  -<span class="ruby"> group1</span></span><br><span class="line"><span class="ruby">  - <span class="symbol">group2:</span> [user1, user2]</span></span><br></pre></td></tr></table></figure><h2 id="Change-Passwords-for-Existing-Users"><a href="#Change-Passwords-for-Existing-Users" class="headerlink" title="Change Passwords for Existing Users"></a>Change Passwords for Existing Users</h2><p>For user accounts that already exist (the root account is the most pertinent), a password can be suppled by using the chpasswd directive.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line"><span class="attr">chpasswd:</span></span><br><span class="line"><span class="attr">  list:</span> <span class="string">|</span></span><br><span class="line"><span class="string"></span><span class="attr">    user1:</span><span class="string">password1</span></span><br><span class="line"><span class="attr">    user2:</span><span class="string">password2</span></span><br><span class="line"><span class="attr">    user3:</span><span class="string">password3</span></span><br><span class="line"><span class="attr">  expire:</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>One thing to note is that you can set a password to “RANDOM” or “R”, which will generate a random password and write it to /var/log/cloud-init-output.log. </p><h2 id="Write-Files-to-the-Disk"><a href="#Write-Files-to-the-Disk" class="headerlink" title="Write Files to the Disk"></a>Write Files to the Disk</h2><p>In order to write files to the disk, you should use the write_files directive.</p><p>The only required keys in this array are path, which defines where to write the file, and content, which contains the data you would like the file to contain.</p><p>The available keys for configuring a write_files item are:</p><p>path: The absolute path to the location on the filesystem where the file should be written.</p><p>content: The content that should be placed in the file. For multi-line input, you should start a block by using a pipe character (|) on the “content” line, followed by an indented block containing the content. Binary files should include “!!binary” and a space prior to the pipe character.</p><p>owner: The user account and group that should be given ownership of the file. These should be given in the “username:group” format.</p><p>permissions: The octal permissions set that should be given for this file.</p><p>encoding: An optional encoding specification for the file. This can be “b64” for Base64 files, “gzip” for Gzip compressed files, or “gz+b64” for a combination. Leaving this out will use the default, conventional file type.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">write_files:</span><br><span class="line">  - path: /test.txt</span><br><span class="line">    <span class="attribute">content</span>: |</span><br><span class="line">      Here is <span class="selector-tag">a</span> line.</span><br><span class="line">      Another line is here.</span><br></pre></td></tr></table></figure><h2 id="Update-or-Install-Packages-on-the-Server"><a href="#Update-or-Install-Packages-on-the-Server" class="headerlink" title="Update or Install Packages on the Server"></a>Update or Install Packages on the Server</h2><p>To update the apt database on Debian-based distributions, you should set the package_update directive to “true”. This is synonymous with calling apt-get update from the command line.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line"><span class="attr">package_update:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>If you wish to upgrade all of the packages on your server after it boots up for the first time, you can set the package_upgrade directive. This is akin to a apt-get upgrade executed manually.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cloud-config</span></span><br><span class="line"><span class="attr">package_upgrade:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>To install additional packages, you can simply list the package names using the “packages” directive. Each list item should represent a package. Unlike the two commands above, this directive will function with either yum or apt managed distros.</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">packages:</span><br><span class="line">  -<span class="ruby"> package_1</span></span><br><span class="line"><span class="ruby">  - package_2</span></span><br><span class="line"><span class="ruby">  - [package_3, version_num]</span></span><br></pre></td></tr></table></figure><p>The “packages” directive will set apt_update to true, overriding any previous setting.</p><h2 id="Configure-SSH-Keys-for-User-Accounts"><a href="#Configure-SSH-Keys-for-User-Accounts" class="headerlink" title="Configure SSH Keys for User Accounts"></a>Configure SSH Keys for User Accounts</h2><p>You can manage SSH keys in the users directive, but you can also specify them in a dedicated ssh_authorized_keys section. These will be added to the first defined user’s authorized_keys file.</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">ssh_authorized_keys:</span><br><span class="line">  -<span class="ruby"> ssh_key_1</span></span><br><span class="line"><span class="ruby">  - ssh_key_2</span></span><br></pre></td></tr></table></figure><p>You can also generate the SSH server’s private keys ahead of time and place them on the filesystem. This can be useful if you want to give your clients the information about this server beforehand, allowing it to trust the server as soon as it comes online.</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">ssh_keys:</span><br><span class="line">  rsa_private: |</span><br><span class="line">    -<span class="ruby">----<span class="keyword">BEGIN</span> RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="ruby">    your_rsa_private_key</span></span><br><span class="line"><span class="ruby">    -----<span class="keyword">END</span> RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">  <span class="symbol">rsa_public:</span> your_rsa_public_key</span></span><br></pre></td></tr></table></figure><h2 id="Configure-resolv-conf-to-Use-Specific-DNS-Servers"><a href="#Configure-resolv-conf-to-Use-Specific-DNS-Servers" class="headerlink" title="Configure resolv.conf to Use Specific DNS Servers"></a>Configure resolv.conf to Use Specific DNS Servers</h2><p>If you have configured your own DNS servers that you wish to use, you can manage your server’s resolv.conf file by using the resolv_conf directive. This currently only works for RHEL-based distributions.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">manage-resolv-conf: true</span><br><span class="line">resolv_conf:</span><br><span class="line">  nameservers:</span><br><span class="line">    - <span class="string">'first_nameserver'</span></span><br><span class="line">    - <span class="string">'second_nameserver'</span></span><br><span class="line">  searchdomains:</span><br><span class="line">    - first<span class="selector-class">.domain</span><span class="selector-class">.com</span></span><br><span class="line">    - second<span class="selector-class">.domain</span><span class="selector-class">.com</span></span><br><span class="line">  domain: domain.com</span><br><span class="line">  options:</span><br><span class="line">    option1: value1</span><br><span class="line">    option2: value2</span><br><span class="line">    option3: value3</span><br></pre></td></tr></table></figure><p>If you are using the resolv_conf directive, you must ensure that the manage-resolv-conf directive is also set to true. Not doing so will cause your settings to be ignored</p><h2 id="Run-Arbitrary-Commands-for-More-Control"><a href="#Run-Arbitrary-Commands-for-More-Control" class="headerlink" title="Run Arbitrary Commands for More Control"></a>Run Arbitrary Commands for More Control</h2><p>If none of the managed actions that cloud-config provides works for what you want to do, you can also run arbitrary commands. You can do this with the runcmd directive.</p><p>Any output will be written to standard out and to the /var/log/cloud-init-output.log file:</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">runcmd:</span><br><span class="line">  -<span class="ruby"> [ sed, -i, -e, <span class="string">'s/here/there/g'</span>, some_file]</span></span><br><span class="line"><span class="ruby">  - echo <span class="string">"modified some_file"</span></span></span><br><span class="line"><span class="ruby">  - [cat, some_file]</span></span><br></pre></td></tr></table></figure><h2 id="Shutdown-or-Reboot-the-Server"><a href="#Shutdown-or-Reboot-the-Server" class="headerlink" title="Shutdown or Reboot the Server"></a>Shutdown or Reboot the Server</h2><p>In some cases, you’ll want to shutdown or reboot your server after executing the other items. You can do this by setting up the power_state directive.</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#cloud-config</span></span><br><span class="line"><span class="symbol">power_state:</span></span><br><span class="line"><span class="symbol">  timeout:</span> <span class="number">120</span></span><br><span class="line"><span class="symbol">  delay:</span> <span class="string">"+5"</span></span><br><span class="line"><span class="symbol">  message:</span> Rebooting in five minutes. Please save your work.</span><br><span class="line"><span class="symbol">  mode:</span> reboot</span><br></pre></td></tr></table></figure><h1 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h1><p>Our adjusted strategy will look something like this:</p><p>Set no password and provide no SSH keys for the root account through cloud-config (any SSH keys added though the DigitalOcean interface will still be added as usual)<br>Create a new user<br>Set no password for the new user account<br>Set up SSH access for the new user account<br>Give the new user password-less sudo privileges to make administrative changes.<br>(Optional) Change the port the SSH daemon listens on<br>(Optional) Restrict root SSH login (especially if you do not include SSH keys through the DigitalOcean interface)<br>(Optional) Explicitly permit our new user</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line">users:</span><br><span class="line">  -<span class="ruby"> <span class="symbol">name:</span> demo</span></span><br><span class="line"><span class="ruby">    ssh-authorized-<span class="symbol">keys:</span></span></span><br><span class="line"><span class="ruby">      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCv60WjxoM39LgPDbiW7ne3gu18q0NIVv0RE6rDLNal1quXZ3nqAlANpl5qmhDQ+GS/sOtygSG4/<span class="number">9</span>aiOA4vXO54k1mHWL2irjuB9XbXr0<span class="number">0</span>+<span class="number">44</span>vSd2q/vtXdGXhdSMTf4/XK17fjKSG/<span class="number">9</span>y3yD6nml6q9XgQxx9Vf/IkaKdlK0hbC1ds<span class="number">0</span>+<span class="number">8</span>h83PTb9dF3L7hf3Ch/ghvj5++tWJFdFeG+VI7EDuKNA4zL8C5FdYYWFA88YAmM8ndjA5qCjZXIIeZvZ/z9Kpy6DL0QZ8T3NsxRKapEU3nyiIuEAmn8fbnosWcsovw0IS1Hz6HsjYo4bu/gA82LWt3sdRUBZ/<span class="number">7</span>ZsVD3ELip user@example.com</span></span><br><span class="line"><span class="ruby">    <span class="symbol">sudo:</span> [<span class="string">'ALL=(ALL) NOPASSWD:ALL'</span>]</span></span><br><span class="line"><span class="ruby">    <span class="symbol">groups:</span> sudo</span></span><br><span class="line"><span class="ruby">    <span class="symbol">shell:</span> /bin/bash</span></span><br><span class="line"><span class="ruby"><span class="symbol">runcmd:</span></span></span><br><span class="line"><span class="ruby">  - sed -i -e <span class="string">'/^Port/s/^.*$/Port 4444/'</span> /etc/ssh/sshd_config</span></span><br><span class="line"><span class="ruby">  - sed -i -e <span class="string">'/^PermitRootLogin/s/^.*$/PermitRootLogin no/'</span> /etc/ssh/sshd_config</span></span><br><span class="line"><span class="ruby">  - sed -i -e <span class="string">'$aAllowUsers demo'</span> /etc/ssh/sshd_config</span></span><br><span class="line"><span class="ruby">  - restart ssh</span></span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">########定制用户初始密码</span><br><span class="line"></span><br><span class="line">#cloud-config</span><br><span class="line">chpasswd:</span><br><span class="line">   list: |</span><br><span class="line">       root:<span class="number">123456</span></span><br><span class="line">       ubuntu:<span class="number">123456</span></span><br><span class="line">   expire: false</span><br><span class="line">ssh_pwauth: true    # [ <span class="literal">True</span>, <span class="literal">False</span>, <span class="string">""</span> or <span class="string">"unchanged"</span> ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">########安装软件</span><br><span class="line"># 一个办法是部署完后手动安装，另一个办法是通过 package-update-upgrade-install 模块让 cloud-init 自动为我们安装。</span><br><span class="line"></span><br><span class="line">#cloud-config</span><br><span class="line">apt:</span><br><span class="line"> primary:</span><br><span class="line">   - arches: [default]</span><br><span class="line">     search:</span><br><span class="line">       - http:<span class="comment">//1.2.3.4 </span></span><br><span class="line"></span><br><span class="line">packages:</span><br><span class="line">- pwgen</span><br><span class="line">- pastebinit</span><br><span class="line">- [libpython2<span class="number">.7</span>, <span class="number">2.7</span><span class="number">.3</span><span class="number">-0</span>ubuntu3<span class="number">.1</span>]</span><br><span class="line"></span><br><span class="line">说明如下：</span><br><span class="line">apt 指定安装源的位置，这里为 http:<span class="comment">//1.2.3.4 。如果是 yum 源则用 yum_repos 模块指定，具体用法可参看官网文档。</span></span><br><span class="line">packages 指定需要安装的软件包，还可以指定具体版本。</span><br><span class="line"><span class="keyword">instance</span> 启动后可看到 /etc/apt/sources.list 中安装源已经更新为http:<span class="comment">//1.2.3.4。</span></span><br></pre></td></tr></table></figure><h1 id="Cloud-Base-init"><a href="#Cloud-Base-init" class="headerlink" title="Cloud Base init"></a>Cloud Base init</h1><p>cloudbase-init </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ps1_sysnative   or   rem cmd</span></span><br><span class="line">net<span class="built_in"> user </span>&#123;username&#125; <span class="string">"&#123;password&#125;"</span> /<span class="builtin-name">add</span> /y</span><br><span class="line">net localgroup Administrators <span class="string">"&#123;username&#125;"</span> /<span class="builtin-name">add</span> /y</span><br><span class="line">net localgroup <span class="string">"Remote Desktop Users"</span> <span class="string">"&#123;username&#125;"</span> /<span class="builtin-name">add</span> /y</span><br><span class="line">net<span class="built_in"> user </span>&#123;username&#125; <span class="string">"&#123;password&#125;"</span></span><br></pre></td></tr></table></figure><h3 id="Adding-cloudbase-init-to-Windows-images"><a href="#Adding-cloudbase-init-to-Windows-images" class="headerlink" title="Adding cloudbase-init to Windows images"></a>Adding cloudbase-init to Windows images</h3><p>If you want to deploy Windows images, use the latest version of the cloudbase-init tool while creating the Windows image to support the OpenStack updates related to the network interface management of Windows images.</p><p>After the cloudbase-init installation, do not select the option to run sysprep.exe in the Finish page.</p><p>When you create the network, set the dns-nameservers and gateway parameters.</p><p>To speed up the IP address injection, when you create the image template, specify the metadata_services parameter in the cloudbase-init.conf file:<br>metadata_services= cloudbaseinit.metadata.services.configdrive.ConfigDriveService,<br>                    cloudbaseinit.metadata.services.httpservice.HttpService,<br>                    cloudbaseinit.metadata.services.ec2service.EC2Service,<br>                    cloudbaseinit.metadata.services.maasservice.MaaSHttpService</p><p>If you get the OS can not be restarted automatically message after changing the host name, use the latest cloudbase-init version.</p><p>You can configure cloudbase-init to set the password for a user. The user name is configured at image preparation time and cannot be modified at virtual machine creation time. You can specify a user name during cloudbase-init installation or in the cloudbase-init.conf file. If the user does not exist, a new user account is created at virtual machine initialization time. If there are multiple Windows users at image preparation time, at virtual machine initialization time the password is changed only for the user specified in the cloudbase-init configuration. The passwords for other users are not changed.</p><p>If cloudbase-init cannot run scripts during an instance boot, set the PowerShell execution policy to be unrestricted:</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">C</span>:\powershell</span><br><span class="line">PS <span class="keyword">C</span>:\<span class="keyword">Set</span>-ExecutionPolicy Unrestricted</span><br></pre></td></tr></table></figure><h3 id="OpenStack-Networking-without-DHCP"><a href="#OpenStack-Networking-without-DHCP" class="headerlink" title="OpenStack Networking without DHCP"></a>OpenStack Networking without DHCP</h3><p>In an OpenStack environment, cloud-init generally fetches information from the metadata service provided by Nova. It also has support for reading this information from a configuration drive, which under OpenStack means a virtual CD-ROM device attached to your instance containing the same information that would normally be available via the metadata service.</p><p>It is possible to generate your network configuration from this configuration drive, rather than relying on the DHCP server provided by your OpenStack environment. In order to do this you will need to make the following changes to your Nova configuration:</p><ol><li><p>You must be using a subnet that does have a DHCP server. This means that you have created it using neutron subnet-create –disable-dhcp …, or that you disabled DHCP on an existing network using neutron net-update –disable-dhcp ….</p></li><li><p>You must set flat_inject to true in /etc/nova/nova.conf. This causes Nova to embed network configuration information in the meta-data embedded on the configuration drive.</p></li><li><p>You must ensure that injected_network_template in /etc/nova/nova.conf points to an appropriately formatted template.</p></li></ol><p>A template similar to the following ought to be sufficient:</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for <span class="class"><span class="keyword">interface</span> <span class="title">in</span> interfaces %&#125;</span></span><br><span class="line"><span class="class">auto </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">name</span> &#125;&#125;</span></span><br><span class="line"><span class="class">iface </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">name</span> &#125;&#125; inet static</span></span><br><span class="line"><span class="class">  address </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">address</span> &#125;&#125;</span></span><br><span class="line"><span class="class">  netmask </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">netmask</span> &#125;&#125;</span></span><br><span class="line"><span class="class">  broadcast </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">broadcast</span> &#125;&#125;</span></span><br><span class="line"><span class="class">  gateway </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">gateway</span> &#125;&#125;</span></span><br><span class="line"><span class="class">  dns-nameservers </span>&#123;&#123; <span class="class"><span class="keyword">interface</span>.<span class="title">dns</span> &#125;&#125;</span></span><br><span class="line"><span class="class"></span>&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>This will directly populate /etc/network/interfaces on an Ubuntu system, or will get translated into /etc/sysconfig/network-scripts/ifcfg-eth0 on a RHEL system (a RHEL environment can only configure a single network interface using this mechanism).</p><h2 id="Datasource"><a href="#Datasource" class="headerlink" title="Datasource"></a>Datasource</h2><p>尽量不要直接使用官方的源 ， 而是自己制作 ， 尤其是 cloud-init 的配置项 ， 要手动修改掉其默认的数据源  。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">datasource_list:</span> [<span class="string">'ConfigDrive'</span>, <span class="string">'OpenStack'</span>, <span class="string">'Ec2'</span>]</span><br></pre></td></tr></table></figure><h3 id="Config-Drive-Version-2"><a href="#Config-Drive-Version-2" class="headerlink" title="Config Drive Version 2"></a>Config Drive Version 2</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openstack/</span><br><span class="line">  -<span class="ruby"> <span class="number">2012</span>-08-<span class="number">10</span>/ <span class="keyword">or</span> latest/</span></span><br><span class="line"><span class="ruby">    - meta_data.json</span></span><br><span class="line"><span class="ruby">    - user_data (<span class="keyword">not</span> mandatory)</span></span><br><span class="line"><span class="ruby">  - content/</span></span><br><span class="line"><span class="ruby">    - <span class="number">0000</span> (referenced content files)</span></span><br><span class="line"><span class="ruby">    - <span class="number">0001</span></span></span><br><span class="line"><span class="ruby">    - ....</span></span><br></pre></td></tr></table></figure><h3 id="OpenStack"><a href="#OpenStack" class="headerlink" title="OpenStack"></a>OpenStack</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#cloud-config</span></span><br><span class="line"><span class="symbol">datasource:</span></span><br><span class="line"><span class="symbol">  OpenStack:</span></span><br><span class="line"><span class="symbol">    metadata_urls:</span> [<span class="string">"http://169.254.169.254"</span>]</span><br><span class="line"><span class="symbol">    max_wait:</span> <span class="number">-1</span></span><br><span class="line"><span class="symbol">    timeout:</span> <span class="number">10</span></span><br><span class="line"><span class="symbol">    retries:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p>metadata_urls: This list of urls will be searched for an OpenStack metadata service. The first entry that successfully returns a 200 response for <url>/openstack will be selected. (default: [‘<a href="http://169.254.169.254‘" target="_blank" rel="external">http://169.254.169.254‘</a>]).</url></p><p>max_wait: the maximum amount of clock time in seconds that should be spent searching metadata_urls. A value less than zero will result in only one request being made, to the first in the list. (default: -1)</p><p>timeout: the timeout value provided to urlopen for each individual http request. This is used both when selecting a metadata_url and when crawling the metadata service. (default: 10)</p><p>retries: The number of retries that should be done for an http request. This value is used only after metadata_url is selected. (default: 5)</p><h4 id="cloudinit-script"><a href="#cloudinit-script" class="headerlink" title="cloudinit script"></a>cloudinit script</h4><p>/var/lib/cloud/instance/</p><h3 id="下次启动不强制重新设置密码"><a href="#下次启动不强制重新设置密码" class="headerlink" title="下次启动不强制重新设置密码"></a>下次启动不强制重新设置密码</h3><p>这个功能默认是打开的，要关闭下次启动强制重新设置密码需要修改\PATH\TO\Cloudbase Solutions\Cloubase-Init\Python\Lib\site-packages\cloudbaseinit\plugins\common\setuserpassword.py：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_set_password</span><span class="params">(<span class="keyword">self</span>, service, osutils, user_name, shared_data)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">if</span> service.can_update_password <span class="keyword">and</span> <span class="keyword">not</span> service.is_password_changed()<span class="symbol">:</span></span><br><span class="line">        LOG.info(<span class="string">'Updating password is not required.'</span>)</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    password, injected = <span class="keyword">self</span>._get_password(service, shared_data)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="symbol">password:</span></span><br><span class="line">        LOG.debug(<span class="string">'Generating a random user password'</span>)</span><br><span class="line">        maximum_length = osutils.get_maximum_password_length()</span><br><span class="line">        password = osutils.generate_random_password(</span><br><span class="line">            maximum_length)</span><br><span class="line"></span><br><span class="line">    osutils.set_user_password(user_name, password)</span><br><span class="line">    <span class="comment"># self._change_logon_behaviour(user_name, password_injected=injected)</span></span><br><span class="line">    <span class="keyword">return</span> password</span><br></pre></td></tr></table></figure><h3 id="不传入admin-pass不使用随机密码"><a href="#不传入admin-pass不使用随机密码" class="headerlink" title="不传入admin_pass不使用随机密码"></a>不传入admin_pass不使用随机密码</h3><p>默认情况下，装了 Cloudbase-Init 在不传入admin_pass启动虚拟机，将会使用随机密码。要取消使用随机密码需要修改\PATH\TO\Cloudbase Solutions\Cloubase-Init\Python\Lib\site-packages\cloudbaseinit\plugins\common\setuserpassword.py：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_set_password</span><span class="params">(<span class="keyword">self</span>, service, osutils, user_name, shared_data)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">if</span> service.can_update_password <span class="keyword">and</span> <span class="keyword">not</span> service.is_password_changed()<span class="symbol">:</span></span><br><span class="line">        LOG.info(<span class="string">'Updating password is not required.'</span>)</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    password, injected = <span class="keyword">self</span>._get_password(service, shared_data)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="symbol">password:</span></span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line">        <span class="comment"># LOG.debug('Generating a random user password')</span></span><br><span class="line">        <span class="comment"># maximum_length = osutils.get_maximum_password_length()</span></span><br><span class="line">        <span class="comment"># password = osutils.generate_random_password(</span></span><br><span class="line">            maximum_length)</span><br><span class="line"></span><br><span class="line">    osutils.set_user_password(user_name, password)</span><br><span class="line">    <span class="keyword">self</span>._change_logon_behaviour(user_name, password_injected=injected)</span><br><span class="line">    <span class="keyword">return</span> password</span><br></pre></td></tr></table></figure><h3 id="windows开机不自动重启"><a href="#windows开机不自动重启" class="headerlink" title="windows开机不自动重启"></a>windows开机不自动重启</h3><p>修改\PATH\TO\Cloudbase Solutions\Cloubase-Init\Python\Lib\site-packages\cloudbaseinit\init.py</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def configure_host(self):</span><br><span class="line">    ......</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> reboot_required and <span class="keyword">CONF</span>.allow_reboot:</span><br><span class="line">        try:</span><br><span class="line">            <span class="keyword">LOG</span>.info(<span class="string">"Rebooting"</span>)</span><br><span class="line">            # osutils.reboot()</span><br><span class="line">        except Exception <span class="keyword">as</span> <span class="keyword">ex</span>:</span><br><span class="line">            <span class="keyword">LOG</span>.<span class="keyword">error</span>('reboot failed with <span class="keyword">error</span> \'%s\'' % <span class="keyword">ex</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">LOG</span>.info(<span class="string">"Plugins execution done"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">CONF</span>.stop_service_on_exit:</span><br><span class="line">            <span class="keyword">LOG</span>.info(<span class="string">"Stopping Cloudbase-Init service"</span>)</span><br><span class="line">            osutils.terminate()</span><br></pre></td></tr></table></figure><h3 id="sudo-命令执行的很慢，很久才出现密码输入"><a href="#sudo-命令执行的很慢，很久才出现密码输入" class="headerlink" title="sudo 命令执行的很慢，很久才出现密码输入"></a>sudo 命令执行的很慢，很久才出现密码输入</h3><p>解决方法很简单: (1)获取你的主机名:hostname (2)vi /etc/hosts 在里面加一个:127.0.0.1 主机名 问题解决啦!</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h2&gt;&lt;p&gt;User configurability Cloud-init ‘s behavior can be configured via user-data.&lt;/p&gt;
&lt;p&gt;User-data can be given by the user at instance launch time.This is done via the –user-data or –user-data-file argument to ec2-run-instances for example.&lt;/p&gt;
&lt;h2 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerlink&quot; title=&quot;使用&quot;&gt;&lt;/a&gt;使用&lt;/h2&gt;&lt;p&gt;cloud init 使用的前提是镜像中已经安装了cloud-init 包，如果使用python代码（三个双引号）动态生成 user-data，需要注意的是行前一定不要留有空格，否则脚本不能执行！&lt;/p&gt;
&lt;h3 id=&quot;执行shell脚本&quot;&gt;&lt;a href=&quot;#执行shell脚本&quot; class=&quot;headerlink&quot; title=&quot;执行shell脚本&quot;&gt;&lt;/a&gt;执行shell脚本&lt;/h3&gt;&lt;p&gt;Begins with: #! or Content-Type: text/x-shellscript when using a MIME archive.&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; cat myscript.sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &quot;Hello World.  The time is now $(date -R)!&quot; | tee /root/output.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="cloud-init" scheme="http://pystack.org/tags/cloud-init/"/>
    
      <category term="openstack" scheme="http://pystack.org/tags/openstack/"/>
    
      <category term="cloudbase-init" scheme="http://pystack.org/tags/cloudbase-init/"/>
    
  </entry>
  
  <entry>
    <title>为Instance添加监控页面</title>
    <link href="http://pystack.org/2016/03/26/add-monitoring-page-for-openstack-instance/"/>
    <id>http://pystack.org/2016/03/26/add-monitoring-page-for-openstack-instance/</id>
    <published>2016-03-26T13:39:24.000Z</published>
    <updated>2017-11-27T10:06:03.709Z</updated>
    
    <content type="html"><![CDATA[<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol><li>在html页面加入图表div</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"instance_id"</span> hidden=<span class="string">"hidden"</span>&gt;&#123;&#123; instance.<span class="built_in">id</span> &#125;&#125;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"monitor"</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"cpucontainer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"ramcontainer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"diskcontainer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"diskiocontainer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"netiocontainer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><ol><li>在js文件中自定义图表（使用Highcharts）</li></ol><a id="more"></a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">customGaugeChart</span><span class="params">(containerId, min, max, title, series_name, series_data)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    chart = <span class="keyword">new</span> Highcharts.Chart(&#123;</span></span><br><span class="line"><span class="undefined">            chart: &#123;</span></span><br><span class="line"><span class="undefined">                renderTo: containerId,</span></span><br><span class="line"><span class="actionscript">                type: <span class="string">"gauge"</span>,</span></span><br><span class="line"><span class="actionscript">                plotBackgroundColor: <span class="literal">null</span>,</span></span><br><span class="line"><span class="actionscript">                plotBackgroundImage: <span class="literal">null</span>,</span></span><br><span class="line"><span class="undefined">                plotBorderWidth: 0,</span></span><br><span class="line"><span class="actionscript">                plotShadow: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            title: &#123;</span></span><br><span class="line"><span class="undefined">                text: title</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            credits: &#123;</span></span><br><span class="line"><span class="actionscript">                enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            pane: &#123;</span></span><br><span class="line"><span class="undefined">                startAngle: -150,</span></span><br><span class="line"><span class="undefined">                endAngle: 150</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            yAxis: &#123;</span></span><br><span class="line"><span class="undefined">                min: min,</span></span><br><span class="line"><span class="undefined">                max: max,</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">                minorTickInterval: <span class="string">'auto'</span>,</span></span><br><span class="line"><span class="undefined">                minorTickWidth: 1,</span></span><br><span class="line"><span class="undefined">                minorTickLength: 10,</span></span><br><span class="line"><span class="actionscript">                minorTickPosition: <span class="string">'inside'</span>,</span></span><br><span class="line"><span class="actionscript">                minorTickColor: <span class="string">'#666'</span>,</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                tickPixelInterval: 30,</span></span><br><span class="line"><span class="undefined">                tickWidth: 2,</span></span><br><span class="line"><span class="actionscript">                tickPosition: <span class="string">'inside'</span>,</span></span><br><span class="line"><span class="undefined">                tickLength: 10,</span></span><br><span class="line"><span class="actionscript">                tickColor: <span class="string">'#666'</span>,</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                labels: &#123;</span></span><br><span class="line"><span class="undefined">                    step: 2,</span></span><br><span class="line"><span class="actionscript">                    rotation: <span class="string">'auto'</span></span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="undefined">                title: &#123;</span></span><br><span class="line"><span class="actionscript">                    text: <span class="string">''</span></span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="undefined">                plotBands: [&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">from</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">                    to: <span class="built_in">parseInt</span>(<span class="number">0.6</span> * max),</span></span><br><span class="line"><span class="actionscript">                    color: <span class="string">'#55BF3B'</span> <span class="comment">// green</span></span></span><br><span class="line"><span class="undefined">                &#125;, &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">from</span>: <span class="built_in">parseInt</span>(<span class="number">0.6</span> * max),</span></span><br><span class="line"><span class="javascript">                    to: <span class="built_in">parseInt</span>(<span class="number">0.8</span> * max),</span></span><br><span class="line"><span class="actionscript">                    color: <span class="string">'#DDDF0D'</span> <span class="comment">// yellow</span></span></span><br><span class="line"><span class="undefined">                &#125;, &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">from</span>: <span class="built_in">parseInt</span>(<span class="number">0.8</span> * max),</span></span><br><span class="line"><span class="undefined">                    to: max,</span></span><br><span class="line"><span class="actionscript">                    color: <span class="string">'#DF5353'</span> <span class="comment">// red</span></span></span><br><span class="line"><span class="undefined">                &#125;]</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            series: [&#123;</span></span><br><span class="line"><span class="undefined">                name: series_name,</span></span><br><span class="line"><span class="undefined">                data: series_data,</span></span><br><span class="line"><span class="undefined">                tooltip: &#123;</span></span><br><span class="line"><span class="actionscript">                    valueSuffix: <span class="string">'%'</span></span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;]</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span><span class="params">(chart)</span> </span>&#123;&#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> chart;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">customSplineChart</span><span class="params">(containerId, title, ytitle, series_name)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    chart = <span class="keyword">new</span> Highcharts.Chart(&#123;</span></span><br><span class="line"><span class="undefined">        chart: &#123;</span></span><br><span class="line"><span class="undefined">            renderTo: containerId,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'spline'</span>,</span></span><br><span class="line"><span class="undefined">            animation: Highcharts.svg,</span></span><br><span class="line"><span class="undefined">            marginRight: 10</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        title: &#123;</span></span><br><span class="line"><span class="undefined">            text: title</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        credits: &#123;</span></span><br><span class="line"><span class="actionscript">            enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        xAxis: &#123;</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'datetime'</span>,</span></span><br><span class="line"><span class="undefined">            tickPixelInterval: 150</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        yAxis: &#123;</span></span><br><span class="line"><span class="undefined">            title: &#123;</span></span><br><span class="line"><span class="undefined">                text: ytitle</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            plotLines: [&#123;</span></span><br><span class="line"><span class="undefined">                value: 0,</span></span><br><span class="line"><span class="undefined">                width: 1,</span></span><br><span class="line"><span class="actionscript">                color: <span class="string">'#808080'</span></span></span><br><span class="line"><span class="undefined">            &#125;]</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        tooltip: &#123;</span></span><br><span class="line"><span class="actionscript">            formatter: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> <span class="string">'&lt;b&gt;'</span> + <span class="keyword">this</span>.series.name + <span class="string">'&lt;/b&gt;&lt;br/&gt;'</span> +</span></span><br><span class="line"><span class="actionscript">                    Highcharts.dateFormat(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, <span class="keyword">this</span>.x) + <span class="string">'&lt;br/&gt;'</span> +</span></span><br><span class="line"><span class="actionscript">                    Highcharts.numberFormat(<span class="keyword">this</span>.y, <span class="number">2</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        legend: &#123;</span></span><br><span class="line"><span class="actionscript">            enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        exporting: &#123;</span></span><br><span class="line"><span class="actionscript">            enabled: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        series: [&#123;</span></span><br><span class="line"><span class="undefined">            name: series_name,</span></span><br><span class="line"><span class="actionscript">            data: (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// generate an array of random data</span></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">var</span> data = [],</span></span><br><span class="line"><span class="javascript">                    time = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(),</span></span><br><span class="line"><span class="undefined">                    i;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">                <span class="keyword">for</span> (i = <span class="number">-60</span>; i &lt;= <span class="number">0</span>; i++) &#123;</span></span><br><span class="line"><span class="undefined">                    data.push(&#123;</span></span><br><span class="line"><span class="undefined">                        x: time + i * 1000,</span></span><br><span class="line"><span class="undefined">                        y: 0</span></span><br><span class="line"><span class="undefined">                    &#125;);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> data;</span></span><br><span class="line"><span class="undefined">            &#125;)()</span></span><br><span class="line"><span class="undefined">        &#125;]</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> chart;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    Highcharts.setOptions(&#123;</span></span><br><span class="line"><span class="undefined">        global: &#123;</span></span><br><span class="line"><span class="actionscript">            useUTC: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> cpuchart = customGaugeChart(<span class="string">"cpucontainer"</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="string">"CPU Usage"</span>, <span class="string">"usage"</span>, [<span class="number">0</span>]);</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> ramchart = customGaugeChart(<span class="string">"ramcontainer"</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="string">"RAM Usage"</span>, <span class="string">"usage"</span>, [<span class="number">0</span>]);</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> diskchart = customGaugeChart(<span class="string">"diskcontainer"</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="string">"Disk Usage"</span>, <span class="string">"usage"</span>, [<span class="number">0</span>]);</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> diskiochart = customSplineChart(<span class="string">"diskiocontainer"</span>, <span class="string">"Disk I/O"</span>, <span class="string">"Unit(kbps)"</span>, <span class="string">"disk i/o"</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> netiochart = customSplineChart(<span class="string">"netiocontainer"</span>, <span class="string">"Network I/O"</span>, <span class="string">"Unit(kbps)"</span>, <span class="string">"network i/o"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> cpuseries = cpuchart.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> ramseries = ramchart.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> diskseries = diskchart.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> diskioseries = diskiochart.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> netioseries = netiochart.series[<span class="number">0</span>];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> x = (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ins_id = $(<span class="string">"#instance_id"</span>).text();</span></span><br><span class="line"><span class="javascript">        $.get(<span class="string">"/project/instances/"</span> + ins_id + <span class="string">"/get_instence_usage"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            cpuseries.points[<span class="number">0</span>].update(<span class="built_in">parseInt</span>(data));</span></span><br><span class="line"><span class="javascript">            ramseries.points[<span class="number">0</span>].update(<span class="built_in">parseInt</span>(data));</span></span><br><span class="line"><span class="javascript">            diskseries.points[<span class="number">0</span>].update(<span class="built_in">parseInt</span>(data));</span></span><br><span class="line"><span class="javascript">            diskioseries.addPoint([x, <span class="built_in">parseInt</span>(data)], <span class="literal">true</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            netioseries.addPoint([x, <span class="built_in">parseInt</span>(data)], <span class="literal">true</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;, 2000);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>在urls.py中添加ajax需要调用的地址</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">url</span><span class="params">(INSTANCES % <span class="string">'get_instence_usage'</span>, <span class="string">"get_instence_usage"</span>, name=<span class="string">'get_instence_usage'</span>)</span></span>,</span><br></pre></td></tr></table></figure><ol><li>在views.py中添加方法获取云主机信息</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_instence_usage</span><span class="params">(request, instance_id)</span>:</span></span><br><span class="line">    <span class="comment">#<span class="doctag">TODO:</span> Get data from ceilometer</span></span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(randint(<span class="number">1</span>,<span class="number">100</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;在html页面加入图表div&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;instance_id&quot;&lt;/span&gt; hidden=&lt;span class=&quot;string&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&amp;gt;&amp;#123;&amp;#123; instance.&lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt; &amp;#125;&amp;#125;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;monitor&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;cpucontainer&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;ramcontainer&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;diskcontainer&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;diskiocontainer&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;netiocontainer&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/&lt;span class=&quot;keyword&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;在js文件中自定义图表（使用Highcharts）&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="ceilometer" scheme="http://pystack.org/tags/ceilometer/"/>
    
      <category term="highcharts" scheme="http://pystack.org/tags/highcharts/"/>
    
  </entry>
  
  <entry>
    <title>KVM Windows7设备管理器与任务管理器示CPU核数不一致</title>
    <link href="http://pystack.org/2016/03/21/kwm-windows7-cpus-is-inconsistent/"/>
    <id>http://pystack.org/2016/03/21/kwm-windows7-cpus-is-inconsistent/</id>
    <published>2016-03-21T13:39:24.000Z</published>
    <updated>2017-11-27T10:04:27.628Z</updated>
    
    <content type="html"><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>使用kvm创建Windows7 x64镜像，上传到openstack，创建云主机后发现系统内的CPU核数和分配的核数不一致。</p><p>启动命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvm -m 2048 -smp 4 -drive <span class="attribute">file</span>=win7_x64_pure,if=virtio -net nic,<span class="attribute">model</span>=virtio -net<span class="built_in"> user </span>-usb -usbdevice tablet -soundhw ac97 -vga qxl -boot d -nographic -vnc :0</span><br></pre></td></tr></table></figure><p>任务管理器：</p><a id="more"></a><p><img src="/assets/img/image-tm.png" alt=""></p><p>计算机基本信息：</p><p><img src="/assets/img/image-si.png" alt=""></p><p>设备管理器：</p><p><img src="/assets/img/image-cm.png" alt=""></p><p>首先想到的是引导时处理器数量做了限制，但是打开引导高级选项的时候发现“处理器数”前面并没有勾上</p><p><img src="/assets/img/image-sc.png" alt=""></p><p>然后我查看注册表，发现CPU也只有两个，并不是分配的4个</p><p><img src="/assets/img/image-reg.png" alt=""></p><p>检查到这里我以为是我镜像做的有问题，我做镜像的那台机器是两核的，所以做出来的镜像最多也只能支持两个CPU， 但是细想一下其实是没有道理的。</p><p>后来查了资料之后发现是 windows7 自己的问题</p><blockquote><p>Commercial servers, workstations, and other high-end PCs may have more than one physical processor. Windows 7 Professional, Enterprise, and Ultimate allow for two physical processors, providing the best performance on these computers. Windows 7 Starter, Home Basic, and Home Premium will recognize only one physical processor.</p></blockquote><p>继续查openstack资料后发现max_sockets为4，smp 4 其实等价于 -smp 4,sockets=4,cores=1,threads=1，但是windows7 最多支持两个物理cpu，所以导致的结果就是虚拟机内只能使用两个</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def get_guest_cpu_topology(self, inst_type, image, preferred_topology, mandatory_topology):</span><br><span class="line">    """:inst_type: object returned from a self.virtapi.instance_type_get() call. Used <span class="keyword">to</span> determine <span class="keyword">max</span> vCPU <span class="keyword">count</span></span><br><span class="line">        :image_meta: the metadata dict <span class="keyword">for</span> the root disk image</span><br><span class="line">        :preferred_topology: dict containing three <span class="keyword">keys</span>: max_sockets, max_cores, max_threads</span><br><span class="line">        :mandatory_topology: dict containing three <span class="keyword">keys</span>: max_sockets, max_cores, max_threads</span><br><span class="line"></span><br><span class="line">         Calculate the <span class="keyword">list</span> <span class="keyword">of</span> all possible valid topologies <span class="keyword">for</span> configuring guest machine</span><br><span class="line">         CPU topology <span class="keyword">within</span> the given constraints. The caller should <span class="keyword">choose</span> one <span class="keyword">element</span></span><br><span class="line">         <span class="keyword">from</span> the returned <span class="keyword">list</span> <span class="keyword">to</span> <span class="keyword">use</span> <span class="keyword">as</span> the topology. The returned <span class="keyword">list</span> will be ordered such</span><br><span class="line">         that it prefers sockets, <span class="keyword">over</span> cores, <span class="keyword">over</span> threads. </span><br><span class="line"></span><br><span class="line">         <span class="keyword">Returns</span> <span class="keyword">list</span> <span class="keyword">of</span> dicts. <span class="keyword">Each</span> dict containing three <span class="keyword">keys</span>: sockets, cores, threads<span class="string">"""</span></span><br></pre></td></tr></table></figure><p>所以正确的方式应该是将max_sockets改为2，通过更改cores或者threads来实现多核</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kvm -m 2048 -smp 4,<span class="attribute">sockets</span>=2,cores=1,threads=2 -drive <span class="attribute">file</span>=win7_x64_pure,if=virtio -net nic,<span class="attribute">model</span>=virtio -net<span class="built_in"> user </span>-usb -usbdevice tablet -soundhw ac97 -vga qxl -boot d -nographic -vnc :0</span><br></pre></td></tr></table></figure><p><img src="/assets/img/image-cinfo-ok.png" alt=""></p><p>参考文档： <a href="https://wiki.openstack.org/wiki/VirtDriverGuestCPUTopology" target="_blank" rel="external">Virtualization Driver Guest CPU Topology</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h3&gt;&lt;p&gt;使用kvm创建Windows7 x64镜像，上传到openstack，创建云主机后发现系统内的CPU核数和分配的核数不一致。&lt;/p&gt;
&lt;p&gt;启动命令：&lt;/p&gt;
&lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;kvm -m 2048 -smp 4 -drive &lt;span class=&quot;attribute&quot;&gt;file&lt;/span&gt;=win7_x64_pure,if=virtio -net nic,&lt;span class=&quot;attribute&quot;&gt;model&lt;/span&gt;=virtio -net&lt;span class=&quot;built_in&quot;&gt; user &lt;/span&gt;-usb -usbdevice tablet -soundhw ac97 -vga qxl -boot d -nographic -vnc :0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;任务管理器：&lt;/p&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="Windows" scheme="http://pystack.org/tags/Windows/"/>
    
      <category term="KVM" scheme="http://pystack.org/tags/KVM/"/>
    
  </entry>
  
  <entry>
    <title>创建私有YUM源</title>
    <link href="http://pystack.org/2016/01/14/create-your-own-yum-repository/"/>
    <id>http://pystack.org/2016/01/14/create-your-own-yum-repository/</id>
    <published>2016-01-14T02:36:12.000Z</published>
    <updated>2017-11-27T10:04:50.572Z</updated>
    
    <content type="html"><![CDATA[<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>创建YUM源的步骤和创建apt-get源的步骤一样。</p><ol><li>Install “createrepo”, httpd</li><li>Create Repository directory &amp; Copy Packages to apache web directory</li><li>Run “createrepo”</li><li>Create YUM Repository Configuration file</li></ol><h3 id="开启yum缓存"><a href="#开启yum缓存" class="headerlink" title="开启yum缓存"></a>开启yum缓存</h3><p>需要将 keepcache 的值设置为 1 , 缓存下来的包可以在 /var/cache/yum/x86_64/7/base/packages/ 目录中看到。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/yum.conf</span><br><span class="line">keepcache=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"># yum install vim -y</span><br><span class="line"></span><br><span class="line"># ls /var/cache/yum/x86_64/<span class="number">7</span>/base/packages/</span><br><span class="line">gpm-libs<span class="number">-1.20</span><span class="number">.7</span><span class="number">-5.</span>el7.x86_64.rpm      perl-libs<span class="number">-5.16</span><span class="number">.3</span><span class="number">-286.</span>el7.x86_64.rpm             perl-Storable<span class="number">-2.45</span><span class="number">-3.</span>el7.x86_64.rpm</span><br><span class="line">perl<span class="number">-5.16</span><span class="number">.3</span><span class="number">-286.</span>el7.x86_64.rpm       </span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Install-“createrepo”"><a href="#Install-“createrepo”" class="headerlink" title="Install “createrepo”"></a>Install “createrepo”</h3><p>安装工具包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install createrepo -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install httpd -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl start httpd.service</span></span><br></pre></td></tr></table></figure><h3 id="Create-Repository-directory-amp-Copy-Packages"><a href="#Create-Repository-directory-amp-Copy-Packages" class="headerlink" title="Create Repository directory &amp; Copy Packages"></a>Create Repository directory &amp; Copy Packages</h3><p>将所有的rpm包拷贝到apache的web目录下面，并且保证别的机器能够访问到。</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /<span class="built_in">var</span>/www/html/rpms/amd64</span><br><span class="line"># cp /<span class="built_in">var</span>/cache/yum/x86_64/<span class="number">7</span>/<span class="built_in">base</span>/packages/*.rpm /<span class="built_in">var</span>/www/html/rpms/amd64</span><br></pre></td></tr></table></figure><p>拷贝完成后，可以通过浏览器测试一下是否能够正常访问。</p><p><img src="/assets/img/rpms-in-apache.png" alt=""></p><h3 id="Run-“createrepo”"><a href="#Run-“createrepo”" class="headerlink" title="Run “createrepo”"></a>Run “createrepo”</h3><p>运行 createrepo 会创建一个 repodata 目录，里面保存的就是当前源的包信息，每次加入新包的时候，都要再次执行 createrepo 命令以更新包信息。</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /var/www/html/rpms/amd64</span></span><br><span class="line"><span class="comment"># createrepo /var/www/html/rpms/amd64</span></span><br><span class="line">Spawning worker<span class="number"> 0 </span>with<span class="number"> 17 </span>pkgs</span><br><span class="line">Spawning worker<span class="number"> 1 </span>with<span class="number"> 16 </span>pkgs</span><br><span class="line">Workers Finished</span><br><span class="line">Saving Primary metadata</span><br><span class="line">Saving file lists metadata</span><br><span class="line">Saving other metadata</span><br><span class="line">Generating sqlite DBs</span><br><span class="line">Sqlite DBs complete</span><br></pre></td></tr></table></figure><h3 id="Create-YUM-Repository-Configuration-file"><a href="#Create-YUM-Repository-Configuration-file" class="headerlink" title="Create YUM Repository Configuration file"></a>Create YUM Repository Configuration file</h3><p>到目前为止，yum源已经搭建完成，接下来只需要在其他机器上配置当前私有源即可使用。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm -rf /etc/yum.repos.d/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/custom.repo</span></span><br><span class="line"><span class="section">[customrepo]</span></span><br><span class="line"><span class="attr">name</span>=Custom Repository</span><br><span class="line"><span class="attr">baseurl</span>=http://<span class="number">10.10</span>.<span class="number">52.62</span>/rpms/amd64/</span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum clean all</span></span><br><span class="line"><span class="comment"># yum makecache</span></span><br></pre></td></tr></table></figure><p>###参考资料</p><p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-yum-repositories-on-a-centos-6-vps" target="_blank" rel="external">https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-yum-repositories-on-a-centos-6-vps</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h3&gt;&lt;p&gt;创建YUM源的步骤和创建apt-get源的步骤一样。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install “createrepo”, httpd&lt;/li&gt;
&lt;li&gt;Create Repository directory &amp;amp; Copy Packages to apache web directory&lt;/li&gt;
&lt;li&gt;Run “createrepo”&lt;/li&gt;
&lt;li&gt;Create YUM Repository Configuration file&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;开启yum缓存&quot;&gt;&lt;a href=&quot;#开启yum缓存&quot; class=&quot;headerlink&quot; title=&quot;开启yum缓存&quot;&gt;&lt;/a&gt;开启yum缓存&lt;/h3&gt;&lt;p&gt;需要将 keepcache 的值设置为 1 , 缓存下来的包可以在 /var/cache/yum/x86_64/7/base/packages/ 目录中看到。&lt;/p&gt;
&lt;figure class=&quot;highlight lsl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# vi /etc/yum.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;keepcache=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# yum install vim -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# ls /var/cache/yum/x86_64/&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;/base/packages/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gpm-libs&lt;span class=&quot;number&quot;&gt;-1.20&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-5.&lt;/span&gt;el7.x86_64.rpm      perl-libs&lt;span class=&quot;number&quot;&gt;-5.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-286.&lt;/span&gt;el7.x86_64.rpm             perl-Storable&lt;span class=&quot;number&quot;&gt;-2.45&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-3.&lt;/span&gt;el7.x86_64.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;perl&lt;span class=&quot;number&quot;&gt;-5.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-286.&lt;/span&gt;el7.x86_64.rpm       &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;... ...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://pystack.org/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://pystack.org/tags/Linux/"/>
    
      <category term="YUM" scheme="http://pystack.org/tags/YUM/"/>
    
  </entry>
  
  <entry>
    <title>创建私有APT源</title>
    <link href="http://pystack.org/2016/01/13/create-your-own-apt-repository/"/>
    <id>http://pystack.org/2016/01/13/create-your-own-apt-repository/</id>
    <published>2016-01-13T02:36:12.000Z</published>
    <updated>2017-11-27T10:04:59.196Z</updated>
    
    <content type="html"><![CDATA[<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>创建私有的apt-get源一共有四步：</p><ol><li>Install dpkg-dev，apache2</li><li>Put the packages in apache web directory</li><li>Run dpkg-scanpackages to create Packages.gz file</li><li>Add a line to your sources.list pointing at your repository </li></ol><h3 id="Install-dpkg-dev-and-apache2"><a href="#Install-dpkg-dev-and-apache2" class="headerlink" title="Install dpkg-dev and apache2"></a>Install dpkg-dev and apache2</h3><p>安装所需要的工具包。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install dpkg-dev -y</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install apache2 -y</span><br></pre></td></tr></table></figure><h3 id="Create-Repository-directory-amp-Copy-packages"><a href="#Create-Repository-directory-amp-Copy-packages" class="headerlink" title="Create Repository directory &amp; Copy packages"></a>Create Repository directory &amp; Copy packages</h3><p>将所有的deb包拷贝到apache的web目录下面，并且保证别的机器能够访问到。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p <span class="regexp">/var/</span>www<span class="regexp">/html/</span>debs<span class="regexp">/amd64/</span>     </span><br><span class="line"># cp <span class="regexp">/var/</span>cache<span class="regexp">/apt/</span>archives<span class="comment">/*.deb /var/www/html/debs/amd64/</span></span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="/assets/img/cp-debs.png" alt=""></p><p>拷贝完成后，可以通过浏览器测试一下是否能够正常访问。</p><p><img src="/assets/img/debs-in-apache.png" alt=""></p><h3 id="Create-a-Packages-gz-file"><a href="#Create-a-Packages-gz-file" class="headerlink" title="Create a Packages.gz file"></a>Create a Packages.gz file</h3><p>Packages.gz 文件是一个目录文件，里面包含当前源所有的包信息。每次加入新的包都需要重新生成 Packages.gz 文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /var/www/html/debs/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dpkg-scanpackages amd64 | gzip -9c &gt; amd64/Packages.gz</span></span><br></pre></td></tr></table></figure><p><img src="/assets/img/create-packages-gz.png" alt=""></p><h3 id="Make-the-repository-known-to-APT"><a href="#Make-the-repository-known-to-APT" class="headerlink" title="Make the repository known to APT"></a>Make the repository known to APT</h3><p>到目前为止，apt-get源已经搭建完成，接下来只需要在其他机器上配置当前私有源即可使用。</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># vim /etc/apt/sources.list</span></span><br><span class="line">deb http:<span class="comment">//10.10.52.72/debs/ amd64/</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># apt-get update</span></span><br></pre></td></tr></table></figure><p><img src="/assets/img/sources-file.png" alt=""></p><blockquote><p>如果要将apt源搭建到centos上，只需要将debs目录拷贝到centos上的web目录下即可，对应的IP地址也需要修改为centos的地址。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="http://askubuntu.com/questions/170348/how-to-create-a-local-apt-repository" target="_blank" rel="external">http://askubuntu.com/questions/170348/how-to-create-a-local-apt-repository</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h3&gt;&lt;p&gt;创建私有的apt-get源一共有四步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install dpkg-dev，apache2&lt;/li&gt;
&lt;li&gt;Put the packages in apache web directory&lt;/li&gt;
&lt;li&gt;Run dpkg-scanpackages to create Packages.gz file&lt;/li&gt;
&lt;li&gt;Add a line to your sources.list pointing at your repository &lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;Install-dpkg-dev-and-apache2&quot;&gt;&lt;a href=&quot;#Install-dpkg-dev-and-apache2&quot; class=&quot;headerlink&quot; title=&quot;Install dpkg-dev and apache2&quot;&gt;&lt;/a&gt;Install dpkg-dev and apache2&lt;/h3&gt;&lt;p&gt;安装所需要的工具包。&lt;/p&gt;
&lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-&lt;span class=&quot;builtin-name&quot;&gt;get&lt;/span&gt; install dpkg-dev -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-&lt;span class=&quot;builtin-name&quot;&gt;get&lt;/span&gt; install apache2 -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Create-Repository-directory-amp-Copy-packages&quot;&gt;&lt;a href=&quot;#Create-Repository-directory-amp-Copy-packages&quot; class=&quot;headerlink&quot; title=&quot;Create Repository directory &amp;amp; Copy packages&quot;&gt;&lt;/a&gt;Create Repository directory &amp;amp; Copy packages&lt;/h3&gt;&lt;p&gt;将所有的deb包拷贝到apache的web目录下面，并且保证别的机器能够访问到。&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# mkdir -p &lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;www&lt;span class=&quot;regexp&quot;&gt;/html/&lt;/span&gt;debs&lt;span class=&quot;regexp&quot;&gt;/amd64/&lt;/span&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# cp &lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;cache&lt;span class=&quot;regexp&quot;&gt;/apt/&lt;/span&gt;archives&lt;span class=&quot;comment&quot;&gt;/*.deb /var/www/html/debs/amd64/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://pystack.org/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://pystack.org/tags/Linux/"/>
    
      <category term="APT" scheme="http://pystack.org/tags/APT/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu安装Netgare WNDA3100v2 USB网卡驱动</title>
    <link href="http://pystack.org/2015/11/14/ubuntu-with-wnda3100v2/"/>
    <id>http://pystack.org/2015/11/14/ubuntu-with-wnda3100v2/</id>
    <published>2015-11-14T06:39:24.000Z</published>
    <updated>2017-11-27T09:42:10.982Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-插上usb网卡"><a href="#1-插上usb网卡" class="headerlink" title="1. 插上usb网卡"></a>1. 插上usb网卡</h2><p>使用lsusb命令可以看到对应的设备信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> lsusb</span></span><br><span class="line">Bus 004 Device 002: ID 8087:8000 Intel Corp. </span><br><span class="line">Bus 004 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 003 Device 002: ID 8087:8008 Intel Corp. </span><br><span class="line">Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 004: ID 413c:2107 Dell Computer Corp. </span><br><span class="line">Bus 001 Device 003: ID 04ca:0061 Lite-On Technology Corp. </span><br><span class="line">Bus 001 Device 006: ID 0846:9011 NetGear, Inc. WNDA3100v2 802.11abgn [Broadcom BCM4323]</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure><p>使用iwconfig命令会发现找不到wlan的信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iwconfig</span></span><br><span class="line">eth0      no wireless extensions.</span><br><span class="line"></span><br><span class="line">lo        no wireless extensions.</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="2-安装网卡驱动"><a href="#2-安装网卡驱动" class="headerlink" title="2. 安装网卡驱动"></a>2. 安装网卡驱动</h2><p>驱动下载地址：<a href="http://media.cdn.ubuntu-de.org/forum/attachments/37/11/2955302-Broadcom_bcm43xx_USB_32_64bit_v3.tar.gz" target="_blank" rel="external">2955302-Broadcom_bcm43xx_USB_32_64bit_v3.tar.gz</a><br>或者 <a href="http://pan.baidu.com/s/1i3zx06x" target="_blank" rel="external">http://pan.baidu.com/s/1i3zx06x</a></p><p>下载后解压会得到下面几个文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ll</span></span><br><span class="line">total 1448</span><br><span class="line">drwxrwx--- 2 moose moose   4096  3月 15  2012 ./</span><br><span class="line">drwxr-xr-x 6 moose moose   4096 11月  4 13:54 ../</span><br><span class="line">-rwxrwx--- 1 moose moose  41078  6月  7  2011 bcmn43xx32.inf*</span><br><span class="line">-rwxrwx--- 1 moose moose 632576  9月  4  2010 bcmn43xx32.sys*</span><br><span class="line">-rwxrwx--- 1 moose moose  41078  3月 15  2012 bcmn43xx64.inf*</span><br><span class="line">-rwxrwx--- 1 moose moose 747008  9月  4  2010 bcmn43xx64.sys*</span><br></pre></td></tr></table></figure><p>安装ndisgtk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install ndisgtk</span></span><br></pre></td></tr></table></figure><p>安装驱动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ndiswrapper -i bcmn43xx64.inf</span></span><br></pre></td></tr></table></figure><p>检查驱动是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ndiswrapper -l</span></span><br><span class="line">bcmn43xx64 : driver installed</span><br><span class="line">    device (0846:9011) present</span><br></pre></td></tr></table></figure><h2 id="3-加载驱动模块"><a href="#3-加载驱动模块" class="headerlink" title="3. 加载驱动模块"></a>3. 加载驱动模块</h2><p>成功安装驱动之后就可以用命令加载驱动模块</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo depmod -a</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo modprobe ndiswrapper</span></span><br></pre></td></tr></table></figure><p>加载的过程中可以使用tail命令来查看错误信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tail -f /var/<span class="built_in">log</span>/messages</span></span><br></pre></td></tr></table></figure><p>加载完成后再次执行iwconfig命令，即可以看到新加的wlan0信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iwconfig</span></span><br><span class="line">eth0      no wireless extensions.</span><br><span class="line"></span><br><span class="line">wlan0     IEEE 802.11g  ESSID:off/any  </span><br><span class="line">          Mode:Managed  Frequency:2.412 GHz  Access Point: Not-Associated   </span><br><span class="line">          Bit Rate:300 Mb/s   Tx-Power:32 dBm   </span><br><span class="line">          RTS thr:2347 B   Fragment thr:2346 B   </span><br><span class="line">          Power Management:off</span><br><span class="line">          Link Quality:0  Signal level:0  Noise level:0</span><br><span class="line">          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">          Tx excessive retries:0  Invalid misc:0   Missed beacon:0</span><br><span class="line"></span><br><span class="line">lo        no wireless extensions.</span><br></pre></td></tr></table></figure><p>现在就可以通过NetworkManager来连接无线网络了。</p><blockquote><p>参考地址: <a href="https://help.ubuntu.com/community/WifiDocs/Driver/Ndiswrapper" target="_blank" rel="external">https://help.ubuntu.com/community/WifiDocs/Driver/Ndiswrapper</a></p></blockquote><hr><h1 id="Ubuntu共享无线网络"><a href="#Ubuntu共享无线网络" class="headerlink" title="Ubuntu共享无线网络"></a>Ubuntu共享无线网络</h1><h2 id="1-禁用Wifi"><a href="#1-禁用Wifi" class="headerlink" title="1. 禁用Wifi"></a>1. 禁用Wifi</h2><p>去掉Enable-Wifi前面的对钩</p><h2 id="2-添加Wifi网络"><a href="#2-添加Wifi网络" class="headerlink" title="2. 添加Wifi网络"></a>2. 添加Wifi网络</h2><p>打开网络面板，点击 <strong>Edit Connections</strong> </p><p>–&gt; 点击 <strong>Add</strong> 按钮 </p><p><img src="/assets/img/new-conn-tab.png" alt=""></p><p>–&gt; 选择连接类型为 <strong>Wifi</strong> </p><p><img src="/assets/img/conn-type-tab.png" alt=""></p><p>–&gt; 输入 <strong>Connection name</strong> 、<strong>SSID</strong>， 选择Mode为 <strong>Infrastructure</strong>, Device MAC Address 选择为 <strong>wlan0</strong> </p><p><img src="/assets/img/wifi-tab.png" alt=""></p><p>–&gt; 点击Wi-Fi Security面板，选择Security为 <strong>WPA &amp; WPA2 Personal</strong> 并输入密码 </p><p><img src="/assets/img/wifi-sec-tab.png" alt=""></p><p>–&gt; 点击IPv4 Settings面板，选择Method为 <strong>Shared to other computers</strong> </p><p><img src="/assets/img/wifi-ip4-tab.png" alt=""></p><p>–&gt; 点击Save保存</p><h2 id="3-编辑wifi配置文件"><a href="#3-编辑wifi配置文件" class="headerlink" title="3. 编辑wifi配置文件"></a>3. 编辑wifi配置文件</h2><p>将 <strong>mode=infrastructure</strong> 改为 <strong>mode=ap</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Netgare 为你刚才配置的Connection name</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/NetworkManager/system-connections/Netgare</span></span><br><span class="line">[connection]</span><br><span class="line">id=Netgare</span><br><span class="line">uuid=da436c01-1a3f-4d9d-910c-04d3c68ef5f0</span><br><span class="line">type=802-11-wireless</span><br><span class="line"></span><br><span class="line">[802-11-wireless]</span><br><span class="line">ssid=Ubuntu Wifi</span><br><span class="line">mode=infrastructure</span><br><span class="line">mac-address=44:94:FC:21:01:77</span><br><span class="line">security=802-11-wireless-security</span><br><span class="line"></span><br><span class="line">[802-11-wireless-security]</span><br><span class="line">key-mgmt=wpa-psk</span><br><span class="line">psk=123456789</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=shared</span><br><span class="line"></span><br><span class="line">[ipv6]</span><br><span class="line">method=auto</span><br></pre></td></tr></table></figure><h2 id="4-启用无线网络"><a href="#4-启用无线网络" class="headerlink" title="4. 启用无线网络"></a>4. 启用无线网络</h2><p>点击 <strong>Enable Wifi</strong>, 连接刚创建的wifi网络( <em>Ubuntu Wifi</em> )。如果找不到刚创建的网络，就点击 <strong>Connect to Hidden Wi-Fi Network…</strong>， 选择刚创建的wifi网络( <em>Ubuntu Wifi</em> )即可。<br><img src="/assets/img/conn-hidden-tab.png" alt=""></p><p>不过，楼主的测试并没有成功……<br>提示 <em>(32) Access Point (AP) mode is not supported by this device.</em><br><img src="/assets/img/wifi-err.png" alt=""></p><blockquote><p>参考地址:<br><a href="http://ubuntuhandbook.org/index.php/2014/09/3-ways-create-wifi-hotspot-ubuntu/" target="_blank" rel="external">3-ways-create-wifi-hotspot-ubuntu</a><br><a href="https://www.quora.com/How-do-I-create-hotspots-in-Ubuntu-14-04" target="_blank" rel="external">How-do-I-create-hotspots-in-Ubuntu-14-04</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-插上usb网卡&quot;&gt;&lt;a href=&quot;#1-插上usb网卡&quot; class=&quot;headerlink&quot; title=&quot;1. 插上usb网卡&quot;&gt;&lt;/a&gt;1. 插上usb网卡&lt;/h2&gt;&lt;p&gt;使用lsusb命令可以看到对应的设备信息&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; lsusb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 004 Device 002: ID 8087:8000 Intel Corp. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 004 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 003 Device 002: ID 8087:8008 Intel Corp. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 001 Device 004: ID 413c:2107 Dell Computer Corp. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 001 Device 003: ID 04ca:0061 Lite-On Technology Corp. &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 001 Device 006: ID 0846:9011 NetGear, Inc. WNDA3100v2 802.11abgn [Broadcom BCM4323]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用iwconfig命令会发现找不到wlan的信息&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; iwconfig&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;eth0      no wireless extensions.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lo        no wireless extensions.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://pystack.org/categories/Linux/"/>
    
    
      <category term="Ubuntu" scheme="http://pystack.org/tags/Ubuntu/"/>
    
      <category term="WNDA3100v2" scheme="http://pystack.org/tags/WNDA3100v2/"/>
    
      <category term="USB网卡" scheme="http://pystack.org/tags/USB%E7%BD%91%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS Notes</title>
    <link href="http://pystack.org/2015/05/14/angularjs-notes/"/>
    <id>http://pystack.org/2015/05/14/angularjs-notes/</id>
    <published>2015-05-14T06:48:35.000Z</published>
    <updated>2017-11-27T10:05:55.581Z</updated>
    
    <content type="html"><![CDATA[<h2 id="先举一个栗子"><a href="#先举一个栗子" class="headerlink" title="先举一个栗子"></a>先举一个栗子</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>名字 : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当网页加载完毕，AngularJS 自动开启。<br>ng-app 指令告诉 AngularJS，<div> 元素是 AngularJS 应用程序 的”所有者”。<br>ng-model 指令把输入域的值绑定到应用程序变量 name。<br>ng-bind 指令把应用程序变量 name 绑定到某个段落的 innerHTML。</div></p><a id="more"></a><h2 id="AngularJS-表达式"><a href="#AngularJS-表达式" class="headerlink" title="AngularJS 表达式"></a>AngularJS 表达式</h2><p>AngularJS 表达式写在双大括号内：。<br>AngularJS 表达式把数据绑定到 HTML，这与 ng-bind 指令有异曲同工之妙。<br>AngularJS 将在表达式书写的位置”输出”数据。<br>AngularJS 表达式 很像 JavaScript 表达式：它们可以包含文字、运算符和变量。<br>实例 10 或 undefined undefined</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">AngularJS 数字</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span>  <span class="attr">ng-init</span>=<span class="string">"count=5+5"</span>&gt;</span></span><br><span class="line">  count: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">'count'</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"quantity=1;cost=5"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： &#123;&#123; quantity * cost &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"quantity * cost"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">AngularJS 字符串</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"firstName='John';lastName='Doe'"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名： &#123;&#123; firstName + " " + lastName &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名： <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"firstName + ' ' + lastName"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">AngularJS 对象</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"person=&#123;firstName:'John',lastName:'Doe'&#125;"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓为 &#123;&#123; person.lastName &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓为 <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"person.lastName"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">AngularJS 数组</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"points=[1,15,19,2,40]"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span>&gt;</span>第三个值为 &#123;&#123; points[2] &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span>&gt;</span>第三个值为 <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"points[2]"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"names=['Jani','Hege','Kai']"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 ng-repeat 来循环数组<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names"</span>&gt;</span></span><br><span class="line">      &#123;&#123; x &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-应用"><a href="#AngularJS-应用" class="headerlink" title="AngularJS 应用"></a>AngularJS 应用</h2><p>AngularJS 模块（Module） 定义了 AngularJS 应用。<br>AngularJS 控制器（Controller） 用于控制 AngularJS 应用。<br>ng-app指令定义了应用, ng-controller 定义了控制器。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>尝试修改以下表单。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"firstName"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">姓: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"lastName"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">姓名: &#123;&#123;firstName + " " + lastName&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.firstName= <span class="string">"John"</span>;</span></span><br><span class="line"><span class="actionscript">    $scope.lastName= <span class="string">"Doe"</span>;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>AngularJS 应用程序由 ng-app 定义。应用程序在 <div> 内运行。<br>ng-controller=”myCtrl” 属性是一个 AngularJS 指令。用于定义一个控制器。<br>myCtrl 函数是一个 JavaScript 函数。<br>AngularJS 使用$scope 对象来调用控制器。<br>在 AngularJS 中， $scope 是一个应用对象(属于应用变量和函数)。<br>控制器的 $scope （相当于作用域、控制范围）用来保存AngularJS Model(模型)的对象。<br>控制器在作用域中创建了两个属性 (firstName 和 lastName)。<br>ng-model 指令绑定输入域到控制器的属性（firstName 和 lastName）。</div></p><p>Scope(作用域) 是应用在 HTML (视图) 和 JavaScript (控制器)之间的纽带。<br>Scope 是一个对象，有可用的方法和属性。<br>Scope 可应用在视图和控制器上。</p><p>所有的应用都有一个 $rootScope，它可以作用在 ng-app 指令包含的所有 HTML 元素中。<br>$rootScope 可作用于整个应用中。是各个 controller 中 scope 的桥梁。用 rootscope 定义的值，可以在各个 controller 中使用。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;lastname&#125;&#125; 家族成员:<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names"</span>&gt;</span>&#123;&#123;x&#125;&#125; &#123;&#123;lastname&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $rootScope)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    $scope.names = [<span class="string">"Emil"</span>, <span class="string">"Tobias"</span>, <span class="string">"Linus"</span>];</span></span><br><span class="line"><span class="actionscript">    $rootScope.lastname = <span class="string">"Refsnes"</span>;</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="创建自定义的指令"><a href="#创建自定义的指令" class="headerlink" title="创建自定义的指令"></a>创建自定义的指令</h2><p>restrict 值可以是以下几种:<br>E 作为元素名使用<br>A 作为属性使用<br>C 作为类名使用<br>M 作为注释使用</p><h2 id="验证用户输入"><a href="#验证用户输入" class="headerlink" title="验证用户输入"></a>验证用户输入</h2><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    Email:</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"myAddress"</span> <span class="attr">ng-model</span>=<span class="string">"text"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.myAddress.$error.email"</span>&gt;</span>不是一个合法的邮箱地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"myForm"</span> <span class="attr">ng-init</span>=<span class="string">"myText = 'test@runoob.com'"</span>&gt;</span></span></span><br><span class="line"><span class="xml">Email:</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"myAddress"</span> <span class="attr">ng-model</span>=<span class="string">"myText"</span> <span class="attr">required</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>编辑邮箱地址，查看状态的改变。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Valid: </span><span class="template-variable">&#123;&#123;myForm.myAddress.$valid&#125;&#125;</span><span class="xml"> (如果输入的值是合法的则为 true)。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Dirty: </span><span class="template-variable">&#123;&#123;myForm.myAddress.$dirty&#125;&#125;</span><span class="xml"> (如果值改变则为 true)。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Touched: </span><span class="template-variable">&#123;&#123;myForm.myAddress.$touched&#125;&#125;</span><span class="xml"> (如果通过触屏点击则为 true)。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>ng-model 指令根据表单域的状态添加/移除以下类：<br>ng-empty<br>ng-not-empty<br>ng-touched<br>ng-untouched<br>ng-valid<br>ng-invalid<br>ng-dirty<br>ng-pending<br>ng-pristine</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-tag">input</span><span class="selector-class">.ng-invalid</span> &#123;</span></span><br><span class="line"><span class="undefined">    background-color: lightblue;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    输入你的名字:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"myName"</span> <span class="attr">ng-model</span>=<span class="string">"myText"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-过滤器"><a href="#AngularJS-过滤器" class="headerlink" title="AngularJS 过滤器"></a>AngularJS 过滤器</h2><p>过滤器  描述<br>currency    格式化数字为货币格式。<br>filter  从数组项中选择一个子集。<br>lowercase   格式化字符串为小写。<br>orderBy 根据某个表达式排列数组。<br>uppercase   格式化字符串为大写。</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"personCtrl"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名为 </span><span class="template-variable">&#123;&#123; lastName | uppercase &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"namesCtrl"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>输入过滤:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names | filter:test | orderBy:'country'"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; (x.name | uppercase) + ', ' + x.country &#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-服务"><a href="#AngularJS-服务" class="headerlink" title="AngularJS 服务"></a>AngularJS 服务</h2><p>在 AngularJS 中，服务是一个函数或对象，可在你的 AngularJS 应用中使用。<br>AngularJS 内建了30 多个服务。<br>有个 $location 服务，它可以返回当前页面的 URL 地址。<br>在很多服务中，比如 $location 服务，它可以使用 DOM 中存在的对象，类似 window.location 对象，但 window.location 对象在 AngularJS 应用中有一定的局限性。<br>AngularJS 会一直监控应用，处理事件变化， AngularJS 使用 $location 服务比使用 window.location 对象更好。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span><br><span class="line">app.controller(<span class="string">'customersCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $location)</span> </span>&#123;</span><br><span class="line">    $scope.myUrl = $location.absUrl();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>$http 服务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span></span><br><span class="line"><span class="actionscript">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $http)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">  $http.get(<span class="string">"welcome.htm"</span>).then(<span class="function"><span class="keyword">function</span> <span class="params">(response)</span> </span>&#123;</span></span><br><span class="line"><span class="undefined">      $scope.myWelcome = response.data;</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>$timeout 服务</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span><br><span class="line">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $timeout)</span> </span>&#123;</span><br><span class="line">  $scope.myHeader = <span class="string">"Hello World!"</span>;</span><br><span class="line">  $timeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      $scope.myHeader = <span class="string">"How are you today?"</span>;</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>$interval 服务</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span><br><span class="line">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $interval)</span> </span>&#123;</span><br><span class="line">  $scope.theTime = <span class="keyword">new</span> Date().toLocaleTimeString();</span><br><span class="line">  $interval(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      $scope.theTime = <span class="keyword">new</span> Date().toLocaleTimeString();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>自定义服务</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>, []);</span><br><span class="line"></span><br><span class="line">app.service(<span class="string">'hexafy'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    this.myFunc = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.controller(<span class="string">'myCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, hexafy)</span> </span>&#123;</span><br><span class="line">  $scope.hex = hexafy.myFunc(<span class="number">255</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;255 | myFormat&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line"><span class="xml">var app = angular.module('myApp', []);</span></span><br><span class="line"><span class="xml">app.service('hexafy', function() &#123;</span></span><br><span class="line"><span class="xml">    this.myFunc = function (x) &#123;</span></span><br><span class="line"><span class="xml">        return x.toString(16);</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br><span class="line"><span class="xml">app.filter('myFormat',['hexafy', function(hexafy) &#123;</span></span><br><span class="line"><span class="xml">    return function(x) &#123;</span></span><br><span class="line"><span class="xml">        return hexafy.myFunc(x);</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"><span class="xml">&#125;]);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-Select-选择框"><a href="#AngularJS-Select-选择框" class="headerlink" title="AngularJS Select(选择框)"></a>AngularJS Select(选择框)</h2><p>ng-repeat 指令是通过数组来循环 HTML 代码来创建下拉列表，但 ng-options 指令更适合创建下拉列表，它有以下优势：<br>使用 ng-options 的选项的一个对象， ng-repeat 是一个字符串。</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"selectedSite"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">option</span> <span class="attr">ng-repeat</span>=<span class="string">"x in sites"</span> <span class="attr">value</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123;x.url&#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span><span class="template-variable">&#123;&#123;x.site&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你选择的是: </span><span class="template-variable">&#123;&#123;selectedSite&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">---------</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"selectedSite"</span> <span class="attr">ng-options</span>=<span class="string">"x.site for x in sites"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你选择的是: </span><span class="template-variable">&#123;&#123;selectedSite.site&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>网址为: </span><span class="template-variable">&#123;&#123;selectedSite.url&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123; $index + 1 &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123; x.Name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123; x.Country &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"x in names"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">ng-if</span>=<span class="string">"$odd"</span> <span class="attr">style</span>=<span class="string">"background-color:#f1f1f1"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; x.Name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">ng-if</span>=<span class="string">"$even"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; x.Name &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">ng-if</span>=<span class="string">"$odd"</span> <span class="attr">style</span>=<span class="string">"background-color:#f1f1f1"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; x.Country &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">ng-if</span>=<span class="string">"$even"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; x.Country &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-HTML-DOM"><a href="#AngularJS-HTML-DOM" class="headerlink" title="AngularJS HTML DOM"></a>AngularJS HTML DOM</h2><p>ng-disabled 指令</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="attribute">ng-app</span>=<span class="string">""</span> <span class="attribute">ng-init</span>=<span class="string">"mySwitch=true"</span>&gt;</span><br><span class="line">&lt;button <span class="attribute">ng-disabled</span>=<span class="string">"mySwitch"</span>&gt;点我!&lt;/button&gt;</span><br><span class="line">&lt;input <span class="attribute">type</span>=<span class="string">"checkbox"</span> <span class="attribute">ng-model</span>=<span class="string">"mySwitch"</span>&gt;按钮</span><br></pre></td></tr></table></figure><p>ng-show 指令</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">""</span> <span class="attr">ng-init</span>=<span class="string">"hour=13"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-show</span>=<span class="string">"hour &gt; 12"</span>&gt;</span>我是可见的。<span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ng-hide 指令</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-hide</span>=<span class="string">"true"</span>&gt;</span>我是不可见的。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-hide</span>=<span class="string">"false"</span>&gt;</span>我是可见的。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-事件"><a href="#AngularJS-事件" class="headerlink" title="AngularJS 事件"></a>AngularJS 事件</h2><p>ng-click 指令</p><figure class="highlight htmlbars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"myApp"</span> <span class="attr">ng-controller</span>=<span class="string">"personCtrl"</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"toggle()"</span>&gt;</span>隐藏/显示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-hide</span>=<span class="string">"myVar"</span>&gt;</span></span></span><br><span class="line"><span class="xml">名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">text</span> <span class="attr">ng-model</span>=<span class="string">"firstName"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">姓: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">text</span> <span class="attr">ng-model</span>=<span class="string">"lastName"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">姓名: </span><span class="template-variable">&#123;&#123;firstName + <span class="string">" "</span> + lastName&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line"><span class="xml">var app = angular.module('myApp', []);</span></span><br><span class="line"><span class="xml">app.controller('personCtrl', function($scope) &#123;</span></span><br><span class="line"><span class="xml">    $scope.firstName = "John";</span></span><br><span class="line"><span class="xml">    $scope.lastName = "Doe";</span></span><br><span class="line"><span class="xml">    $scope.myVar = false;</span></span><br><span class="line"><span class="xml">    $scope.toggle = function() &#123;</span></span><br><span class="line"><span class="xml">        $scope.myVar = !$scope.myVar;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;);</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-包含"><a href="#AngularJS-包含" class="headerlink" title="AngularJS 包含"></a>AngularJS 包含</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">"'runoob.htm'"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="AngularJS-依赖注入"><a href="#AngularJS-依赖注入" class="headerlink" title="AngularJS 依赖注入"></a>AngularJS 依赖注入</h2><p>依赖注入（Dependency Injection，简称DI）是一种软件设计模式，在这种模式下，一个或更多的依赖（或服务）被注入（或者通过引用传递）到一个独立的对象（或客户端）中，然后成为了该客户端状态的一部分。<br>该模式分离了客户端依赖本身行为的创建，这使得程序设计变得松耦合，并遵循了依赖反转和单一职责原则。与服务定位器模式形成直接对比的是，它允许客户端了解客户端如何使用该系统找到依赖</p><p>AngularJS 提供很好的依赖注入机制。以下5个核心组件用来作为依赖注入：<br>value<br>factory<br>service<br>provider<br>constant</p><h2 id="AngularJS-路由"><a href="#AngularJS-路由" class="headerlink" title="AngularJS 路由"></a>AngularJS 路由</h2><p>AngularJS 路由 就通过 # + 标记 帮助我们区分不同的逻辑页面并将不同的页面绑定到对应的控制器上。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">'routingDemoApp'</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>AngularJS 路由应用<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/computers"</span>&gt;</span>电脑<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/printers"</span>&gt;</span>打印机<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/blabla"</span>&gt;</span>其他<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://apps.bdimg.com/libs/angular-route/1.3.13/angular-route.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        angular.module(<span class="string">'routingDemoApp'</span>,[<span class="string">'ngRoute'</span>])</span></span><br><span class="line"><span class="actionscript">        .config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span><span class="params">($routeProvider)</span></span>&#123;</span></span><br><span class="line"><span class="undefined">            $routeProvider</span></span><br><span class="line"><span class="actionscript">            .when(<span class="string">'/'</span>,&#123;template:<span class="string">'这是首页页面'</span>&#125;)</span></span><br><span class="line"><span class="actionscript">            .when(<span class="string">'/computers'</span>,&#123;template:<span class="string">'这是电脑分类页面'</span>&#125;)</span></span><br><span class="line"><span class="actionscript">            .when(<span class="string">'/printers'</span>,&#123;template:<span class="string">'这是打印机页面'</span>&#125;)</span></span><br><span class="line"><span class="actionscript">            .otherwise(&#123;redirectTo:<span class="string">'/'</span>&#125;);</span></span><br><span class="line"><span class="undefined">        &#125;]);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;先举一个栗子&quot;&gt;&lt;a href=&quot;#先举一个栗子&quot; class=&quot;headerlink&quot; title=&quot;先举一个栗子&quot;&gt;&lt;/a&gt;先举一个栗子&lt;/h2&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;charset&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;undefined&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;ng-app&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;名字 : &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;ng-model&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;h1&lt;/span&gt;&amp;gt;&lt;/span&gt;Hello &amp;#123;&amp;#123;name&amp;#125;&amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;h1&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当网页加载完毕，AngularJS 自动开启。&lt;br&gt;ng-app 指令告诉 AngularJS，&lt;div&gt; 元素是 AngularJS 应用程序 的”所有者”。&lt;br&gt;ng-model 指令把输入域的值绑定到应用程序变量 name。&lt;br&gt;ng-bind 指令把应用程序变量 name 绑定到某个段落的 innerHTML。&lt;/div&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web" scheme="http://pystack.org/categories/Web/"/>
    
    
      <category term="AngularJS" scheme="http://pystack.org/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>Opera浏览器书签转换器</title>
    <link href="http://pystack.org/2015/03/26/opera-browser-bookmark-converter/"/>
    <id>http://pystack.org/2015/03/26/opera-browser-bookmark-converter/</id>
    <published>2015-03-26T13:39:24.000Z</published>
    <updated>2017-11-27T10:04:03.596Z</updated>
    
    <content type="html"><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>注：程序使用python + wxpython + pywin32实现，如果需要运行源代码，需要先安装上述库。另程序无法处理一些特殊符号，例如：●◎等</p><h3 id="程序功能："><a href="#程序功能：" class="headerlink" title="程序功能："></a>程序功能：</h3><p>将Opera导出的adr文件转换为URL快捷方式，可以直接导入到IE收藏夹中，也可以间接的导入到Chrome等浏览器中。</p><p><img src="/assets/img/opera-conv-main.png" alt=""></p><h3 id="程序代码："><a href="#程序代码：" class="headerlink" title="程序代码："></a>程序代码：</h3><a id="more"></a><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">#  Copyright (C)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This program is free software; you can redistribute it and/or</span></span><br><span class="line"><span class="comment"># modify it under the terms of the GNU General Public License</span></span><br><span class="line"><span class="comment"># as published by the Free Software Foundation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># @file: operabookmarkconvert.py</span></span><br><span class="line"><span class="comment"># @author: moose</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">import wx</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import win32com.client</span><br><span class="line"></span><br><span class="line">debug = True</span><br><span class="line"></span><br><span class="line">class FileDrop(wx.FileDropTarget)<span class="symbol">:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span></span>(<span class="keyword">self</span>, window)<span class="symbol">:</span></span><br><span class="line">        wx.FileDropTarget.__init_<span class="number">_</span>(<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">self</span>.window = window</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnDropFiles</span></span>(<span class="keyword">self</span>, x, y, filenames)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.window.SetValue(str(filenames[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">class ConvertFrame(wx.Frame)<span class="symbol">:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span></span>(<span class="keyword">self</span>, parent, id)<span class="symbol">:</span></span><br><span class="line">        wx.Frame.__init_<span class="number">_</span>(<span class="keyword">self</span>, parent, id, <span class="string">"Opera Bookmark Convert"</span>,size=(<span class="number">400</span>,<span class="number">600</span>))</span><br><span class="line">        <span class="keyword">self</span>.Center()</span><br><span class="line">        <span class="keyword">self</span>.SetIcon(wx.Icon(<span class="string">"convert.ico"</span>, wx.BITMAP_TYPE_ICO))</span><br><span class="line"></span><br><span class="line">        panel = wx.Panel(<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#set menu bar</span></span><br><span class="line">        <span class="keyword">self</span>.SetMenuBar(<span class="keyword">self</span>.CreateMenubar())</span><br><span class="line"></span><br><span class="line">        <span class="comment">#sizer</span></span><br><span class="line">        framesizer = wx.BoxSizer(wx.VERTICAL)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#bookmark button</span></span><br><span class="line">        <span class="keyword">self</span>.textctrl_bm = wx.TextCtrl(panel, -<span class="number">1</span>, <span class="string">""</span>, size=(<span class="number">380</span>,<span class="number">26</span>))</span><br><span class="line">        <span class="keyword">self</span>.button_bm = wx.Button(panel, -<span class="number">1</span>, <span class="string">"Choose Bookmark File"</span>,size=(-<span class="number">1</span>,<span class="number">40</span>))</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_BUTTON, <span class="keyword">self</span>.OnBMBtnClick, <span class="keyword">self</span>.button_bm)</span><br><span class="line">        <span class="keyword">self</span>.textctrl_bm.Bind(wx.EVT_LEFT_DCLICK, <span class="keyword">self</span>.OnBMBtnClick)</span><br><span class="line">        droptarget = FileDrop(<span class="keyword">self</span>.textctrl_bm)</span><br><span class="line">        <span class="keyword">self</span>.textctrl_bm.SetDropTarget(droptarget)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#save path</span></span><br><span class="line">        <span class="keyword">self</span>.textctrl_sp = wx.TextCtrl(panel, -<span class="number">1</span>, <span class="string">""</span>, size=(<span class="number">380</span>,<span class="number">26</span>))</span><br><span class="line">        <span class="keyword">self</span>.button_sp = wx.Button(panel, -<span class="number">1</span>, <span class="string">"Save To"</span>,size=(-<span class="number">1</span>,<span class="number">40</span>))</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_BUTTON, <span class="keyword">self</span>.OnSPBtnClick, <span class="keyword">self</span>.button_sp)</span><br><span class="line">        <span class="keyword">self</span>.textctrl_sp.Bind(wx.EVT_LEFT_DCLICK, <span class="keyword">self</span>.OnSPBtnClick)</span><br><span class="line">        droptarget = FileDrop(<span class="keyword">self</span>.textctrl_sp)</span><br><span class="line">        <span class="keyword">self</span>.textctrl_sp.SetDropTarget(droptarget)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#start convert</span></span><br><span class="line">        <span class="keyword">self</span>.button_start = wx.Button(panel, -<span class="number">1</span>, <span class="string">"Start Convert"</span>,size=(-<span class="number">1</span>,<span class="number">40</span>))</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_BUTTON, <span class="keyword">self</span>.OnSCBtnClick, <span class="keyword">self</span>.button_start)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#log text info</span></span><br><span class="line">        <span class="keyword">self</span>.textctrl_log = wx.TextCtrl(panel, -<span class="number">1</span>, <span class="string">""</span>, style=wx.TE_MULTILINE,size=(-<span class="number">1</span>,<span class="number">160</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#layout</span></span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.textctrl_bm,<span class="number">0</span>,wx.ALL|wx.EXPAND,<span class="number">2</span>)</span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.button_bm,<span class="number">0</span>,wx.CENTER)</span><br><span class="line">        framesizer.Add((-<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.textctrl_sp,<span class="number">0</span>,wx.ALL|wx.EXPAND,<span class="number">2</span>)</span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.button_sp,<span class="number">0</span>,wx.CENTER)</span><br><span class="line">        framesizer.Add((-<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.button_start,<span class="number">0</span>,wx.CENTER)</span><br><span class="line">        framesizer.Add((-<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line">        framesizer.Add(<span class="keyword">self</span>.textctrl_log,<span class="number">1</span>,wx.ALL|wx.EXPAND,<span class="number">2</span>)   <span class="comment">#1 for auto size</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#status bar</span></span><br><span class="line">        <span class="keyword">self</span>.statusbar = <span class="keyword">self</span>.CreateStatusBar()</span><br><span class="line">        <span class="keyword">self</span>.statusbar.SetFieldsCount(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">self</span>.statusbar.SetStatusWidths([-<span class="number">4</span>,-<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">self</span>.statusbar.SetStatusText(<span class="string">"www.pystack.org"</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        panel.SetSizer(framesizer)</span><br><span class="line">        framesizer.Fit(<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">CreateMenubar</span></span>(<span class="keyword">self</span>)<span class="symbol">:</span></span><br><span class="line">        <span class="comment">#menu bar</span></span><br><span class="line">        menubar = wx.MenuBar()</span><br><span class="line"></span><br><span class="line">        menu_file = wx.Menu()</span><br><span class="line">        menubar.Append(menu_file, <span class="string">"&amp;File"</span>)</span><br><span class="line"></span><br><span class="line">        menu_help = wx.Menu()</span><br><span class="line">        menubar.Append(menu_help, <span class="string">"&amp;Help"</span>)</span><br><span class="line"></span><br><span class="line">        menu_open = menu_file.Append(wx.NewId(), <span class="string">"&amp;Open Bookmark"</span>,<span class="string">"Open an opera..."</span>)</span><br><span class="line">        menu_path = menu_file.Append(wx.NewId(), <span class="string">"&amp;Save To"</span>,<span class="string">"Save bookmark To..."</span>)</span><br><span class="line">        menu_log = menu_file.Append(wx.NewId(),<span class="string">"E&amp;xport Log"</span>,<span class="string">"Export log..."</span>)</span><br><span class="line">        menu_file.AppendSeparator()</span><br><span class="line">        menu_exit = menu_file.Append(wx.ID_EXIT,<span class="string">"&amp;Exit"</span>,<span class="string">"Exit this application."</span>)</span><br><span class="line"></span><br><span class="line">        menu_doc = menu_help.Append(wx.NewId(),<span class="string">"&amp;Help Contents"</span>,<span class="string">"Manual about this application."</span>)</span><br><span class="line">        menu_about = menu_help.Append(wx.ID_ABOUT,<span class="string">"&amp;About"</span>,<span class="string">"This is a free software."</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_MENU, <span class="keyword">self</span>.OnOpenBookmark, menu_open)</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_MENU, <span class="keyword">self</span>.OnSavepath, menu_path)</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_MENU, <span class="keyword">self</span>.OnExportLog, menu_log)</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_MENU, <span class="keyword">self</span>.OnAbout, menu_about)</span><br><span class="line">        <span class="keyword">self</span>.Bind(wx.EVT_MENU, <span class="keyword">self</span>.OnExit, menu_exit)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> menubar</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnBMBtnClick</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.OnOpenBookmark(event)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnSPBtnClick</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.OnSavepath(event)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnSCBtnClick</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        currbm = <span class="keyword">self</span>.textctrl_bm.GetValue()</span><br><span class="line">        currsp = <span class="keyword">self</span>.textctrl_sp.GetValue()</span><br><span class="line"></span><br><span class="line">        if <span class="symbol">currbm:</span></span><br><span class="line">            if <span class="keyword">not</span> <span class="symbol">currsp:</span></span><br><span class="line">                currsp = os.path.basename(currbm)</span><br><span class="line">                <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Url links save to: %s"</span>%currsp)</span><br><span class="line">            <span class="keyword">self</span>.StartConvert(currbm, currsp)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Error: Information needs to be complete\n"</span>)</span><br><span class="line">            event.Skip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnSavepath</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        dirdlg = wx.DirDialog(<span class="keyword">self</span>, <span class="string">"Choose path..."</span>,  os.getcwd())</span><br><span class="line"></span><br><span class="line">        if dirdlg.ShowModal() == wx.<span class="symbol">ID_OK:</span></span><br><span class="line">            savepath = dirdlg.GetPath()</span><br><span class="line">            <span class="keyword">self</span>.textctrl_sp.SetValue(savepath)</span><br><span class="line">            if <span class="symbol">debug:</span></span><br><span class="line">                print <span class="string">"Save To: %s"</span>%savepath</span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Save To: %s\n"</span>%savepath)</span><br><span class="line"></span><br><span class="line">        dirdlg.Destroy()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnOpenBookmark</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        operabmfile = <span class="string">"Opera Bookmark File(*.adr)|*.adr|All files(*.*)|*.*"</span></span><br><span class="line">        opendlg = wx.FileDialog(<span class="keyword">self</span>, <span class="string">"Open opera bookmark..."</span>,os.getcwd(), style=wx.OPEN, wildcard=operabmfile)</span><br><span class="line"></span><br><span class="line">        if opendlg.ShowModal() == wx.<span class="symbol">ID_OK:</span></span><br><span class="line">            bmpath = opendlg.GetPath()</span><br><span class="line">            <span class="keyword">self</span>.textctrl_bm.SetValue(bmpath)</span><br><span class="line">            if <span class="symbol">debug:</span></span><br><span class="line">                print <span class="string">"Bookmark: %s"</span>%bmpath</span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Bookmark: %s\n"</span>%bmpath)</span><br><span class="line"></span><br><span class="line">        opendlg.Destroy()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnExportLog</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        file_wildcard = <span class="string">"log files(*.log)|*.log|All files(*.*)|*.*"</span></span><br><span class="line">        filedlg = wx.FileDialog(<span class="keyword">self</span>, <span class="string">"Save log to..."</span>, os.getcwd(), style=wx.SAVE|wx.OVERWRITE_PROMPT, wildcard=file_wildcard)</span><br><span class="line"></span><br><span class="line">        if filedlg.ShowModal() == wx.<span class="symbol">ID_OK:</span></span><br><span class="line">            bmlogpath = filedlg.GetPath()</span><br><span class="line"></span><br><span class="line">            if <span class="keyword">not</span> os.path.splitext(bmlogpath[<span class="number">1</span>])<span class="symbol">:</span></span><br><span class="line">                bmlogpath += <span class="string">".log"</span></span><br><span class="line"></span><br><span class="line">            bmlogfile = open(bmlogpath,<span class="string">'w'</span>)</span><br><span class="line">            bmlogfile.write(<span class="keyword">self</span>.textctrl_log.GetValue())</span><br><span class="line">            bmlogfile.close()</span><br><span class="line"></span><br><span class="line">        filedlg.Destroy()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnAbout</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        msgbox = wx.MessageBox(<span class="string">"This is a bookmark convert application\nAuthor: www.pystack.org\nVersion: 1.0"</span>,<span class="string">"About Me"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OnExit</span></span>(<span class="keyword">self</span>, event)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.Destroy()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">StartConvert</span></span>(<span class="keyword">self</span>, bmfile, sppath)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Running...\n"</span>)</span><br><span class="line">        if os.path.exists(bmfile) <span class="keyword">and</span> os.path.exists(sppath)<span class="symbol">:</span></span><br><span class="line">            <span class="keyword">self</span>.ws = win32com.client.Dispatch(<span class="string">"wscript.shell"</span>)</span><br><span class="line"></span><br><span class="line">            bmfile = open(bmfile, <span class="string">'r'</span>)</span><br><span class="line">            issubfld = <span class="number">0</span></span><br><span class="line">            bmfldpath = <span class="string">""</span></span><br><span class="line">            bmfldname = <span class="string">""</span></span><br><span class="line">            foldercount = <span class="number">0</span></span><br><span class="line">            urlcount = <span class="number">0</span></span><br><span class="line">            <span class="keyword">self</span>.urlok = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="number">1</span><span class="symbol">:</span></span><br><span class="line">                bmline = bmfile.readline()</span><br><span class="line">                if len(bmline) == <span class="number">0</span><span class="symbol">:</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                if bmline.strip() == <span class="string">"-"</span><span class="symbol">:</span></span><br><span class="line">                    issubfld = <span class="number">0</span></span><br><span class="line">                elif bmline.find(<span class="string">"#FOLDER"</span>) &lt;&gt; -<span class="number">1</span><span class="symbol">:</span></span><br><span class="line">                    bmfldid = bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>]</span><br><span class="line">                    if <span class="symbol">issubfld:</span></span><br><span class="line">                        bmfldname = os.path.join(bmfldname, unicode(bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>].strip(),<span class="string">"utf-8"</span>))</span><br><span class="line">                    <span class="symbol">else:</span></span><br><span class="line">                        bmfldname = unicode(bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>].strip(),<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">                    bmfldpath = os.path.join(sppath, bmfldname)</span><br><span class="line">                    if <span class="keyword">not</span> os.path.exists(bmfldpath)<span class="symbol">:</span></span><br><span class="line">                        os.mkdir(bmfldpath)</span><br><span class="line">                        if debug : print <span class="string">"+ Create folder: %s"</span>%bmfldpath</span><br><span class="line">                        <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"+ Create folder: %s\n"</span>%bmfldpath)</span><br><span class="line">                    foldercount += <span class="number">1</span></span><br><span class="line">                    issubfld=<span class="number">1</span></span><br><span class="line">                elif bmline.find(<span class="string">"#URL"</span>) &lt;&gt; -<span class="number">1</span><span class="symbol">:</span></span><br><span class="line">                    urlcount += <span class="number">1</span></span><br><span class="line">                    bmurlid = bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>]</span><br><span class="line">                    bmurlname = unicode(bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>].strip(),<span class="string">"utf-8"</span>)</span><br><span class="line">                    bmurlurl = unicode(bmfile.readline().split(<span class="string">"="</span>)[<span class="number">1</span>].strip(),<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">                    bmurlname = <span class="keyword">self</span>.LegalFileName(bmurlname)</span><br><span class="line">                    bmurlpath = os.path.join(bmfldpath,bmurlname+<span class="string">".url"</span>)</span><br><span class="line"></span><br><span class="line">                    if <span class="keyword">not</span> os.path.exists(bmurlpath)<span class="symbol">:</span></span><br><span class="line">                        <span class="keyword">self</span>.GenerateUrlLink(bmurlurl, bmurlpath)</span><br><span class="line">                        if <span class="symbol">debug:</span> print <span class="string">"  + Create Url (%s)"</span>%bmurlname</span><br><span class="line">                        <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"  + Create Url (%s)\n"</span>%bmurlurl)</span><br><span class="line">                    <span class="symbol">else:</span></span><br><span class="line">                        if <span class="symbol">debug:</span> print <span class="string">"Url exists ! (%s)"</span>%bmurlname</span><br><span class="line">                        <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Url exists ! (%s)\n"</span>%bmurlurl)</span><br><span class="line"></span><br><span class="line">            bmfile.close()</span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"\nFolderCount: %s    UrlCount: %s    UrlCreated: %s\n"</span>%(foldercount, urlcount, <span class="keyword">self</span>.urlok))</span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Finish convert.\n\n"</span>)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"Error: Bookmark file not exists !\nPlease check you input...\n\n"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LegalFileName</span></span>(<span class="keyword">self</span>, fname)<span class="symbol">:</span></span><br><span class="line">        illegalchars = [<span class="string">'&lt;'</span>,<span class="string">'&gt;'</span>,<span class="string">'/'</span>,<span class="string">'|'</span>,<span class="string">'\\'</span>,<span class="string">':'</span>,<span class="string">'"'</span>,<span class="string">'*'</span>,<span class="string">'?'</span>]</span><br><span class="line">        <span class="keyword">for</span> illchar <span class="keyword">in</span> <span class="symbol">illegalchars:</span></span><br><span class="line">            if fname.find(illchar) &lt;&gt; -<span class="number">1</span><span class="symbol">:</span></span><br><span class="line">                fname = fname.replace(illchar, <span class="string">" "</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GenerateUrlLink</span></span>(<span class="keyword">self</span>, bmurl, bmpath)<span class="symbol">:</span></span><br><span class="line">        if <span class="symbol">debug:</span> print <span class="string">'Exec: "%s" "%s"'</span>%(bmurl, bmpath)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#use py win32</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            scut = <span class="keyword">self</span>.ws.CreateShortcut(bmpath)</span><br><span class="line">            scut.TargetPath=bmurl</span><br><span class="line">            scut.Save()</span><br><span class="line">            <span class="keyword">self</span>.urlok += <span class="number">1</span></span><br><span class="line">        except <span class="symbol">:</span></span><br><span class="line">            if <span class="symbol">debug:</span> print <span class="string">"Unable to generate shortcut for: %s\n"</span>%bmurl</span><br><span class="line">            <span class="keyword">self</span>.textctrl_log.AppendText(<span class="string">"  --Unable to generate shortcut: %s\n"</span>%bmurl)</span><br><span class="line"></span><br><span class="line">if __name_<span class="number">_</span> == <span class="string">"__main__"</span><span class="symbol">:</span></span><br><span class="line">    app = wx.PySimpleApp()</span><br><span class="line">    frame = ConvertFrame(None, -<span class="number">1</span>)</span><br><span class="line">    frame.Show()</span><br><span class="line">    app.MainLoop()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h3&gt;&lt;p&gt;注：程序使用python + wxpython + pywin32实现，如果需要运行源代码，需要先安装上述库。另程序无法处理一些特殊符号，例如：●◎等&lt;/p&gt;
&lt;h3 id=&quot;程序功能：&quot;&gt;&lt;a href=&quot;#程序功能：&quot; class=&quot;headerlink&quot; title=&quot;程序功能：&quot;&gt;&lt;/a&gt;程序功能：&lt;/h3&gt;&lt;p&gt;将Opera导出的adr文件转换为URL快捷方式，可以直接导入到IE收藏夹中，也可以间接的导入到Chrome等浏览器中。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/opera-conv-main.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;程序代码：&quot;&gt;&lt;a href=&quot;#程序代码：&quot; class=&quot;headerlink&quot; title=&quot;程序代码：&quot;&gt;&lt;/a&gt;程序代码：&lt;/h3&gt;
    
    </summary>
    
      <category term="Python" scheme="http://pystack.org/categories/Python/"/>
    
    
      <category term="Opera" scheme="http://pystack.org/tags/Opera/"/>
    
      <category term="IE" scheme="http://pystack.org/tags/IE/"/>
    
      <category term="wxpython" scheme="http://pystack.org/tags/wxpython/"/>
    
      <category term="pywin32" scheme="http://pystack.org/tags/pywin32/"/>
    
  </entry>
  
  <entry>
    <title>Openstack无法启动windows xp镜像</title>
    <link href="http://pystack.org/2014/11/26/install-virtio-driver-for-windows-xp/"/>
    <id>http://pystack.org/2014/11/26/install-virtio-driver-for-windows-xp/</id>
    <published>2014-11-26T13:39:24.000Z</published>
    <updated>2017-11-28T08:29:24.907Z</updated>
    
    <content type="html"><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>XP虚拟机启动时候默认是没有virtio驱动的（默认为ide），从下面的xml文件也可以看出来（bus=ide）。所以无法直接导入到openstack中使用，需要手动将硬盘、网卡的virtio驱动安装上才可以正常使用.</p><p>如果是新装镜像，只要在安装时在软驱上挂载virtio驱动，就能在安装时自动识别安装驱动。如果是已经装好的系统，那就比较麻烦点。</p><a id="more"></a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 默认配置</span><br><span class="line"></span><br><span class="line">$ virsh dumpxml winxp</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">devices</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/kvm-spice<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">device</span>=<span class="string">'disk'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">'qemu'</span> <span class="attr">type</span>=<span class="string">'qcow2'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">'/home/images/win-xp.qcow2'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">'hda'</span> <span class="attr">bus</span>=<span class="string">'ide'</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'drive'</span> <span class="attr">controller</span>=<span class="string">'0'</span> <span class="attr">bus</span>=<span class="string">'0'</span> <span class="attr">target</span>=<span class="string">'0'</span> <span class="attr">unit</span>=<span class="string">'0'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'network'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mac</span> <span class="attr">address</span>=<span class="string">'52:54:00:6a:18:d2'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">network</span>=<span class="string">'default'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'rtl8139'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x03'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><h4 id="更新磁盘virtio驱动"><a href="#更新磁盘virtio驱动" class="headerlink" title="更新磁盘virtio驱动"></a>更新磁盘virtio驱动</h4><p>因为硬盘hda是启动盘，不能直接更改类型，所以需要手动添加一块硬盘，指定为virtio的，然后启动虚拟机，进入系统后，到设备管理器中的磁盘驱动器中可以看到一个驱动异常，直接更新驱动，找到virtio驱动安装即可。（ PS： address字段虚拟机启动时会自动生成，不会配置可以直接删掉 ）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ virsh edit winxp</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">device</span>=<span class="string">'disk'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">'qemu'</span> <span class="attr">type</span>=<span class="string">'qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">'/home/images/win-xp.qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">'hda'</span> <span class="attr">bus</span>=<span class="string">'ide'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">device</span>=<span class="string">'disk'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">'qemu'</span> <span class="attr">type</span>=<span class="string">'qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">'/home/remote_iso/test.qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">'vda'</span> <span class="attr">bus</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>安装驱动时需要手动挂载virtio的iso文件</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ virsh <span class="section">attach</span>-disk <span class="number">42</span> /image/virtio-win<span class="number">-0.1</span><span class="number">.136</span>.iso hdb --type cdrom</span><br></pre></td></tr></table></figure><p>驱动安装完成后，关闭虚拟机，将临时的硬盘再删掉，然后把启动盘的类型改为virtio的即可正常启动</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">device</span>=<span class="string">'disk'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">driver</span> <span class="attr">name</span>=<span class="string">'qemu'</span> <span class="attr">type</span>=<span class="string">'qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">'/home/Images/win-xp.qcow2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">dev</span>=<span class="string">'vda'</span> <span class="attr">bus</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="更新网卡virtio驱动"><a href="#更新网卡virtio驱动" class="headerlink" title="更新网卡virtio驱动"></a>更新网卡virtio驱动</h4><p>网卡更改为virtio的比较简单，直接把model改为virtio，然后启动虚拟机，进入系统后，到设备管理器中安装网卡驱动即可。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">'network'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mac</span> <span class="attr">address</span>=<span class="string">'52:54:00:6a:18:d2'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">network</span>=<span class="string">'default'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'virtio'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x03'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><p>如果嫌上面的方法太复杂，也可以通过更改镜像的metadata来解决XP无法启动的问题，缺点就是下载镜像导入到别的环境中时也需要修改metadata才能正常使用。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">glance image-update \</span><br><span class="line">    --<span class="keyword">property</span><span class="title"> </span><span class="attr">hw_disk_bus=</span>''ide'' \</span><br><span class="line">    --<span class="keyword">property</span><span class="title"> </span><span class="attr">hw_cdrom_bus=</span><span class="string">"ide"</span> \</span><br><span class="line">    --<span class="keyword">property</span><span class="title"> </span><span class="attr">hw_vif_model=</span><span class="string">"rtl8139"</span> \</span><br><span class="line">    <span class="number">7</span>db7f821-<span class="number">6</span>be1-<span class="number">4345</span>-ac08-<span class="number">47</span>a938c8f33a</span><br></pre></td></tr></table></figure><p>更多Metadata参数： <a href="https://docs.openstack.org/python-glanceclient/latest/cli/property-keys.html" target="_blank" rel="external">property-keys</a></p><blockquote><p>architecture - name of guest hardware architecture eg i686, x86_64, ppc64<br>hw_cdrom_bus - name of the CDROM bus to use eg virtio, scsi, ide<br>hw_disk_bus - name of the hard disk bus to use eg virtio, scsi, ide<br>hw_floppy_bus - name of the floppy disk bus to use eg fd, scsi, ide<br>hw_qemu_guest_agent - boolean ‘yes’ or ‘no’ to enable QEMU guest agent<br>hw_rng - name of the RNG device type eg virtio (pending merge)<br>hw_scsi_model - name of the SCSI bus controller eg ‘virtio-scsi’, ‘lsilogic’, etc (pending merge)<br>hw_video_model - name of the video adapter model to use, eg cirrus, vga, xen, qxl<br>hw_video_ram - MB of video RAM to provide eg 64 (pending merge)<br>hw_vif_model - name of a NIC device model eg virtio, e1000, rtl8139<br>hw_watchdog_action - action to take when watchdog device fires eg reset, poweroff, pause, none (pending merge)<br>os_command_line - string of boot time command line arguments for the guest kernel</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h3&gt;&lt;p&gt;XP虚拟机启动时候默认是没有virtio驱动的（默认为ide），从下面的xml文件也可以看出来（bus=ide）。所以无法直接导入到openstack中使用，需要手动将硬盘、网卡的virtio驱动安装上才可以正常使用.&lt;/p&gt;
&lt;p&gt;如果是新装镜像，只要在安装时在软驱上挂载virtio驱动，就能在安装时自动识别安装驱动。如果是已经装好的系统，那就比较麻烦点。&lt;/p&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="windows xp" scheme="http://pystack.org/tags/windows-xp/"/>
    
      <category term="virtio" scheme="http://pystack.org/tags/virtio/"/>
    
  </entry>
  
  <entry>
    <title>Openstack导入VMDK and VDI镜像</title>
    <link href="http://pystack.org/2014/11/25/openstack-import-vmdk-and-vdi-image/"/>
    <id>http://pystack.org/2014/11/25/openstack-import-vmdk-and-vdi-image/</id>
    <published>2014-11-25T13:39:24.000Z</published>
    <updated>2017-12-08T06:52:56.761Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Virtualbox"><a href="#Virtualbox" class="headerlink" title="Virtualbox"></a>Virtualbox</h2><ol><li><strong>系统安装前准备</strong></li></ol><p>Virtualbox默认的Storage Controller为SATA，需要在虚拟机安装前手动修改为IDE</p><p><img src="/assets/img/virtualbox-disk.png" alt=""></p><ol><li><strong>安装操作系统</strong></li></ol><p>过程略</p><ol><li><strong>修改镜像元数据</strong></li></ol><p>镜像 –&gt; 更新元数据，修改硬盘和网卡类型：</p><pre><code>hw_disk_bus    idehw_vif_model    rtl8139</code></pre><p><img src="/assets/img/image-metadata.png" alt=""></p><h2 id="VMware"><a href="#VMware" class="headerlink" title="VMware"></a>VMware</h2><ol><li><strong>安装windows</strong></li></ol><p>系统安装过程略，安装完成后需要手动修改一下注册表。</p><p>下载<a href="/assets/img/MergeIDE.zip">MergeIDE.zip</a>压缩包到虚拟机，执行 MergeIDE.bat 文件即可。</p><ol><li><strong>修改镜像元数据</strong></li></ol><p>镜像 –&gt; 更新元数据，修改硬盘和网卡类型：(同Virtualbox第三步)</p><pre><code>hw_disk_bus    idehw_vif_model    rtl8139</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Virtualbox&quot;&gt;&lt;a href=&quot;#Virtualbox&quot; class=&quot;headerlink&quot; title=&quot;Virtualbox&quot;&gt;&lt;/a&gt;Virtualbox&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;系统安装前准备&lt;/strong&gt;&lt;/li&gt;
&lt;/
      
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="Openstack" scheme="http://pystack.org/tags/Openstack/"/>
    
      <category term="windows" scheme="http://pystack.org/tags/windows/"/>
    
      <category term="vmdk" scheme="http://pystack.org/tags/vmdk/"/>
    
      <category term="vdi" scheme="http://pystack.org/tags/vdi/"/>
    
  </entry>
  
  <entry>
    <title>Openstack windows guest安装spice-guest-tools</title>
    <link href="http://pystack.org/2014/03/22/install-vdagent-on-windows-guest/"/>
    <id>http://pystack.org/2014/03/22/install-vdagent-on-windows-guest/</id>
    <published>2014-03-21T19:19:24.000Z</published>
    <updated>2017-11-28T05:59:27.492Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Windows-guest-内存显示不准"><a href="#Windows-guest-内存显示不准" class="headerlink" title="Windows guest 内存显示不准"></a>Windows guest 内存显示不准</h3><p>windows虚拟机启动后，使用libvirt api无法获取准确的内存使用率，也无法使用ballon， 需要安装spice-guest-tools，启动vdagent，vdservice 才能获得准确的内存使用情况，ballon才能正常使用。</p><p>安装前：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@compute3</span><span class="symbol">:~</span><span class="comment"># virsh dommemstat 51</span></span><br><span class="line">actual <span class="number">8388608</span></span><br><span class="line">rss <span class="number">8438800</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>安装后：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@compute3:~# virsh dommemstat <span class="number">51</span></span><br><span class="line">actual <span class="number">8388608</span></span><br><span class="line">swap_in <span class="number">0</span></span><br><span class="line">swap_out <span class="number">0</span></span><br><span class="line">major_fault <span class="number">32</span></span><br><span class="line">minor_fault <span class="number">9761</span></span><br><span class="line">unused <span class="number">7361896</span></span><br><span class="line">available <span class="number">8388208</span></span><br><span class="line">rss <span class="number">8435844</span></span><br></pre></td></tr></table></figure><h3 id="vdagent进程CPU使用率过高"><a href="#vdagent进程CPU使用率过高" class="headerlink" title="vdagent进程CPU使用率过高"></a>vdagent进程CPU使用率过高</h3><p>安装spice-guest-tools之后，查看任务管理器发现，vdagent那个进程cpu使用率一直是50%，结果就是虚拟机非常的卡，解决办法是将xml文件中的 channel 由pty 改为 spicevmc即可。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">python2</span>.7/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">nova</span>/<span class="title">virt</span>/<span class="title">libvirt</span>/<span class="title">config</span>.<span class="title">py</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LibvirtConfigGuestCharBase</span>(<span class="title">LibvirtConfigGuestDevice</span>):</span></span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span></span>(<span class="keyword">self</span>, **kwargs):</span><br><span class="line">         <span class="keyword">super</span>(LibvirtConfigGuestCharBase, <span class="keyword">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    *        <span class="keyword">self</span>.<span class="keyword">type</span> = <span class="string">"pty"</span></span><br><span class="line">    -        <span class="keyword">self</span>.<span class="keyword">type</span> = <span class="string">"spicevmc"</span></span><br></pre></td></tr></table></figure><p>下载地址： <a href="https://www.spice-space.org/download.html" target="_blank" rel="external">https://www.spice-space.org/download.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Windows-guest-内存显示不准&quot;&gt;&lt;a href=&quot;#Windows-guest-内存显示不准&quot; class=&quot;headerlink&quot; title=&quot;Windows guest 内存显示不准&quot;&gt;&lt;/a&gt;Windows guest 内存显示不准&lt;/h3&gt;&lt;p&gt;windows虚拟机启动后，使用libvirt api无法获取准确的内存使用率，也无法使用ballon， 需要安装spice-guest-tools，启动vdagent，vdservice 才能获得准确的内存使用情况，ballon才能正常使用。&lt;/p&gt;
&lt;p&gt;安装前：&lt;/p&gt;
&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root&lt;span class=&quot;variable&quot;&gt;@compute3&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:~&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;# virsh dommemstat 51&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;actual &lt;span class=&quot;number&quot;&gt;8388608&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rss &lt;span class=&quot;number&quot;&gt;8438800&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Openstack" scheme="http://pystack.org/categories/Openstack/"/>
    
    
      <category term="openstack" scheme="http://pystack.org/tags/openstack/"/>
    
      <category term="libvirt" scheme="http://pystack.org/tags/libvirt/"/>
    
      <category term="kvm" scheme="http://pystack.org/tags/kvm/"/>
    
      <category term="spice" scheme="http://pystack.org/tags/spice/"/>
    
      <category term="ballon" scheme="http://pystack.org/tags/ballon/"/>
    
      <category term="vdagent" scheme="http://pystack.org/tags/vdagent/"/>
    
  </entry>
  
  <entry>
    <title>Mariab修改最大连接数</title>
    <link href="http://pystack.org/2014/03/14/mariadb-configuration/"/>
    <id>http://pystack.org/2014/03/14/mariadb-configuration/</id>
    <published>2014-03-13T19:19:24.000Z</published>
    <updated>2017-11-28T02:52:06.039Z</updated>
    
    <content type="html"><![CDATA[<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>1.编辑/usr/lib/systemd/system/mariadb.service，在[Service]项最后加上以下两行：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">65535</span></span><br><span class="line"><span class="attr">LimitNPROC</span>=<span class="number">65535</span></span><br></pre></td></tr></table></figure><p>2.编辑/etc/my.cnf和/etc/my.cnf.d/mariadb-server.cnf，在[mysqld]项最后加上下面一行：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">max_connections</span>=<span class="number">10240</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>3.重启服务</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">service mariadb restart</span><br></pre></td></tr></table></figure><p>4.查看支持最大连接数：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show <span class="keyword">variables</span> like <span class="comment">"max_connections"</span>;</span><br></pre></td></tr></table></figure><p><img src="/assets/img/mysql-max-conn.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h2&gt;&lt;p&gt;1.编辑/usr/lib/systemd/system/mariadb.service，在[Service]项最后加上以下两行：&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;LimitNOFILE&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;65535&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;LimitNPROC&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;65535&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.编辑/etc/my.cnf和/etc/my.cnf.d/mariadb-server.cnf，在[mysqld]项最后加上下面一行：&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;max_connections&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;10240&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Database" scheme="http://pystack.org/categories/Database/"/>
    
    
      <category term="mysql" scheme="http://pystack.org/tags/mysql/"/>
    
      <category term="mariadb" scheme="http://pystack.org/tags/mariadb/"/>
    
      <category term="最大连接数" scheme="http://pystack.org/tags/%E6%9C%80%E5%A4%A7%E8%BF%9E%E6%8E%A5%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>Mariadb主主配置</title>
    <link href="http://pystack.org/2014/03/14/mysql-master-master/"/>
    <id>http://pystack.org/2014/03/14/mysql-master-master/</id>
    <published>2014-03-13T19:19:24.000Z</published>
    <updated>2017-11-28T02:41:09.276Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">### <span class="selector-tag">Env</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">mysql1</span>: 10<span class="selector-class">.10</span><span class="selector-class">.56</span><span class="selector-class">.10</span></span><br><span class="line"><span class="selector-tag">mysql2</span>: 10<span class="selector-class">.10</span><span class="selector-class">.56</span><span class="selector-class">.20</span></span><br></pre></td></tr></table></figure><ol><li>install mariadb</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## on mysql1</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install mariadb mariadb-server</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## on mysql2</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install mariadb mariadb-server</span></span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>config my.cnf</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### on mysql1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attribute">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">port = 3306</span><br><span class="line">server_id = 1</span><br><span class="line">log-bin= mysql-bin</span><br><span class="line"><span class="attribute">relay_log</span>=mysql-relay-bin</span><br><span class="line">binlog_format = row</span><br><span class="line"><span class="attribute">binlog-ignore-db</span>=mysql</span><br><span class="line"><span class="attribute">binlog-ignore-db</span>=information_schema</span><br><span class="line"><span class="attribute">auto-increment-offset</span>=1</span><br><span class="line"><span class="attribute">auto-increment-increment</span>=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl restart mariadb</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### on mysql2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attribute">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">port = 3306</span><br><span class="line">server_id = 2</span><br><span class="line">log-bin= mysql-bin</span><br><span class="line"><span class="attribute">relay_log</span>=mysql-relay-bin</span><br><span class="line">binlog_format = row</span><br><span class="line"><span class="attribute">binlog-ignore-db</span>=mysql</span><br><span class="line"><span class="attribute">binlog-ignore-db</span>=information_schema</span><br><span class="line"><span class="attribute">auto-increment-offset</span>=2</span><br><span class="line"><span class="attribute">auto-increment-increment</span>=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl restart mariadb</span></span><br></pre></td></tr></table></figure><ol><li>add replication user on mysql1</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">### on mysql1</span><br><span class="line"></span><br><span class="line"># mysql -uroot -ppassword</span><br><span class="line">MariaDB [(none)]&gt; grant replication slave,replication client on <span class="strong">*.*</span> to <span class="emphasis">'repluser'</span>@<span class="emphasis">'10.10.56.%'</span> identified by <span class="emphasis">'123456'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges; </span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show master status; </span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------+</span><br><span class="line">| File             | Position | Binlog<span class="emphasis">_Do_</span>DB | Binlog<span class="emphasis">_Ignore_</span>DB         |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------+</span><br><span class="line">| mysql-bin.000004 |      504 |              | mysql,information<span class="emphasis">_schema |</span></span><br><span class="line"><span class="emphasis">+------------------+----------+--------------+--------------------------+</span></span><br><span class="line"><span class="emphasis">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure><ol><li>config mysql2 master to mysql1</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### on mysql2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql -uroot -ppassword</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">stop</span> <span class="string">slave;</span></span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.01</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">change</span> <span class="string">master</span> <span class="string">to</span> <span class="string">MASTER_HOST='10.10.56.10',</span> <span class="string">MASTER_USER='repluser',</span> <span class="string">MASTER_PASSWORD='123456',</span>  <span class="string">MASTER_LOG_FILE='mysql-bin.000004',</span> <span class="string">MASTER_LOG_POS=504;</span>   </span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.14</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">start</span> <span class="string">slave;</span>        </span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">show</span> <span class="string">slave</span> <span class="string">status\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line"><span class="attr">               Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line"><span class="attr">                  Master_Host:</span> <span class="number">10.10</span><span class="number">.56</span><span class="number">.20</span></span><br><span class="line"><span class="attr">                  Master_User:</span> <span class="string">repluser</span></span><br><span class="line"><span class="attr">                  Master_Port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">                Connect_Retry:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">              Master_Log_File:</span> <span class="string">mysql-bin.000004</span></span><br><span class="line"><span class="attr">          Read_Master_Log_Pos:</span> <span class="number">504</span></span><br><span class="line"><span class="attr">               Relay_Log_File:</span> <span class="string">mysql-relay-bin.000002</span></span><br><span class="line"><span class="attr">                Relay_Log_Pos:</span> <span class="number">529</span></span><br><span class="line"><span class="attr">        Relay_Master_Log_File:</span> <span class="string">mysql-bin.000004</span></span><br><span class="line"><span class="attr">             Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">            Slave_SQL_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">              Replicate_Do_DB:</span> </span><br><span class="line"><span class="attr">          Replicate_Ignore_DB:</span> </span><br><span class="line"><span class="attr">           Replicate_Do_Table:</span> </span><br><span class="line"><span class="attr">       Replicate_Ignore_Table:</span> </span><br><span class="line"><span class="attr">      Replicate_Wild_Do_Table:</span> </span><br><span class="line"><span class="attr">  Replicate_Wild_Ignore_Table:</span> </span><br><span class="line"></span><br><span class="line">                <span class="string">...</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">               Last_SQL_Error:</span> </span><br><span class="line"><span class="attr">  Replicate_Ignore_Server_Ids:</span> </span><br><span class="line"><span class="attr">             Master_Server_Id:</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure><ol><li>add replication user on mysql2</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">### on mysql2</span><br><span class="line"></span><br><span class="line"># mysql -uroot -ppassword</span><br><span class="line">MariaDB [(none)]&gt; grant replication slave,replication client on <span class="strong">*.*</span> to <span class="emphasis">'repluser'</span>@<span class="emphasis">'10.10.56.%'</span> identified by <span class="emphasis">'123456'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges; </span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show master status; </span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------+</span><br><span class="line">| File             | Position | Binlog<span class="emphasis">_Do_</span>DB | Binlog<span class="emphasis">_Ignore_</span>DB         |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------+</span><br><span class="line">| mysql-bin.000004 |      504 |              | mysql,information<span class="emphasis">_schema |</span></span><br><span class="line"><span class="emphasis">+------------------+----------+--------------+--------------------------+</span></span><br><span class="line"><span class="emphasis">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure><ol><li>config mysql1 master to mysql2</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### on mysql1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql -uroot -ppassword</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">stop</span> <span class="string">slave;</span></span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.01</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">change</span> <span class="string">master</span> <span class="string">to</span> <span class="string">MASTER_HOST='10.10.56.20',</span> <span class="string">MASTER_USER='repluser',</span> <span class="string">MASTER_PASSWORD='123456',</span>  <span class="string">MASTER_LOG_FILE='mysql-bin.000004',</span> <span class="string">MASTER_LOG_POS=504;</span>   </span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.14</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">start</span> <span class="string">slave;</span>        </span><br><span class="line"><span class="string">Query</span> <span class="string">OK,</span> <span class="number">0</span> <span class="string">rows</span> <span class="string">affected</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br><span class="line"></span><br><span class="line"><span class="string">MariaDB</span> <span class="string">[(none)]&gt;</span> <span class="string">show</span> <span class="string">slave</span> <span class="string">status\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line"><span class="attr">               Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line"><span class="attr">                  Master_Host:</span> <span class="number">10.10</span><span class="number">.56</span><span class="number">.10</span></span><br><span class="line"><span class="attr">                  Master_User:</span> <span class="string">repluser</span></span><br><span class="line"><span class="attr">                  Master_Port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">                Connect_Retry:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">              Master_Log_File:</span> <span class="string">mysql-bin.000004</span></span><br><span class="line"><span class="attr">          Read_Master_Log_Pos:</span> <span class="number">504</span></span><br><span class="line"><span class="attr">               Relay_Log_File:</span> <span class="string">mysql-relay-bin.000002</span></span><br><span class="line"><span class="attr">                Relay_Log_Pos:</span> <span class="number">529</span></span><br><span class="line"><span class="attr">        Relay_Master_Log_File:</span> <span class="string">mysql-bin.000004</span></span><br><span class="line"><span class="attr">             Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">            Slave_SQL_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">              Replicate_Do_DB:</span> </span><br><span class="line"><span class="attr">          Replicate_Ignore_DB:</span> </span><br><span class="line"><span class="attr">           Replicate_Do_Table:</span> </span><br><span class="line"><span class="attr">       Replicate_Ignore_Table:</span> </span><br><span class="line"><span class="attr">      Replicate_Wild_Do_Table:</span> </span><br><span class="line"><span class="attr">  Replicate_Wild_Ignore_Table:</span> </span><br><span class="line"></span><br><span class="line">                <span class="string">...</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">               Last_SQL_Error:</span> </span><br><span class="line"><span class="attr">  Replicate_Ignore_Server_Ids:</span> </span><br><span class="line"><span class="attr">             Master_Server_Id:</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure><ol><li>check </li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">### on mysql1</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database testsync;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">### on mysql2</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information<span class="emphasis">_schema |</span></span><br><span class="line"><span class="emphasis">| mysql              |</span></span><br><span class="line"><span class="emphasis">| performance_</span>schema |</span><br><span class="line">| testsync           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database testsync2;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">### on mysql1</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information<span class="emphasis">_schema |</span></span><br><span class="line"><span class="emphasis">| mysql              |</span></span><br><span class="line"><span class="emphasis">| performance_</span>schema |</span><br><span class="line">| testsync           |</span><br><span class="line">| testsync2          |</span><br><span class="line"><span class="code">+--------------------+</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;环境信息&quot;&gt;&lt;a href=&quot;#环境信息&quot; class=&quot;headerlink&quot; title=&quot;环境信息&quot;&gt;&lt;/a&gt;环境信息&lt;/h3&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;### &lt;span class=&quot;selector-tag&quot;&gt;Env&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;mysql1&lt;/span&gt;: 10&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.56&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;mysql2&lt;/span&gt;: 10&lt;span class=&quot;selector-class&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.56&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.20&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;install mariadb&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## on mysql1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; yum install mariadb mariadb-server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## on mysql2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; yum install mariadb mariadb-server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Database" scheme="http://pystack.org/categories/Database/"/>
    
    
      <category term="mysql" scheme="http://pystack.org/tags/mysql/"/>
    
      <category term="mariadb" scheme="http://pystack.org/tags/mariadb/"/>
    
      <category term="master-master" scheme="http://pystack.org/tags/master-master/"/>
    
  </entry>
  
  <entry>
    <title>pyinstaller使用笔记</title>
    <link href="http://pystack.org/2014/03/14/pyinstaller-notes/"/>
    <id>http://pystack.org/2014/03/14/pyinstaller-notes/</id>
    <published>2014-03-13T19:19:24.000Z</published>
    <updated>2017-11-28T02:26:29.370Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用pyinstaller打包openstack程序"><a href="#使用pyinstaller打包openstack程序" class="headerlink" title="使用pyinstaller打包openstack程序"></a>使用pyinstaller打包openstack程序</h2><p>由于pyinstaller不支持pkg_resources，打包完运行的时候总是提示setuptools包有问题，可以等打包完成后手动将对应的包拷贝过去(dist-info目录也需要)。</p><p>可以正常打包，打包后运行的时候提示错误信息如下，可以看到错误在 “login.py”, line 5，这一行刚好是引用keystoneclient的包</p><a id="more"></a><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"&lt;string&gt;"</span>, <span class="literal">line</span> <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"login.py"</span>, <span class="literal">line</span> <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\keystoneclient\__init__.py"</span>, <span class="literal">line</span> <span class="number">36</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pbr\version.py"</span>, <span class="literal">line</span> <span class="number">465</span>, <span class="keyword">in</span> version_string</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pbr\version.py"</span>, <span class="literal">line</span> <span class="number">460</span>, <span class="keyword">in</span> semantic_version</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pbr\version.py"</span>, <span class="literal">line</span> <span class="number">446</span>, <span class="keyword">in</span> _get_version_from_pkg_resour</span><br><span class="line">ces</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pbr\packaging.py"</span>, <span class="literal">line</span> <span class="number">33</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\setuptools\command\develop.py"</span>, <span class="literal">line</span> <span class="number">11</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\setuptools\command\easy_install.py"</span>, <span class="literal">line</span> <span class="number">51</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"D:\PyInstaller-3.1.1\PyInstaller\loader\pyimod03_importers.py"</span>, <span class="literal">line</span> <span class="number">389</span></span><br><span class="line">, <span class="keyword">in</span> load_module</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\setuptools\package_index.py"</span>, <span class="literal">line</span> <span class="number">206</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pkg_resources\__init__.py"</span>, <span class="literal">line</span> <span class="number">943</span>, <span class="keyword">in</span> require</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"site-packages\pkg_resources\__init__.py"</span>, <span class="literal">line</span> <span class="number">829</span>, <span class="keyword">in</span> resolve</span><br><span class="line">pkg_resources.DistributionNotFound: The <span class="symbol">'setuptools</span>' distribution was <span class="keyword">not</span> found</span><br><span class="line"><span class="keyword">and</span> <span class="keyword">is</span> required by the application</span><br><span class="line">main returned -<span class="number">1</span></span><br></pre></td></tr></table></figure><p>还会报keystone的一个包错误 ，貌似是不支持下划线开头的包，使用旧版本的client就没有问题了。<br><img src="/assets/img/pyinstaller-keystone-error.png" alt="pyinstaller-keystone-error.png"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d:\PyInstaller-<span class="number">3.1</span>.<span class="number">1</span>&gt;python pyinstaller<span class="selector-class">.py</span> -n cloudclient --noconsole --upx-dir d:\upx391w d:\cloudclient\main<span class="selector-class">.py</span> -<span class="selector-tag">i</span> logo.ico</span><br></pre></td></tr></table></figure><blockquote><p>-n NAME  指定生成文件的名称<br>–noconsole    文件运行的时候不会出现cmd黑窗口<br>–upx-dir PATH    指定upx目录路径，使用upx压缩<br>main.py    程序的入口文件，如果有多个文件也只要入口文件就行，其余的会自动引入<br>-i ICON   指定生成文件使用的图标</p></blockquote><p>如果有ini配置文件、或者有图片等文件，可以等pyinstaller打包后直接拷贝到dist目录中即可使用</p><h2 id="pyinstaller-in-arm"><a href="#pyinstaller-in-arm" class="headerlink" title="pyinstaller in arm"></a>pyinstaller in arm</h2><p>pyinstaller 默认只支持x86架构，直接在arm平台打包，会提示没有预编译的bootloader</p><blockquote><p>Fatal error: PyInstaller does not include a pre-compiled bootloader for your<br>platform. </p></blockquote><p><img src="/assets/img/no-pre-bootloader.png" alt="No Bootloader"></p><p>这个问题只要在arm平台上重新生成一下bootloader即可解决，官方文档：<a href="http://pythonhosted.org/PyInstaller/bootloader-building.html" target="_blank" rel="external">http://pythonhosted.org/PyInstaller/bootloader-building.html</a></p><h3 id="生成bootloader"><a href="#生成bootloader" class="headerlink" title="生成bootloader"></a>生成bootloader</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> bootloader</span><br><span class="line"><span class="keyword">python</span> ./waf distclean <span class="keyword">all</span></span><br><span class="line"></span><br><span class="line"># 因为官方提供的LSB Tools的源有问题，所以可以直接忽略lsb</span><br><span class="line"><span class="keyword">python</span> ./waf configure --<span class="keyword">no</span>-lsb <span class="keyword">all</span></span><br></pre></td></tr></table></figure><p>这边提示lsbcc程序不存在，需要手动安装lsb-build-cc，具体步骤如下</p><p><img src="/assets/img/no-lsbcc.png" alt="No lsbcc"></p><h3 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h3><p>Development tools</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install build-essential</span><br></pre></td></tr></table></figure><h3 id="安装lsbcc"><a href="#安装lsbcc" class="headerlink" title="安装lsbcc"></a>安装lsbcc</h3><p>installed the LSB tools<br>在/etc/apt/sources.list文件中加入源</p><p>deb <a href="http://ftp.linux-foundation.org/pub/lsb/repositories/debian" target="_blank" rel="external">http://ftp.linux-foundation.org/pub/lsb/repositories/debian</a> lsb-4.0 main</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> update</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install lsb lsb-build-cc</span><br></pre></td></tr></table></figure><p>也可以直接下载安装（下载地址：<a href="http://ftp.linuxfoundation.org/pub/lsb/bundles/released-4.0.0/sdk/" target="_blank" rel="external">http://ftp.linuxfoundation.org/pub/lsb/bundles/released-4.0.0/sdk/</a>）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf lsb-sdk-<span class="number">4.0</span>.<span class="number">3</span>-<span class="number">1</span><span class="selector-class">.ia32</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd lsb-sdk</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ul><li>PyInstaller.compat.FileNotFoundError: Path or glob “/usr/include/python2.7/pyconfig.h” not found or matches no files.</li></ul><p>需要安装python-dev</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">apt</span>-<span class="meta">get</span> install <span class="keyword">build-essential </span>python-dev</span><br></pre></td></tr></table></figure><h2 id="使用-Inno-Setup-打包"><a href="#使用-Inno-Setup-打包" class="headerlink" title="使用 Inno Setup 打包"></a>使用 Inno Setup 打包</h2><p>pyinstaller打包后的目录可以使用inno setup 打包为可安装的exe文件，需要注意的是桌面快捷方式和安装依赖程序。</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">; 脚本由 Inno Setup 脚本向导 生成！</span><br><span class="line">; 有关创建 Inno Setup 脚本文件的详细资料请查阅帮助文档！</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MyAppName <span class="string">"Cloud Client"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MyAppVersion <span class="string">"1.0.0603"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MyAppPublisher <span class="string">"Pystack Client"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MyAppURL <span class="string">"http://pystack.org/"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MyAppExeName <span class="string">"cloudclient.exe"</span></span></span><br><span class="line"></span><br><span class="line">[Setup]</span><br><span class="line">; 注: AppId的值为单独标识该应用程序。</span><br><span class="line">; 不要为其他安装程序使用相同的AppId值。</span><br><span class="line">; (生成新的GUID，点击 工具|在IDE中生成GUID。)</span><br><span class="line">AppId=&#123;&#123;BCD20A87<span class="number">-97</span>CF<span class="number">-4</span>D18<span class="number">-931</span>A-FA2CBC2529BF&#125;</span><br><span class="line">AppName=&#123;<span class="meta">#MyAppName&#125;</span></span><br><span class="line">AppVersion=&#123;<span class="meta">#MyAppVersion&#125;</span></span><br><span class="line">;AppVerName=&#123;<span class="meta">#MyAppName&#125; &#123;#MyAppVersion&#125;</span></span><br><span class="line">AppPublisher=&#123;<span class="meta">#MyAppPublisher&#125;</span></span><br><span class="line">AppPublisherURL=&#123;<span class="meta">#MyAppURL&#125;</span></span><br><span class="line">AppSupportURL=&#123;<span class="meta">#MyAppURL&#125;</span></span><br><span class="line">AppUpdatesURL=&#123;<span class="meta">#MyAppURL&#125;</span></span><br><span class="line">DefaultDirName=&#123;pf64&#125;\&#123;<span class="meta">#MyAppName&#125;</span></span><br><span class="line">DisableProgramGroupPage=yes</span><br><span class="line">OutputDir=C:\Users\Administrator\Desktop</span><br><span class="line">OutputBaseFilename=cloudclient</span><br><span class="line">SetupIconFile=D:\我的文件\Downloads\Desktop_Folder_128px_1125934_easyicon.net.ico</span><br><span class="line">Compression=lzma</span><br><span class="line">SolidCompression=yes</span><br><span class="line"></span><br><span class="line">[Languages]</span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"chinesesimp"</span>; MessagesFile: <span class="string">"compiler:Default.isl"</span></span><br><span class="line"></span><br><span class="line">[Tasks]</span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"desktopicon"</span>; Description: <span class="string">"&#123;cm:CreateDesktopIcon&#125;"</span>; GroupDescription: <span class="string">"&#123;cm:AdditionalIcons&#125;"</span>; Flags: checkablealone</span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"quicklaunchicon"</span>; Description: <span class="string">"&#123;cm:CreateQuickLaunchIcon&#125;"</span>; GroupDescription: <span class="string">"&#123;cm:AdditionalIcons&#125;"</span>; Flags: checkablealone</span><br><span class="line"></span><br><span class="line">[Files]</span><br><span class="line"><span class="symbol">Source:</span> <span class="string">"D:\PyInstaller-3.1.1\cloudclient\dist\cloudclient\cloudclient.exe"</span>; DestDir: <span class="string">"&#123;app&#125;"</span>; Flags: ignoreversion</span><br><span class="line"><span class="symbol">Source:</span> <span class="string">"D:\PyInstaller-3.1.1\cloudclient\dist\cloudclient\*"</span>; DestDir: <span class="string">"&#123;app&#125;"</span>; Flags: ignoreversion recursesubdirs createallsubdirs</span><br><span class="line">; 注意: 不要在任何共享系统文件上使用“Flags: ignoreversion”</span><br><span class="line"></span><br><span class="line">[Icons]</span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"&#123;commonprograms&#125;\&#123;#MyAppName&#125;"</span>; Filename: <span class="string">"&#123;app&#125;\&#123;#MyAppExeName&#125;"</span></span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"&#123;commondesktop&#125;\&#123;#MyAppName&#125;"</span>; Filename: <span class="string">"&#123;app&#125;\&#123;#MyAppExeName&#125;"</span>; Tasks: desktopicon</span><br><span class="line"><span class="symbol">Name:</span> <span class="string">"&#123;userappdata&#125;\Microsoft\Internet Explorer\Quick Launch\&#123;#MyAppName&#125;"</span>; Filename: <span class="string">"&#123;app&#125;\&#123;#MyAppExeName&#125;"</span>; Tasks: quicklaunchicon</span><br><span class="line"></span><br><span class="line">[Run]</span><br><span class="line"><span class="symbol">Filename:</span> <span class="string">"&#123;app&#125;\usbdk\usbdk_x64.msi"</span>; Description: <span class="string">"Install USB Redirect Tool"</span>; StatusMsg: <span class="string">"正在安装USB重定向工具"</span>; Flags: shellexec waituntilterminated</span><br><span class="line"><span class="symbol">Filename:</span> <span class="string">"&#123;app&#125;\&#123;#MyAppExeName&#125;"</span>; Description: <span class="string">"&#123;cm:LaunchProgram,&#123;#StringChange(MyAppName, '&amp;', '&amp;&amp;')&#125;&#125;"</span>; Flags: nowait postinstall skipifsilent</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用pyinstaller打包openstack程序&quot;&gt;&lt;a href=&quot;#使用pyinstaller打包openstack程序&quot; class=&quot;headerlink&quot; title=&quot;使用pyinstaller打包openstack程序&quot;&gt;&lt;/a&gt;使用pyinstaller打包openstack程序&lt;/h2&gt;&lt;p&gt;由于pyinstaller不支持pkg_resources，打包完运行的时候总是提示setuptools包有问题，可以等打包完成后手动将对应的包拷贝过去(dist-info目录也需要)。&lt;/p&gt;
&lt;p&gt;可以正常打包，打包后运行的时候提示错误信息如下，可以看到错误在 “login.py”, line 5，这一行刚好是引用keystoneclient的包&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="http://pystack.org/categories/Python/"/>
    
    
      <category term="openstack" scheme="http://pystack.org/tags/openstack/"/>
    
      <category term="python" scheme="http://pystack.org/tags/python/"/>
    
      <category term="pyinstaller" scheme="http://pystack.org/tags/pyinstaller/"/>
    
      <category term="arm" scheme="http://pystack.org/tags/arm/"/>
    
      <category term="Inno Setup" scheme="http://pystack.org/tags/Inno-Setup/"/>
    
  </entry>
  
</feed>
